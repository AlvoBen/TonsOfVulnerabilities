<!--
Modification Log:
* Developer Name                  Date                         Description
*------------------------------------------------------------------------------------------------------------------------------
* Abhishek Mangutkar                                           Initial version
* Soniya Kunapareddy              08/24/2022                  US-3562135
* Abhishek Mangutkar              09/05/2022                  US-3668207
* Swapnali Sonawane               12/05/2022                  US- 3969790 Migration of the order queue detail capability
* Abhishek Mangutkar              12/06/2022                  US3996413- Fixing Pharmacy Issues
* Isaac Chung                     11/06/2023                  US 5306769 - Next Best Action, Add Mail Order Page to NBA Engine - Interim Solution
****************************************************************************************************************************-->
<template>    
    <template if:true={isHighlightDetailsLoading}>
        <div class="slds-page-header slds-page-header_record-home">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-standard-opportunity">
                                <lightning-icon slot="media" icon-name="standard:contact"></lightning-icon>
                            </span>
                        </div>
                        <div class="slds-media__body">
                            <div class="slds-page-header__name">
                                <div class="slds-page-header__name-title">
                                    <h1>
                                        <span>Mail Order Pharmacy</span>
                                        <span class="slds-page-header__title slds-truncate" title="Loading...">Loading...</span>
                                    </h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>                
            </div>
            <div class="slds-page-header__row slds-page-header__row_gutters">
                <div class="slds-m-around_large">
                    <lightning-spinner variant="brand" size="large" alternative-text="Loading..."></lightning-spinner>               
                </div>
            </div>
        </div>
    </template>
    <template if:true={isHighlightDetailsLoaded}>  
		<template if:true={serviceFailure}>
            <!--member not found-->
            <div class={errorClass} role="status">
                <div class="slds-media__figure">
                    <span class={iconErrorClass} title={errAssistiveText}>
                        <div class="slds-media__figure">
                            <lightning-icon icon-name={iconname} variant="inverse"></lightning-icon>
                        </div>
                        <span class="slds-assistive-text">{errAssistiveText}</span>
                    </span>
                </div>
                <div class="slds-media__body">
                    <p>{errorMessage}</p>
                </div>
            </div>
        </template>
        <template if:false={serviceFailure}>
        <div class="slds-page-header slds-page-header_record-home">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-standard-opportunity">
                                <lightning-icon slot="media" icon-name="standard:contact"></lightning-icon>
                            </span>
                        </div>
                        <div class="slds-media__body">
                            <div class="slds-page-header__name">
                                <div class="slds-page-header__name-title">
                                    <h1>
                                        <span>Mail Order Pharmacy</span>
                                        <span class="slds-page-header__title slds-truncate" title={memberName}>{memberName}</span>
                                    </h1>
                                </div>
                            </div>
                        </div>
                    </div>
					<div class="slds-grid_align-spread slds-grid_vertical-align-center">
						<div class="icons-container slds-grid">                            
							<template for:each={memberIcons} for:item="item">
                                <template if:true={item.bIconVisible}>
                                    <div key={item.sIconName} class="member-icons slds-p-top_medium slds-p-right_large slds-is-relative">
                                        <image key={item.sIconName} src={item.sDocumentId} class="icon-member"
                                            title={item.sIconLabel} style="height: 24px; width: 24px;"></image>									
                                    </div>   
                                </template>                                              
							</template> 
						</div> 
					</div> 
                </div> 
				 <!--Alert component-->
                
                 <div class="alertContainer"><c-account-detail-view-alerts-hum record-id={urlAccoutId} other-page-name="Mail Order Pharmacy" member-plan-record-id={memberPlanId}>
                </c-account-detail-view-alerts-hum>
                </div>
                <template if:true={bShowDemographicsWarning}>
                    <lightning-icon icon-name="utility:warning" size="medium" class="slds-var-p-right_small"
                                alternative-text="Warning!" title="Warning" variant="error">
                            </lightning-icon>
                            </template> 
                 <lightning-button label="Verify Demographics" title="Verify Demographics" class="slds-float_right"  onclick={verifyDemographicsData}></lightning-button>                
                 <lightning-button label="New Case" title="New Case" class="slds-float_right"  onclick={newCaseClick}></lightning-button>                
								 <template if:true={bCreatingCase}>
                        <div class="exampleHolder">
                            <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
                        </div>
                 </template>
				<!--Add Presciption Popover-->

                <section style={getStyle}
                    aria-describedby="dialog-body-id-107"
                   class="slds-popover slds-popover_prompt slds-popover_prompt_top-right"
                    role="dialog" if:true={showPrescriptionPopover}>
                    <lightning-button-icon icon-name="utility:close" variant="bare"
                        class="slds-button slds-button_icon slds-button_icon-small slds-float_right slds-popover__close"
                        title="close" style="margin-top:6px;" onclick={hidePrescriptionPopover} label="Close">
                    </lightning-button-icon>

                    <header style="border: 1px solid #f3f2f2 ;background-color: white;"
                        class="slds-popover__header slds-m-vertical_xxx-small">
                        <h2 id="dialog-heading-id-3" class="slds-text-heading_small"><b>Prescriptions</b></h2>
                    </header>

                    <div class="" id="dialog-body-id-107">
                        <div class="slds-media">
                            <div class="slds-media__body">
                                <div class="slds-form-element slds-m-around_small">
                                    <div
                                        class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right">
                                        <lightning-icon
                                            class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default"
                                            aria-hidden="true" icon-name="utility:search" alternative-text="Search"
                                            size="xx-small" title="xx-small size"></lightning-icon>
                                        <input type="text" id="text-input-id-50" placeholder="Search" class="slds-input"
                                            onkeyup={searchPrescription} />
                                    </div>
                                </div>
                                <div class="slds-m-around_small">{selectedPrescriptionCount} item(s) selected</div>
								<div class="slds-scrollable_y" style={getInnerDivStyle}>
                                <template if:true={finalPrescriptionList}>
                                    <template for:each={finalPrescriptionList} for:item="prescription">
                                        <c-pharmacy-add-prescription-card key={prescription.key}
                                            item={prescription.prescriptions} icon={prescription.icon}
                                            onprescriptionselect={handlePrescriptionSelect}
                                            added-to-cart={prescription.AddedtoCart}	
                                            order-eligible={prescription.OrderEligible}
                                            checked={prescription.Checked}>
                                        </c-pharmacy-add-prescription-card>
                                    </template>
                                </template>
								</div>
                            </div>
                        </div>
                    </div>

                    <div class="slds-grid slds-grid_vertical-align-center slds-p-around_small ">
                        <button class="slds-button slds-button_brand slds-col_bump-left"
                            onclick={passToCreateOrder} label="Ok">Ok</button>
                    </div>

                </section>

			</div>
            <div class="slds-page-header__row slds-page-header__row_gutters">
                <div class="slds-page-header__col-details">
                    <lightning-layout horizontal-align="spread" class="slds-page-header__detail-row">
                        <lightning-layout-item flexibility="auto" padding="around-small">
                            <div class="slds-text-title slds-truncate" title="Account ID">Account ID</div>
                            <div class="slds-truncate" title={accoutId}>{accoutId}</div>
                        </lightning-layout-item>
                        <lightning-layout-item flexibility="auto" padding="around-small">
                            <div class="slds-text-title slds-truncate" title="Date of Birth">Date of Birth</div>
                            <div class="slds-truncate" title={memberDOB}>{memberDOB}</div>
                        </lightning-layout-item>
                        <lightning-layout-item flexibility="auto" padding="around-small">
                            <div class="slds-text-title slds-truncate" title="Shipping Address">Shipping Address</div>
                            <!-- <div title={shippingAddress}>{shippingAddress}</div> -->
                            <div title={shippingAddress}><lightning-formatted-address
                                street={shippingAddressStreet}
                                city={shippingAddressCity} disabled></lightning-formatted-address>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item flexibility="auto" padding="around-small">
                            <div class="slds-text-title slds-truncate" title="Email">Email</div>
                            <div class="slds-truncate" title={memberEmail}>{memberEmail}</div>
                        </lightning-layout-item>
                        <template if:true={isBalanceDue}>
                            <lightning-layout-item flexibility="auto" padding="around-small">
                                <div class="slds-text-title slds-truncate" title="Account Balance">Account Balance</div>
                                <div class="slds-truncate slds-text-color_error"><lightning-formatted-number value={balanceDue} format-style="currency" currency-code="USD"
                                    currency-display-as="symbol"></lightning-formatted-number>
                                </div>
                            </lightning-layout-item>
                        </template>
                        <template if:true={isBalanceZero}>
                            <lightning-layout-item flexibility="auto" padding="around-small">
                                <div class="slds-text-title slds-truncate" title="Account Balance">Account Balance</div>                            
                                <div class="slds-truncate"><lightning-formatted-number value={balanceDue} format-style="currency" currency-code="USD"
                                    currency-display-as="symbol"></lightning-formatted-number>
                                </div>
                            </lightning-layout-item>
                        </template>
                        <template if:true={isBalanceCredit}>
                            <lightning-layout-item flexibility="auto" padding="around-small">
                                <div class="slds-text-title slds-truncate" title="Account Balance">Account Balance</div>
                                <div class="slds-truncate"><lightning-formatted-number value={balanceDue} format-style="currency" currency-code="USD"
                                    currency-display-as="symbol"></lightning-formatted-number>
                                </div>
                            </lightning-layout-item>
                        </template>
                        <lightning-layout-item flexibility="auto" padding="around-small">
                            <div class="slds-text-title slds-truncate" title="Account Limit">Account Limit</div>
                            <div class="slds-truncate"><lightning-formatted-number value={accountLimit} format-style="currency" currency-code="USD"
                                currency-display-as="symbol"></lightning-formatted-number>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item flexibility="auto" padding="around-small">
                            <div class="slds-text-title slds-truncate" title="Medication Therapy Management (MTM) Eligibility">MTM Eligibility</div>
                            <div class="slds-truncate mtmCheckbox-align"><lightning-input type="checkbox" name="cbkMTM" disabled="true" checked={mtmElegibility}></lightning-input></div>
                        </lightning-layout-item>
                    </lightning-layout>
                    
                </div>
            </div>
        </div>
		</template>
    </template>   
</template>