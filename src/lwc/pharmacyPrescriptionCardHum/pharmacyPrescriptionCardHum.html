<template>
  <div class="slds-is-relative">
    <div data-id="maindiv" class="container custom-box slds-box slds-p-around_medium slds-text-align_center slds-is-relative"
    style="cursor: pointer;min-height: 210px;"  onblur={handleblur} >
    <template if:false={isAddToCart}>
        <div class="triangle" onclick={openPopOver}>
        
        </div>
        <lightning-icon onclick={openPopOver} class="dot" icon-name="utility:threedots" size="x-small"></lightning-icon>
    </template>
    <template if:true={isAddToCart}>
        <div class="selectedtriangle" onclick={openPopOver}></div>
        <lightning-icon class="dot iconcolor" icon-name="utility:check" size="x-small"></lightning-icon>
    </template>
    
    <lightning-layout multiple-rows="true">
        <lightning-layout-item size="12" style="text-align: center" class="rxnumber">
            <p style="text-align: center">
                RX:<span style="color: rgb(1, 118, 211);"  onclick={cardClick}>{item.RXNumber}</span>
            </p>
        </lightning-layout-item>
        <lightning-layout-item size="12" class="drugcontent" style="min-height: 45px;">
            <p style="text-align: center;font-weight: bold;" class="slds-wrap">
                {item.DispensedDrug}
            </p>
        </lightning-layout-item>
        <lightning-layout-item size="12" class="dispenseddrug">
            <p>Dispensed Drug</p>
        </lightning-layout-item>
        <lightning-layout-item size="12" class="slds-m-top_xx-small">
            <template if:true={icon}>
                    <template if:true={icon.customicon}>
                        <template if:true={icon.eventicon}>
                            <span style="position: relative;">
                                <lightning-icon style="opacity: 0.5;" icon-name="utility:event" size={icon.iconsize}></lightning-icon>
                                <template if:true={item.RefillsRemaining}>
                                    <template if:true={checkrefilllength}>
                        
                                        <span class="refill7">{item.RefillsRemaining}</span>

                                    </template>

                                    <template if:false={checkrefilllength}>

                                        <span class="refill6">{item.RefillsRemaining}</span>

                                    </template>
                                </template>
                            </span>
                        </template>
                        <template if:true={icon.iconnamemedication}>
                            <span style="position: relative;">
                                <lightning-icon style="opacity: 0.5;" icon-name="standard:medication_ingredient" size={icon.iconsize} class={icon.iconclass}></lightning-icon>
                                <template if:true={item.RefillsRemaining}>
                                    <template if:true={checkrefilllength}>
                        
                                        <span class="refill5">{item.RefillsRemaining}</span>

                                    </template>

                                    <template if:false={checkrefilllength}>

                                        <span class="refill4">{item.RefillsRemaining}</span>

                                    </template>
                                </template>
                            </span>
                        </template>
                        <template if:true={icon.greenclockicon}>
                            <span class="slds-icon_container greenclock">
                                <svg focusable="false" data-key="today" aria-hidden="true" viewBox="0 0 100 100" class="slds-icon slds-icon_medium">
                                    <g>
                                        <path d="M50 20c-16.5 0-30 13.5-30 30s13.5 30 30 30 30-13.5 30-30-13.5-30-30-30zm0 54c-13.2 0-24-10.8-24-24s10.8-24 24-24 24 10.8 24 24-10.8 24-24 24z"></path><path d="M53 48.8V36c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v14c0 .8.3 1.6.9 2.1l9.6 9.6c.8.8 2 .8 2.8 0l1.4-1.4c.8-.8.8-2 0-2.8L53 48.8z"></path>
                                    </g>
                                </svg>
                            </span>
                        </template>
                        <template if:true={icon.blueclockicon}>
                            <span class="slds-icon_container blueclock">
                                <svg focusable="false" data-key="today" aria-hidden="true" viewBox="0 0 100 100" class="slds-icon slds-icon_medium">
                                    <g>
                                        <path d="M50 20c-16.5 0-30 13.5-30 30s13.5 30 30 30 30-13.5 30-30-13.5-30-30-30zm0 54c-13.2 0-24-10.8-24-24s10.8-24 24-24 24 10.8 24 24-10.8 24-24 24z"></path><path d="M53 48.8V36c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v14c0 .8.3 1.6.9 2.1l9.6 9.6c.8.8 2 .8 2.8 0l1.4-1.4c.8-.8.8-2 0-2.8L53 48.8z"></path>
                                    </g>
                                </svg>
                            </span>
                        </template>
                        <template if:true={icon.bluecalendaricon}>
                            <span style="position: relative;" class="slds-icon_container bluecalendar">
                                <svg style="opacity: 0.5;" focusable="false" data-key="event" aria-hidden="true" viewBox="0 0 100 100" class="slds-icon slds-icon_medium">
                                    <g>
                                        <path  d="M76 42H24c-1.1 0-2 .9-2 2v30c0 3.3 2.7 6 6 6h44c3.3 0 6-2.7 6-6V44c0-1.1-.9-2-2-2zM40 70c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2v-4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v4zm0-14c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2v-4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v4zm14 14c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2v-4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v4zm0-14c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2v-4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v4zm14 14c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2v-4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v4zm0-14c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2v-4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v4zM72 26h-5v-2c0-2.2-1.8-4-4-4s-4 1.8-4 4v2H41v-2c0-2.2-1.8-4-4-4s-4 1.8-4 4v2h-5c-3.3 0-6 2.7-6 6v2c0 1.1.9 2 2 2h52c1.1 0 2-.9 2-2v-2c0-3.3-2.7-6-6-6z"></path>
                                    </g>
                                </svg>
                                 <template if:true={item.RefillsRemaining}>

                                    <template if:true={checkrefilllength}>

                                        <span class="refill2">{item.RefillsRemaining}</span>

                                    </template>

                                    <template if:false={checkrefilllength}>

                                        <span class="refill1">{item.RefillsRemaining}</span>

                                    </template>

                                </template>
                            </span>
                        </template>
                    </template>
                <template if:false={icon.customicon}>
                    <div class={icon.iconclass}>
                        <lightning-icon class="slds-icon slds-icon_small "  icon-name={icon.iconvalue} size={icon.iconsize} ></lightning-icon>
                    </div> 
                </template>           
            </template>
        </lightning-layout-item>
        <lightning-layout-item size="12"  class="slds-m-top_xx-small">
            <div class="slds-border_top"></div>
        </lightning-layout-item>
        <lightning-layout-item size="12"  class="slds-m-top_xx-small">
            <div class="slds-grid slds-gutters">
                <div class="slds-col slds-size_4-of-12">
                    <lightning-layout multiple-rows="true">
                        <lightning-layout-item size="12">
                            <p style="text-align: left; font-size: 11px;">Status</p>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" class="slds-m-top_xx-small">
                            <p style="text-align: left; font-size: 11px;">{item.Status}</p>
                        </lightning-layout-item>
                    </lightning-layout>
                </div>
                <div class="slds-col slds-size_3-of-12">
                    <lightning-layout multiple-rows="true">
                        <lightning-layout-item size="12">
                            <p style="text-align: center; font-size: 11px;">Qty/Sply</p>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" class="slds-m-top_xx-small">
                            <p style="text-align: center; font-size: 11px;">{item.Quantity}/{item.DaysSupply}</p>
                        </lightning-layout-item>
                    </lightning-layout>
                </div>
                <div class="slds-col slds-size_5-of-12">
                    <lightning-layout multiple-rows="true">
                        <lightning-layout-item size="12">
                            <p style="text-align: right; font-size: 11px;">Expiration</p>
                        </lightning-layout-item>
                        <lightning-layout-item size="12" class="slds-m-top_xx-small">
                            <p style="text-align: right; font-size: 11px;">{item.ExpirationDate}</p>
                        </lightning-layout-item>
                    </lightning-layout>
                </div>
            </div>
        </lightning-layout-item>
        <lightning-layout-item size="12">
            <div class="slds-border_top"></div>
        </lightning-layout-item>
        <lightning-layout-item size="12" class="slds-m-top_xx-small">
            <div class="slds-grid slds-gutters">
                <div class="slds-col">
                    <lightning-layout>
                        <lightning-layout-item size="6">
                            <p style="text-align: left; font-size: 11px;">
                                Next Fill Date
                            </p>
                        </lightning-layout-item>
                        <lightning-layout-item size="6">
                            <p style="text-align: right; font-size: 11px;">
                                {item.NextFillDate}
                            </p>
                        </lightning-layout-item>
                    </lightning-layout>
                </div>
            </div>
        </lightning-layout-item>
    </lightning-layout>
</div>
<template if:true={popOver}>
<section aria-labelledby="dialog-heading-id-5" aria-describedby="popover-body-id" onblur={closePopOver} class="slds-popover slds-popover_small slds-popover_prompt slds-popover_prompt_top-right popoverSection" role="tooltip">
    <div class="slds-popover__body" id="dialog-body-id-109" >
    <div class="slds-media">
        
    <div class="slds-media__body">
        <div>
            <div class="slds-col slds-size_4-of-4 slds-box_xx-small">
                <span style="cursor:pointer; font-size: small;"
                                    class="slds-text-heading_medium slds-float_right "
                                    onclick={closePopOver}>X</span>
            </div>
            <template if:true={checkordereligible}>
                <div class="slds-p-vertical_small slds-align_absolute-center">
                    <div class="slds-col slds-size_1-of-4 ">
                        <template if:true={isAddToCart}>
                                <lightning-icon size="x-small"
                                class="slds-icon slds-input__icon blue-icon slds-p-around-small slds-m-around-small"
                                icon-name="utility:check" ></lightning-icon>
                        </template>
                    </div>
                    
                    <div class="slds-col slds-size_3-of-4 ">
                        <span style="font-size: 13px;" onclick={handleAddCartClick}>Add to Cart</span></div>
                    </div>
            </template>
    </div>
       <template if:false={checkordereligible}>
            <div class="slds-align_absolute-center slds-p-vertical_small">
                <span style="font-size: 13px; color: rgb(202, 207, 211)" >Add to Cart</span>
            </div>
        </template>
       <template if:true={AutoRefillEligibilty}>
           <p style="font-size: 13px; text-align:center;">Auto Refill</p>
           <div class="slds-form-element slds-align_absolute-center">
               <label class="slds-checkbox_toggle slds-grid slds-align_absolute-center" style="text-align:center;">
                   <input type="checkbox" name="checkbox-toggleCapType" value="" style="text-align:center;"
                          aria-describedby="Auto Refill" onchange={toggleAutoRefill} checked={autoFillFlag} />
                   <span id="checkbox-toggle-captype1" class="slds-checkbox_faux_container"
                         aria-live="assertive">
                       <span class="slds-checkbox_faux"></span>
                       <span class="slds-checkbox_on" style="font-size: 14px;text-align:left;">Yes</span>
                       <span class="slds-checkbox_off" style="font-size: 14px;text-align:left;">No</span>
                   </span>
               </label>
           </div>
       </template>
    </div>
    </div>
    </div>
</section>
</template>
<template if:true={openAutoRefillModal}>
    <div class="slds-modal slds-fade-in-open slds-backdrop">
        <div class="slds-modal__container">
            <template if:true={autoFillFlag}>
                <!------HEADER Section-->
                <div class="slds-modal__header">
                    <lightning-button-icon icon-name="utility:close" alternative-text="Close this window" size="large"
                        variant="bare-inverse" onclick={closeModal} class="slds-modal__close">
                    </lightning-button-icon>
                    <h1 class="slds-text-heading_large">Remove Auto-fill for this medication?</h1>
                </div>
                <!------Body Section-->
                <div class="slds-modal__content slds-var-p-around_medium">
                    <P class="slds-text-align_center slds-var-m-top_xx-large slds-var-m-bottom_xx-large">This medication is
                        currently set to be auto-filled.<br> Are you sure you want to remove it from auto-fill? 
                    </P>
                </div>
            </template>
            <template if:false={autoFillFlag}>
                 <!------HEADER Section-->
                <div class="slds-modal__header">
                    <lightning-button-icon icon-name="utility:close" alternative-text="Close this window" size="large"
                        variant="bare-inverse" onclick={closeModal} class="slds-modal__close">
                    </lightning-button-icon>
                    <h1 class="slds-text-heading_large">Auto-Fill this medication?</h1>
                </div>
                <div class="slds-modal__content slds-var-p-around_medium">
                    <P class="slds-text-align_center slds-var-m-top_xx-large slds-var-m-bottom_xx-large">You are about to set this medication to be
                        <br> auto-filled. Are you sure?
                   </P>
                </div>
            </template>
            <!------Footer Section-->
            <div class="slds-modal__footer">
                <lightning-button label="No" title="No" onclick={closeModal} class="slds-var-m-right_small">
                </lightning-button>
                <lightning-button label="Yes" variant="brand" onclick={updateAutoFill}></lightning-button>
            </div>
        </div>
    </div>
</template>
</div>
</template>