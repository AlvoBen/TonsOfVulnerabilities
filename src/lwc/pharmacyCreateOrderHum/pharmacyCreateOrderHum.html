<!--
Component        : PharmacyCreateOrderHum
Version          : 1.0
Created On       : 10/14/2021
Function         : Component to create order for pharmacy

Modification Log:
* Developer Name                    Date                         Description
* Nirmal Garg                      10/14/2021                   Original Version
* Nirmal Garg					   04/05/2022					US3198914 - Added case comment logging logic.
* Kalyani Pachpol		           07/29/2022                   US-3614274
* Kalyani Pachpol                  08/04/2022                   US-3614274
* Kalyani Pachpol                  08/11/2022                   DF-5835
* Aishwarya Pawar                  08/24/2022                   DF-5946
* Swapnali Sonawane                11/01/2022                   US- 3729809 Migration of the UI enhancements in the addresses section
* Jonathan Dickinson               01/20/2023                   User Story 4146084: T1PRJ0865978 - MF 23528 -SF - TECH Mail Order Pharmacy- Address/Close the gaps identified during user testing. - 3
* Nirmal Garg						  07/27/2023	                US4902305
*------------------------------------------------------------------------------------------------------------------------------
-->
<template>
    <lightning-card>
        <template if:true={loaded}>
            <div class="slds-grid slds-grid_align-spread topdiv">
                <div class="slds-col">
                    <lightning-icon size="x-small" style="cursor: pointer;"
                                    class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default"
                                    icon-name="utility:back" onclick={goToSummary}>
                    </lightning-icon>
                    <b class="slds-text-body_regular">Order</b>
                </div>
                <div class="slds-col">
                    <lightning-button label="Add Prescription" title="Add Prescription" onclick={handleAddPrescription}>
                    </lightning-button>
                </div>
            </div>
            <div class="slds-gutters slds-grid slds-m-top_x-small">
                <div class="slds-col slds-size_2-of-12">
                    <c-generic-date-selector dlabel="Release" dkeyname="ReleaseDate" dminvalue={sMinDate}
                                             dvalue={sStartDate} oninvaliddate={handleInvalidReleaseDate} onsenddatedata={handleDateChange}>
                    </c-generic-date-selector>
                </div>
                <div class="slds-col slds-size_2-of-12">
                    <div class="slds-m-top_large">
                        <span> Cap Type : {capType}</span>
                    </div>
                </div>
            </div>
            <div class="slds-grid slds-grid_align-spread slds-m-top_x-small slds-wrap">
                <div class="slds-col slds-size_1-of-1">
                    <template if:true={prescriptions}>
                        <template for:each={prescriptions} for:item="item">
                            <div key={item.prescriptions.RXNumber} class="slds-var-m-top_x-small">
                                <c-pharmacy-create-order-prescription-hum item={item}
                                                                          onremovepres={handleRemovePrescription}>
                                </c-pharmacy-create-order-prescription-hum>
                            </div>
                        </template>
                    </template>
                </div>
            </div>
            <div class="slds-grid slds-grid_align-spread slds-m-top_x-small slds-wrap">
                <div class="slds-col">
                    <div class="slds-text-body_regular"><strong>Shipping Details</strong></div>
                </div>
                <div class="slds-col">
                    <div class="slds-grid slds-grid_align-end slds-gutters">
                        <div class="slds-col">
                        </div>
                        <div class="slds-col">
                            <lightning-button label="New Credit Card" title="New Credit Card" onclick={handleNew}>
                            </lightning-button>
                        </div>
                        <div class="slds-col">
                            <lightning-button label="Edit Credit Card" title="Edit Credit Card"
                                              onclick={handleEdit}>
                            </lightning-button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slds-grid slds-grid_align-spread slds-m-top_x-small">
                <div class="slds-col slds-size_4-of-12">
                    <lightning-combobox name="progress" label="Shipping Method" value={selectedShippingMethod}
                                        placeholder="Shipping Method" options={shippingoptions}
                                        onchange={handleShippingChange} required
                                        dropdown-alignment="auto">
                    </lightning-combobox>
                </div>
                <div class="slds-col slds-size_6-of-12">
                    <lightning-combobox name="progress" label="Payment Method" value={paymentMethod}
                                        placeholder="Credit Card" options={lstPaymentMethods}
                                        onchange={handlePaymentChange} required
                                        dropdown-alignment="auto">
                    </lightning-combobox>
                </div>
            </div>
            <div class="slds-grid slds-grid_align-spread slds-m-top_x-large">
                <div class="slds-col slds-size_1-of-1">
                    <c-pharmacy-modify-shipping-address onshowcaseblock={handleShowCase} enterprise-id={enterpriseId} record-id={recordId}
                                                        network-id={networkId} pharmacymemberaddresss={pharmacyaddress}
                                                        pharmacymemberdetails={pharmacydemodetails} onshippingaddress={updateShippingAddress}
                                                        dropdown-alignment="auto" onaddaddressclick={handleAddAddress}
                                                        onaddresscasedata={getAddressCaseData} onshippingaddresscomments={getAddressComments}>
                    </c-pharmacy-modify-shipping-address>
                </div>
            </div>
            <div class="slds-grid slds-grid_align-spread slds-var-m-top_small">
                <div class="slds-col slds-size_1-of-1">
                    <div class="createeditcreditcard">
                        <template if:true={isCreateAndEditCreditCardVisible}>
                            <c-pharmacy-create-and-edit-credit-card-hum record-id={recordId} enterprise-id={enterpriseId}
                                                                        network-id={networkId} component-mode={createAndEditCreditCardComponentMode}
                                                                        credit-card-data={creditCardData} selected-row-data={selectedRowData}
                                                                        onsave={handleSave}
                                                                        oncancel={handleCancel} oncreditcardcomment={getCreditCardComment}
                                                                        onaddresscasedata={getAddressCaseData} order={isCreateOrder}>
                            </c-pharmacy-create-and-edit-credit-card-hum>
                        </template>
                    </div>
                </div>
            </div>
        </template>
        <template if:false={loaded}>
            <lightning-spinner alternative-text="Loading...">
            </lightning-spinner>
        </template>
        <template if:true={showCaseCommentBox}>
            <c-generic-case-comment-logging record-id={recordId} responseobj={createOrderDataObj}
                                            onsavedata={handleSubmitClick} submit={isSubmit} disabled={submitDisabled} oncancel={handleCancelClick} onfinish={handleFinishLogging} is-credit-card={isCreditcard} pharmacy-temp={isPharmacyTemp} hide-popover={isPharmacyTemp}>
            </c-generic-case-comment-logging>
        </template>
    </lightning-card>
</template>