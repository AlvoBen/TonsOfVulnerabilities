<!--
LWC Name        : pharmacyOrderDetailsHum.html
Function        : LWC to display pharmacy order details.

Modification Log:
* Developer Name                  Date                         Description
*
* Abhishek Mangutkar              03/04/2022                   US - 3103531
* Abhishek Mangutkar              03/09/2022                   US - 3139633
* Nirmal Garg					  03/15/2022		      	   DF-4616 fix.
* Swapnali Sonawane               12/05/2022                   US- 3969790 Migration of the order queue detail capability
* Ceasar Sabarre                   03/02/2023                   US4315363 Previously logged items pharmacy views
****************************************************************************************************************************-->
<template>
    <template if:true={orderdetails.OrderNumber}>
        <div class="slds-grid">
            <c-previously-logged-cmp-hum s-member-id={recordid} s-order-number={orderdetails.OrderNumber}></c-previously-logged-cmp-hum>
        </div>
    </template>
    <lightning-card class="slds-var-p-left_medium">
        <div class="slds-scrollable_y" style="height: 400px;" onscroll={handlescroll}>
            <template if:true={showCurrentQueueButtons}>
                <lightning-button-group class="slds-float_right slds-m-right_medium">
                    <template for:each={oButtonModel} for:item="item">
                        <lightning-button if:true={item.visible} onclick={handleCurrentQueueButtonClick} data-id={item.label} label={item.label} title={item.label} key={item.label}></lightning-button>
                    </template>
                </lightning-button-group>
            </template>
            <div>
                <lightning-icon icon-name="utility:back" style="cursor: pointer" size="small" class="slds-float_left slds-var-p-top_small slds-var-p-right_small slds-var-p-left_small" title="Back" onclick={backToOrderSummaryPage}></lightning-icon>
            </div>
            <div>
                <h3 class="slds-var-m-left_xx-large">
                    <span class="slds-page-header__title slds-truncate" title="Order Number">Order # {orderdetails.OrderNumber}</span>
                </h3>
            </div>
            <div class="slds-var-p-top_small">Web # {webOrder}</div>
            <template if:true={loaded}>
                <div class="slds-p-around_medium">
                    <lightning-layout multiple-rows="true">
                        <lightning-layout-item size="12">
                            <div class="slds-grid slds-gutters slds-p-around_small">
                                <div class="slds-col slds-size_3-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Shipping Method</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue slds-wrap">
                                                {orderDetailsResponse.ShippingMethod}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_3-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Payer</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue slds-wrap">{payer}</p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_1.5-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Status</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {orderdetails.OrderStatusLiteral}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_1-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel slds-float_right">Carrier</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue slds-float_right">
                                                {orderDetailsResponse.Carrier}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_2-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Tracking Number</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12" class="slds-truncate_container_75">
                                            <p class="slds-text-link slds-truncate "
                                               style=" font-size: 12px;cursor:pointer;" onclick={trackingNumberPopUp}
                                               title={orderDetailsResponse.ShippingTrackingNumber}>
                                                {orderDetailsResponse.ShippingTrackingNumber}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>

                                <div class="slds-col slds-size_3-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Cancel Reason</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {orderDetailsResponse.CancelReasonCode}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>

                                <div class="slds-col slds-size_2-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="12">
                            <div class="slds-grid slds-gutters slds-p-around_small">
                                <div class="slds-col slds-size_3-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Shipping Address</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {orderDetailsResponse.ShippingAddress}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_3-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="slds-float_left" style=" font-size: 11px;">Current Order Queue</p>
                                            <lightning-button-icon icon-name="utility:refresh" size="small"
                                                                   alternative-text="Refresh" class="slds-var-p-left_small iconcolor"
                                                                   title="Refresh" onclick={getOrderDetails}></lightning-button-icon>

                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {orderDetailsResponse.CurrentQueue}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <template if:true={checkCode}>
                                    <div class="slds-col slds-size_2-of-12">
                                        <lightning-layout multiple-rows="true">
                                            <lightning-layout-item size="12">
                                                <p class="authlabel">Finance Code</p>
                                            </lightning-layout-item>
                                            <lightning-layout-item size="12">
                                                <p class="authvalue">
                                                    {orderDetailsResponse.Finance}
                                                </p>
                                            </lightning-layout-item>
                                        </lightning-layout>
                                    </div>
                                </template>

                                <div class="slds-col slds-size_1-of-12 ">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Creation</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {orderdetails.OrderCreationDate}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_1-of-12 ">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12" class="slds-var-p-left_x-large">
                                            <p class="authlabel">Release</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12" class="slds-var-p-left_x-large">
                                            <p class="authvalue">
                                                {orderdetails.OrderReleaseDate}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_1-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12" class="slds-var-p-left_xx-large">
                                            <p class="authlabel">Finished</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12" class="slds-var-p-left_xx-large">
                                            <p class="authvalue">
                                                {orderDetailsResponse.OrderShipDate}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                            </div>


                        </lightning-layout-item>
                    </lightning-layout>
                </div>
                <div class="slds-p-around_small">
                    <div class="custom-box slds-box slds-p-around_medium" style="min-height:300px;">
                        <lightning-layout-item size="12">
                            <div class="slds-grid slds-gutters">
                                <div class="slds-col slds-size_2-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Payment Method</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {orderDetailsResponse.CreditCard}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_1-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">OTC</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">{orderdetails.OTC}</p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_1.5-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Source</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {orderdetails.OrderSource}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_2-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">CAP Type</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p class="authvalue">
                                                {capType}
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_2-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Order Total</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p>
                                                <lightning-formatted-number value={orderdetails.OrderTotalAmount}
                                                                            format-style="currency" currency-code="USD"
                                                                            maximum-fraction-digits="2" class="authvalue">
                                                </lightning-formatted-number>

                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_2-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Order Copay</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p>
                                                <lightning-formatted-number value={orderdetails.OrderpayAmount}
                                                                            format-style="currency" currency-code="USD"
                                                                            maximum-fraction-digits="2" class="authvalue">
                                                </lightning-formatted-number>
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                                <div class="slds-col slds-size_2-of-12">
                                    <lightning-layout multiple-rows="true">
                                        <lightning-layout-item size="12">
                                            <p class="authlabel">Order Tax</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item size="12">
                                            <p>
                                                <lightning-formatted-number value={orderdetails.OrderTaxAmount}
                                                                            format-style="currency" currency-code="USD"
                                                                            maximum-fraction-digits="2" class="authvalue">
                                                </lightning-formatted-number>
                                            </p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </div>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="12">
                            <div class="slds-border_top slds-var-p-top_large"></div>
                        </lightning-layout-item>
                        <div>
                            <h3>
                                <span class="slds-page-header__title slds-truncate" title="Order Items">Order Items</span>
                            </h3>
                        </div>

                        <template if:true={orderparentnode}>
                            <c-pharmacy-order-detail-items-hum onsplitorderclick={getSplitOrderDetails} orderparentnode={orderparentnode} payer={payer} orderprescription={orderDetailPrescriptions}></c-pharmacy-order-detail-items-hum>
                        </template>
                    </div>
                </div>
            </template>
        </div>
        <template if:true={isQueueAvailable}>
            <div class="slds-grid slds-wrap">
                <div class="slds-col slds-size_1-of-1">
                    <c-pharmacy-order-queue-details-hum queuedata={QueueData}></c-pharmacy-order-queue-details-hum>
                </div>
            </div>
        </template>
        <div>
            <c-pharmacy-order-history-timeline-h-u-m orderdetails={orderdetails} recordid={recordid} networkid={networkid} enterpriseid={enterpriseid}></c-pharmacy-order-history-timeline-h-u-m>
        </div>

    </lightning-card>


    <template if:false={loaded}>
        <lightning-spinner alternative-text="Loading"></lightning-spinner>
    </template>
    <c-generic-modal-hum if:true={showReleasePopUpModal} b-show-modal={showReleasePopUpModal} onclose={closeCancelReleasePopUpModal} title={modalTitle}
                         onyes={handleCancelReleaseOrder} onno={closeCancelReleasePopUpModal} buttons-config={buttonsConfig}>
        <div slot="content"
             class="slds-modal__content slds-var-p-around_medium">
            <P class="slds-text-align_center slds-var-m-top_xx-large slds-var-m-bottom_xx-large">{alertBoxMessage}</P>
        </div>
    </c-generic-modal-hum>
    <template if:true={showEditPopUpModal}>
        <div class="slds-modal slds-fade-in-open slds-backdrop">
            <div class="slds-modal__container">
                <!------HEADER Section-->
                <div class="slds-modal__header">
                    <lightning-button-icon icon-name="utility:close" alternative-text="Close this window" size="large"
                                           variant="bare-inverse" onclick={closeEditOrderModal} class="slds-modal__close">
                    </lightning-button-icon>
                    <h3 class="slds-text-heading_large">{modalTitle}</h3>
                </div>
                <!------Body Section-->

                <div class="slds-modal__content slds-var-p-around_medium">
                    <c-pharmacy-order-details-edit-hum pharmacydemodetails={pharmacydemographicdetails} orderdetails={orderdetails} spayer={payer}
                                                       order-details-response={orderDetailsResponse} cap-type={capType} enterprise-id={enterpriseid}
                                                       record-id={recordid} network-id={networkid} orderparentnode={orderparentnode} order-detail-prescriptions={orderDetailPrescriptions}
                                                       onordereditsuccess={handleOrderEditSuccess}>
                    </c-pharmacy-order-details-edit-hum>
                </div>

                <!------Footer Section-->
                <div class="slds-modal__footer">
                    <lightning-button label="Cancel" onclick={cancelEditOrderModal} class="slds-var-m-right_small">
                    </lightning-button>
                    <lightning-button label="Save" variant="brand" onclick={handleSaveEditOrder}
                                      class="slds-var-m-right_small"></lightning-button>
                </div>
            </div>
        </div>
    </template>
</template>