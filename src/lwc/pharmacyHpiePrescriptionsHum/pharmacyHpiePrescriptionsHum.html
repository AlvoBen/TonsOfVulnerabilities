<!--
Function        : LWC to callout HPIE Integration methods from apex .

Modification Log:
* Developer Name                  Date                         Description
****************************************************************************************************************************
* Nirmal Garg                    07/18/2022                 user story 4861950: T1PRJ0870026 - HPIE/CRM - C12 Mail Order Management - Pharmacy - "Details" Tab - Lightning - Patient APIUS-3975339 Change - RTI Icon Display Logic
* Atul Patil                    07/28/2023                  user story 4861950: T1PRJ0870026 - HPIE/CRM - C12 Mail Order Management - Pharmacy - "Details" Tab - Lightning - Patient API
* Isaac Chung                   12/12/2023                 US 5107579 Mail Order Management; Pharmacy- Guided Flow- Inactivate Rx- Implementation (Lightning)
* Vishal Shinde                 02/29/2024                  user story - 5142800: Mail Order Management - Pharmacy - "Prescriptions & Order Summary" tab - Prescriptions â€“ Create Order
* Jonathan Dickinson             02/29/2024                 User Story 4835317: T1PRJ0865978 - MF 27481 - C12; Mail Order Management; Pharmacy - Mail Order Pharmacy page gap- Member Consent (Lightning)
******************************************************************************************************************************-->
<template>
    <template if:false={isCreateOrderClicked}>
        <div>
            <div class="slds-grid slds-grid_align-spread">
                <div class="slds-col">
                    <h3>
                        <span class="slds-page-header__title slds-truncate" title="Member Prescriptions">
                            Member
                            Prescriptions
                        </span>
                    </h3>
                </div>
                <div class="slds-col">
                    <div class="slds-grid slds-grid_align-end slds-gutters">
                        <div class="slds-col">
                            <lightning-button-icon icon-name="utility:refresh" variant="border-filled" size="small"
                                                   alternative-text="Refresh"
                                                   class="slds-var-m-right_small slds-var-m-top_x-small slds-float_right" title="Refresh"
                                                   onclick={refreshData}>
                            </lightning-button-icon>
                        </div>
                        <div class="slds-col">
                            <lightning-button label="Create Order" title="Create Order" onclick={handleCreateOrderClick}
                                              disabled={createOrderDisable} class="slds-float_right">
                            </lightning-button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slds-grid slds-m-top_medium slds-wrap">
                <div class="slds-col slds-size_2-of-12">
                            <c-pharmacy-captype-hum preference-details={preferenceDetails} enterprise-id={enterpriseId}
                                                    user-id={userId}>
                            </c-pharmacy-captype-hum>
                        </div>
                <template lwc:if={isMemberConsentRequired}>
                    <div class="slds-col slds-size_2-of-12">
                            <c-pharmacy-member-consent-hum preference-details={preferenceDetails}
                                enterprise-id={enterpriseId} user-id={userId} oncallpreference={handleCallPreference}
                                onlognoteadded={handleLogNoteAdded} acc-data={accData}>
                            </c-pharmacy-member-consent-hum>
                        </div>
                </template>
                <div class="slds-col slds-size_8-of-12">
                    <div class="slds-grid slds-gutters slds-align-start">
                        <div class="slds-m-horizontal_small buttonPos">
                            <lightning-button variant="brand-outline" label="Inactivate Rx" title="Inactivate RX"
                            onclick={handleInactivateRxClick}></lightning-button>
                        </div>
                        <div class="" >
                            <c-pharmacy100-day-prescrip-hum account-id={recordId}></c-pharmacy100-day-prescrip-hum>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slds-grid slds-m-top_medium slds-wrap slds-gutters">
                <div class="slds-col slds-size_4-of-12">
                    <c-generic-keyword-search-hum minchar="3" placeholder="Filter By" name="searchByWord"
                                                  keyword={keyword} ontextclear={clearSearchData} onkeywordvalue={handleKeywordSearch}>
                    </c-generic-keyword-search-hum>
                </div>
                <div class="slds-col slds-size_4-of-12">
                    <c-generic-multiselect-picklist-hum keyname="status" options={filterStatusValues.status}
                                                        placeholdermessage="Status" onmultiselectfilter={handlePicklistFilter}>
                    </c-generic-multiselect-picklist-hum>
                </div>
                <div class="slds-col slds-size_4-of-12">
                    <lightning-combobox name="sSortBy" onchange={getSortedValue} options={sSortBy} value=""
                                        placeholder="Sort By" variant="label-hidden">
                    </lightning-combobox>
                </div>
            </div>
            <div class="slds-grid slds-grid_align-spread slds-m-top_x-small">
                <div class="slds-col">
                    <template if:true={pillFilterValues}>
                        <template for:each={pillFilterValues} for:item="pill" for:index="ind">
                            <lightning-pill class="slds-m-around_x-small" data-index={ind} data-key={pill.key}
                                            data-value={pill.value} label={pill.value} key={pill.key} onremove={handlePillRemove}>
                            </lightning-pill>
                        </template>
                    </template>
                </div>
            </div>
        </div>
        <div>
            <template if:true={loaded}>
                <template if:true={dataFound}>
                    <div class="slds-grid slds-p-bottom_xx-small">
                        <div class="slds-col">
                            <div class="slds-var-m-top_large">
                                <div class="slds-border_top">
                                </div>
                            </div>
                        </div>
                        <div>
                            <lightning-button class="slds-align_absolute-center" variant="brand-outline"
                                              disabled={showMoreDisabled} style="width: 100%;" label="Show More"
                                              onclick={showMoreCards}>
                            </lightning-button>
                        </div>
                        <div class="slds-col">
                            <div class="slds-var-m-top_large">
                                <div class="slds-border_top">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-grid slds-grid_align-end slds-m-top_x-small">
                        <div class="slds-col">
                            <span style="text-align: right;">{filteredCount} of {totalCount} results</span>
                        </div>
                    </div>
                </template>
            </template>
            <template if:true={loaded}>
                <template if:true={serviceerror}>
                    <c-generic-scoped-notification-hum iconname="utility:error"
                                                       message={labels.prescriptionServiceError} type="error">
                    </c-generic-scoped-notification-hum>
                </template>
                <template if:false={serviceerror}>
                    <template if:true={dataFound}>
                        <div class="slds-scrollable_y" style="max-height: 400px;" onscroll={handleScroll}>
                            <lightning-layout multiple-rows="true">
                                <template if:true={finalFilteredPrescription}>
                                    <template for:each={finalFilteredPrescription} for:item="prscription"
                                              for:index="index">
                                        <template if:true={prscription.detailSection}>
                                            <lightning-layout-item size="3" key={prscription.counter}
                                                                   class="slds-p-around_xx-small"
                                                                   style="cursor: pointer;min-height: 210px;">
                                                <c-pharmacy-hpie-prescription-card-hum oncardclickselect={handleCardClickSelect} onaddcart={handleAddCart}
                                                                                       prckey={prscription.counter} item={prscription}
                                                                                       addtocart={prscription.addedToCart}
                                                                                       selectedindex={prscription.detailCounter}
                                                                                       enterprise-id={enterpriseId} icon={prscription.icon}
                                                                                       onupdateautoreill={handleAutoRefill} user-id={userId}
                                                                                       order-eligible={prscription.orderEligible}>
                                                </c-pharmacy-hpie-prescription-card-hum>
                                            </lightning-layout-item>
                                            <lightning-layout-item class="detailsection" size="12"
                                                                   key={prscription.counter} data-id={prscription.detailCounter}
                                                                   style="display:none;" data-value={prscription.detailCounter}>
                                                <c-pharmacy-hpie-prescription-details-hum oncardclose={handleCloseClick}
                                                                                          prescription={prscription}
                                                                                          prckey={prscription.counter} icon={prscription.icon}
                                                                                          onaddorder={handleAddCart} is-member-consent-required={isMemberConsentRequired}>
                                                </c-pharmacy-hpie-prescription-details-hum>
                                            </lightning-layout-item>
                                        </template>
                                        <template if:false={prscription.detailSection}>
                                            <lightning-layout-item size="3" key={prscription.counter}
                                                                   class="slds-p-around_xx-small"
                                                                   style="cursor: pointer;min-height: 210px;">
                                                <c-pharmacy-hpie-prescription-card-hum oncardclickselect={handleCardClickSelect}
                                                                                       order-eligible={prscription.orderEligible}
                                                                                       prckey={prscription.counter} item={prscription}
                                                                                       onaddcart={handleAddCart}
                                                                                       addtocart={prscription.addedToCart} enterprise-id={enterpriseId}
                                                                                       selectedindex={prscription.detailCounter} icon={prscription.icon}
                                                                                       user-id={userId} onupdateautoreill={handleAutoRefill}>
                                                </c-pharmacy-hpie-prescription-card-hum>
                                            </lightning-layout-item>
                                        </template>
                                    </template>
                                </template>
                            </lightning-layout>
                        </div>
                    </template>
                    <template if:false={dataFound}>
                        <div class="slds-grid slds-wrap">
                            <div class="slds-col slds-size_1-of-1 slds-m-top_small slds-wrap">
                                <c-generic-scoped-notification-hum iconname="utility:info"
                                                                   message="No active Prescriptions are available for selected member.">
                                </c-generic-scoped-notification-hum>
                            </div>
                        </div>
                    </template>
                </template>
            </template>
            <template if:false={loaded}>
                <lightning-spinner alternative-text="Loading"></lightning-spinner>
            </template>
        </div>
        <template if:true={openCapTypeModal}>
            <c-pharmacy-update-cap-type-hum cap-type-flag={capTypeFlag} onclosemodal={closeModal}
                                            onupdatecaptype={updateCapTypeValue}></c-pharmacy-update-cap-type-hum>
        </template>
        <template if:true={openMemberConsentModal}>
            <c-pharmacy-update-member-consent-hum member-consent-flag={memberConsentFlag} onclosemodal={closeModal}
                                                  onupdatecaptype={updateMemberConsent}></c-pharmacy-update-member-consent-hum>
        </template>
    </template>
    <template if:true={isCreateOrderClicked}>
        <c-pharmacy-hpie-create-order-hum enterprise-id={enterpriseId} network-id={networkId} record-id={recordId}
                                     prescriptions={addedprescriptions} pharmacydemodetails={pharmacydemographicdetails} preference-details={preferenceDetails}
                                     ongotosummary={goToSummary} onaddprescriptionkey={handleAddPrescription} demographics-details={demographicsDetails} finance-details={financeDetails} user-id={userId} 
                                     final-prescriptions={finalPrescriptions} onpopoverprescription={mycustomevent} onordercreditcardsave={handleCreditCardSave} oncalldemographics ={handleCallDemographics}  onlognoteadded={handleLogNoteAdded} >
        </c-pharmacy-hpie-create-order-hum> 
    </template>
    <template if:false={isCreateOrderClicked}>
        <template if:false={createOrderDisable}>
            <div class="slds-col slds-var-m-top_large slds-p-left_xxx-small createOrder">
                <lightning-button variant="brand" label="Create Order" title="Create Order"
                                  onclick={handleCreateOrderClick} disabled={createOrderDisable} class="slds-float_right">
                </lightning-button>
            </div>
        </template>
    </template>
    <template if:true={flag}>
            <c-pharmacy-add-prescription-popover-hum prescriptions={finalPrescriptions} 
             oncloseaddprescription={handleCloseAddPrescriptionPopover}  onpasstoparentcomponent={handleUpdatePrescriptions} onpasscheckforparentcomponent={handelAddPrescription}></c-pharmacy-add-prescription-popover-hum>
    </template>
    <template if:true={inactivateRxRequest}>
		<c-pharmacy-inactivate-rx-request-hum prescriptions={finalPrescriptions} record-id={recordId} oncloseinactiverx={handleCloseInactivateRx}></c-pharmacy-inactivate-rx-request-hum>
    </template>
</template>