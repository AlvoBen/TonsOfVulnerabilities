<!--
LWC Name        : myAssistantAtHumana
Function        : LWC to display My Assistant At Humana (MyAH) chat requests and answers

Modification Log:
* Developer Name                  Date                         Description
------------------------------------------------------------------------------------------------------------------------------
* Trevor Antle                  07/31/2023                     Initial
* Robert Crispen                08/14/2023                     US-4938550 | Added template check for Chat Assistant User, display error on false
-------------------------------------------------------------------------------------------------------------------------------
-->

<template>
    <template lwc:if={hasChatAssistantUser}>
        <template if:true={showResetWarning}>
            <div class="reset-warning">
                <div class="slds-grid slds-grid_vertical-align-center">
                    <div class="slds-col slds-size_9-of-12 slds-p-left_medium">
                        <span class="slds-icon_container slds-current-color slds-icon-utility-warning" title="Reset Warning">
                            <svg class="slds-icon slds-icon_x-small slds-icon-text-default" aria-hidden="true">
                                <use xlink:href="/apexpages/slds/latest/assets/icons/utility-sprite/svg/symbols.svg#warning"></use>
                            </svg>
                        </span>
                        <span class="reset-warning-text">
                            &nbsp;Resetting chat will remove current chat history. Do you want to proceed?
                        </span>
                    </div>
                    <div class="slds-col slds-size_1-of-12 slds-align_absolute-center slds-p-left_large">
                        <!---
                        <span class="button-grid">
                            <lightning-button
                            style="height: 25px;"
                            variant="brand-outline"
                            label="Yes"
                            title="Confirm Reset"
                            onclick={handleResetWarningButton}
                            data-value="Yes">
                        </lightning-button>
                        </span> -->
                        <button class="slds-button slds-button_outline-brand" style="height:22px" onclick={handleResetWarningButton} data-value="Yes" value="Yes">Yes</button>
                    </div>
                    <div class="slds-col slds-size_1-of-12 slds-align_absolute-center slds-p-left_large">
                        <!---<span class="button-grid">
                            <lightning-button
                            style="height: 25px;"
                            variant="brand-outline"
                            label="No"
                            title="Deny Reset"
                            onclick={handleResetWarningButton}
                            data-value="No">
                        </lightning-button>
                        </span> -->
                        <button class="slds-button slds-button_outline-brand" style="height:22px" onclick={handleResetWarningButton} data-value="No">No</button>
                    </div>
                </div>
            </div>
        </template>
        <div class="header">
            <div class="slds-grid slds-grid_vertical-align-center slds-grid_align-center">
                <div class="slds-col slds-size_4-of-5">
                    <span>
                        <template if:true={showPersonAccountContext}> 
                            <div class="slds-text-heading_small slds-text-title_caps slds-p-around_small">
                                <div class="header-account-details">
                                {accountDetails}
                                <template if:true={showMemberPlanContext}>
                                    <br>
                                    {memberPlanDetails}
                                </template>
                                </div>
                            </div>
                        </template>
        
                        <template if:false={showPersonAccountContext}>
                            <br><br><br>
                        </template>
                    </span>
                  </div>
                  <div class="slds-col slds-size_1-of-5">
                    <span class="button-grid">
                        <lightning-button
                        variant="brand-outline"
                        label="Reset Chat"
                        title="Reset"
                        customvalue="reset"
                        onclick={handleResetButtonClick}
                        class="slds-var-m-left_x-small"
                        data-id="reset">
                    </lightning-button>
                    </span>
                  </div>
            </div>
            <hr>
        </div>

        <div class="chat-body" data-name="chat-body">
            <section role="log" class="slds-chat slds-p-vertical_medium">
                <ul class="slds-chat-list">
                    <div class="messages-container" lwc:dom="manual" data-id="messagesContainer"></div>
                </ul>
            </section>
        </div>

        <!-- Input Message Footer -->
        <div class="input-footer" onkeydown={handleKeyDown}>
            <div class="slds-grid slds-grid_align-center slds-gutters_xx-small">
                <div class="slds-col slds-size_7-of-8">
                    <span>
                        <lightning-input data-name="inputField" label="input" type="text" placeholder="Message..." value={userMessage} onchange={handleUserInputChange} variant="label-hidden" maxlength="255"></lightning-input>
                    </span> 
                </div>
                <div class="slds-col slds-size_1-of-8">
                    <span>
                        <lightning-button data-name="submitButton" label="Submit" onclick={handleSubmit} class="slds-var-m-left_xx-small" variant="outline-brand"></lightning-button>
                    </span>
                </div>
            </div>
        </div>
    </template>

    <template lwc:else>    
        <div class="slds-notify slds-notify_alert slds-alert_error" role="alert">
            <span class="slds-assistive-text">error</span>
            <span class="slds-icon_container slds-icon-utility-error slds-m-right_x-small" title="Access Error">
                <svg class="slds-icon slds-icon_x-small" aria-hidden="true">
                    <use xlink:href="/apexpages/slds/latest/assets/icons/utility-sprite/svg/symbols.svg#error"></use>
                </svg>
            </span>
            <h2>
                You do not have the level of access necessary to perform the operation you requested. Please contact the owner of the record or your administrator if access is necessary
            </h2>
        </div>
    </template>
</template>