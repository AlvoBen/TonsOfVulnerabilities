<!--
File Name        : pharmacyAddressHum.html
Version          : 1.0
Created Date     : 08/20/2021
Function         : Lightning Web Component used to display and edit ePost Addresses
Modification Log :
* Developer                          Date                  Description
*************************************************************************************************
* Kiran Bhuvanagiri                 08/20/2021            User Story 2421627: Original Version
* Himalay Patel                     09/07/2021            DF 3686 - Apply button is clickable before address selection has been made_HP_RXRF
* Kiran Bhuvanagiri                	09/30/2021            REQ - 2507884 T1PRJ0002517 - MF 2 - Case Documentation for Demographic Updates (RXRF) (ID# 35a)
* Ashok Kumar Nutalapati            09/30/2021            REQ - 2593758 T1PRJ0002517 - MF 2 - New case button, create case, & open new case in a subtab (RXRF) (ID# 35b)
* Himalay Patel                     10/15/2021            User Story 2718738: Update Address Selection Screen - Sort Order (RxRF) (ID# 91f)
* Himalay Patel                     10/15/2021            User Story 2690528: Error Message for Inactivating an Address - Status Change Warning (RxRF) (ID# 95)
* Kiran Bhuvanagiri                 01/04/2022            User Story 2759501: Case Documentation for Address Changes: UI Updates New/ Existing Case  (RxRF)
* Kiran Bhuvanagiri					02/16/2022			  User Story 2935436: Address Component in Lightning - (CRMS)
* Kalyani Pachpol					05/31/2022            3464396
* Nirmal Garg												06/03/2022						DF-5000 Fix
* Jonathan Dickinson		        09/27/2022		      REQ - 3751914
************************************************************************************************** -->

<template>
    <lightning-card>
        <div class={customcss}>
            <template if:true={loaded}>
                <template if:true={displayErrorMessage}>
                    <div class="slds-notify slds-notify_alert slds-alert_error" role="alert">
                        <span class="slds-assistive-text">error</span>
                        <span class="slds-icon_container slds-icon-utility-error slds-m-right_x-small"
                              title="Description of icon when needed">
                            <svg class="slds-icon slds-icon_x-small" aria-hidden="true">
                                <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#error"></use>
                            </svg>
                        </span>
                        <h2>
                            An error occurred retrieving Addresses for this Member. Please try
                            again. If this error continues, contact the help desk.
                        </h2>
                    </div>
                </template>
                <template if:false={displayErrorMessage}>
                    <template if:true={bShowAddressSelection}>
                        <div class="slds-m-around_medium">

                            <div class="slds-grid slds-grid_align-spread" style="height:40px; width:auto;">
                                <div class="slds-col slds-col_bump-right">
                                    <span>
                                        <div class="slds-text-heading_medium">Address</div>
                                    </span>
                                </div>
                                <div class="slds-col">
                                    <span>
                                        <lightning-button label="Add New Address" title="Add New Address"
                                                          onclick={addAddressClick} variant="brand-outline"
                                                          class="slds-m-right_medium" disabled={bIsEditButton}></lightning-button>
                                    </span>
                                </div>
                                <template if:true={bIsEditButton}>
                                    <div class="slds-col">
                                        <span>
                                            <lightning-button label="Edit" title="Edit" variant="brand-outline"
                                                              onclick={editAddressClick} class="slds-m-right_medium">
                                            </lightning-button>
                                        </span>
                                    </div>
                                </template>
                            </div>

                            <template if:true={successMessage}>
                                <div style="height: 0.01rem">
                                    <div class="slds-notify_container slds-is-relative">
                                        <div class="slds-notify slds-notify_toast slds-theme_success" role="status">
                                            <span class="slds-assistive-text">success</span>
                                            <span class="slds-icon_container slds-icon-utility-success slds-m-right_small slds-no-flex slds-align-top" title="Description of icon when needed">
                                                <lightning-icon icon-name="utility:success" size="small" variant="inverse"> </lightning-icon>
                                            </span>
                                            <div class="slds-col">
                                                <span>
                                                    <h2 class="slds-text-heading_small ">Address has successfully changed for this Member</h2>
                                                </span>
                                            </div>
                                            <div class="slds-notify__close">
                                                <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" id="successId" onclick={handleSuccessMessage}>
                                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                                                    </svg>
                                                    <span class="slds-assistive-text">Close</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <template if:true={statusError}>
                                <div style="height: 0.01rem">
                                    <div class="slds-notify_container slds-is-relative">
                                        <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                                            <span class="slds-assistive-text">error</span>
                                            <span class="slds-icon_container slds-icon-utility-error slds-m-right_small slds-no-flex slds-align-top"
                                                  title="Description of icon when needed">
                                                <lightning-icon icon-name="utility:error" size="small"
                                                                variant="inverse"></lightning-icon>
                                            </span>
                                            <h2 class="slds-text-heading_small ">
                                                An error occurred while updating Status
                                                for this Member. Please check all inputs and try again.
                                            </h2>
                                            <div class="slds-notify__close">
                                                <button class="slds-button slds-button_icon slds-button_icon-inverse"
                                                        title="Close" id="errorId" onclick={handleStatusError}>
                                                    <svg class="slds-button__icon slds-button__icon_large"
                                                         aria-hidden="true">
                                                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close">
                                                        </use>
                                                    </svg>
                                                    <span class="slds-assistive-text">Close</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <template if:true={infoMessage}>
                                <div style="height: 0.01rem">
                                    <div class="slds-notify_container slds-is-relative">
                                        <div class="slds-notify slds-notify_toast slds-theme_warning" role="status">
                                            <span class="slds-assistive-text">info</span>
                                            <span class="slds-icon_container slds-icon-utility-announcement slds-m-right_small slds-no-flex slds-align-top" title="Description of icon when needed">
                                                <lightning-icon icon-name="utility:warning" size="small" variant="inverse"> </lightning-icon>
                                            </span>
                                            <div class="slds-col">
                                                <span>
                                                    <h2 class="slds-text-heading_small ">{warningMessage}</h2>
                                                </span>
                                                <span class="slds-align_absolute-center">
                                                    <lightning-button label="Yes" title="Yes"
                                                                      onclick={handleWarningYes} variant="brand-outline"
                                                                      class="slds-m-top_small slds-p-right_small"></lightning-button>
                                                    <lightning-button label="No" title="No" id="infoNoId"
                                                                      onclick={handleWarningMessage} variant="brand-outline"
                                                                      class="slds-m-top_small"></lightning-button>
                                                </span>
                                            </div>
                                            <div class="slds-notify__close">
                                                <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close" id="infoId" onclick={handleWarningMessage}>
                                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                                                    </svg>
                                                    <span class="slds-assistive-text">Close</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <div id="addressScrollBox" class="slds-scrollable_y" style="height: 240px;">
                                <ul>
                                    <template for:each={addresses} for:item="address">
                                        <li key={address.UniqueKey} class='slds-border_bottom'>
                                            <lightning-input onchange={handleShowButton}
                                                             data-checkboxid={address.UniqueKey} type="checkbox"
                                                             value={address.UniqueKey} data-addresstype={address.AddressType}
                                                             label={address.AddressTypeLiteral} name="Test"
                                                             class="slds-col slds-p-top_xx-small">
                                            </lightning-input>

                                            <div class="slds-grid slds-gutters slds-p-left_large">
                                                <div class="slds-col slds-p-top_xx-small slds-size_4-of-12 slds-col_bump-right">
                                                    <div if:false={address.ShowToggle} style="font-size: 10px;">
                                                        <b>Status</b> : Active
                                                    </div>
                                                    <div if:true={address.ShowToggle}>
                                                        <div if:true={address.Status}>
                                                            <lightning-input class="slds-checkbox_toggle slds-grid"
                                                                             data-id={address.UniqueKey} type="toggle" label="Status "
                                                                             value={address.UniqueKey} onchange={handleStatusChange}
                                                                             message-toggle-active="Active"
                                                                             message-toggle-inactive="Inactive" checked>
                                                            </lightning-input>
                                                        </div>
                                                        <div if:false={address.Status}>
                                                            <lightning-input class="slds-checkbox_toggle slds-grid"
                                                                             data-id={address.UniqueKey} type="toggle" label="Status "
                                                                             value={address.UniqueKey} onchange={handleStatusChange}
                                                                             message-toggle-active="Active"
                                                                             message-toggle-inactive="Inactive">
                                                            </lightning-input>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-col slds-p-bottom_xx-small slds-size_7-of-12">
                                                    <div class="slds-text-body_regular">Address:<br /></div>
                                                    <div class="slds-text-heading_small">
                                                        <lightning-formatted-address street={address.Street}
                                                                                     city={address.City} province={address.StateCode}
                                                                                     postal-code={address.ZipCode} disabled="true">
                                                        </lightning-formatted-address>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </template>

                    <template if:true={bShowAddressChange}>
                        <div class="slds-m-around_medium">

                            <div class="slds-grid slds-grid_align-spread slds-border_bottom" style="height: 42px;">

                                <div class="slds-col">
                                    <lightning-button-icon icon-name="utility:back" onclick={handleEditBack}
                                                           class="slds-m-around_small"></lightning-button-icon>
                                </div>

                                <div class="slds-col">
                                    <span>
                                        <div class="slds-text-heading_medium">Address Change</div>
                                    </span>
                                </div>
                                <div class="slds-col slds-grow-none slds-col_bump-right">
                                    <hr />
                                    <span>
                                        <hr>
                                    </span>
                                </div>
                                <div class="slds-col">
                                    <span>
                                        <lightning-button label="Cancel" title="Cancel" onclick={handleCancel}
                                                          variant="brand-outline" class="slds-m-right_medium"></lightning-button>
                                    </span>
                                </div>
                                <div class="slds-col">
                                    <span>
                                        <lightning-button label="Apply" title="Apply" onclick={handleEditApply}
                                                          variant="brand" class="slds-m-right_medium" disabled={bIsApplyButton}></lightning-button>
                                    </span>
                                </div>
                            </div>
                            <br />
                            <div>
                                <div class="slds-m-bottom_x-small">
                                    <h3>Current Selected Address Type(s)</h3>
                                </div>

                                <ul class="slds-list_horizontal">
                                    <template for:each={selectedOptions} for:item="currentAddressType">
                                        <li key={currentAddressType.key}>
                                            <lightning-pill class="addressTypePill slds-m-right_small"
                                                            name={currentAddressType.name} label={currentAddressType.label}
                                                            onremove={handleRemove}></lightning-pill>
                                        </li>
                                    </template>
                                </ul>
                            </div>

                            <br />

                            <lightning-combobox name="addressUpdateCombo" value={addressToValidate}
                                                variant="label-hidden" placeholder="Update Address as:" options={items}
                                                onchange={handleAddressChange} required>
                            </lightning-combobox>

                            <template if:true={bShowOtherForm}>
                                <br />
                                <div class="slds-grid slds-grid_align-center">
                                    <div class="slds-col slds-size_9-of-12">
                                        <div class="slds-col slds-p-around_xx-small">
                                            <label class="setlabel">Address 1</label>
                                            <lightning-input class="setField" variant="label-hidden"
                                                             value={updateAddressLine1} onkeydown={handleEditAddress1}
                                                             onchange={handleEditAddress1} placeholder="Address" type="text"
                                                             maxlength="60"
                                                             message-when-value-missing="Error: You must Enter a Value" required
                                                             pattern="^[^*,():;@!%?&#34;&#39;]+$" message-when-pattern-mismatch="Error: Special Characters not allowed">
                                            </lightning-input>
                                        </div>

                                        <div class="slds-col slds-p-around_xx-small">
                                            <label class="setlabel1">Address 2</label>
                                            <lightning-input class="setField" variant="label-hidden"
                                                             value={updateAddressLine2} onkeydown={handleEditAddress2}
                                                             onchange={handleEditAddress2} placeholder="Address" type="text"
                                                             maxlength="60" pattern="^[^*,():;@!%?&#34;&#39;]+$"
                                                             message-when-pattern-mismatch="Error: Special Characters not allowed">
                                            </lightning-input>
                                        </div>

                                        <div class="slds-col slds-p-around_xx-small">
                                            <label class="setlabel">City</label>
                                            <lightning-input class="setField" variant="label-hidden"
                                                             value={updateAddressCity} onkeydown={handleEditCity}
                                                             onchange={handleEditCity} placeholder="City" type="text" maxlength="35"
                                                             message-when-value-missing="Error: You must Enter a Value" required
                                                             pattern="^[^*,():;@!%?&#34;&#39;]+$" message-when-pattern-mismatch="Error: Special Characters not allowed">
                                            </lightning-input>
                                        </div>

                                        <div class="slds-col slds-p-around_xx-small">
                                            <div class="slds-grid slds-gutters_small">
                                                <div class="slds-col slds-size_7-of-12">
                                                    <span>
                                                        <label class="setlabel">State</label>
                                                        <lightning-combobox class="setField" variant="label-hidden"
                                                                            name="state" value={updateAddressState}
                                                                            onchange={handleEditState} placeholder="State"
                                                                            options={stateOptions}
                                                                            dropdown-alignment="auto"
                                                                            message-when-value-missing="Error: You must Enter a Value"
                                                                            required>
                                                        </lightning-combobox>
                                                    </span>
                                                </div>
                                                <div class="slds-col slds-size_5-of-12">
                                                    <span>
                                                        <label class="setlabel">Zip</label>
                                                        <lightning-input class="setField" variant="label-hidden"
                                                                         value={updateAddressZip} onchange={handleEditZipChange}
                                                                         onkeydown={handleEditZip} placeholder="Zip" type="text"
                                                                         maxlength="5"
                                                                         message-when-value-missing="Error: You must Enter a Value"
                                                                         required>
                                                        </lightning-input>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="slds-col slds-p-around_xx-small">
                                            <div class="slds-grid slds-grid_align-end slds-gutters_x-small">
                                                <div class="slds-col">
                                                    <span>
                                                        <button class="slds-button slds-button_neutral cancelBtn"
                                                                label="Cancel" title="Cancel"
                                                                onclick={handleOtherCancel}>
                                                            Cancel
                                                        </button>
                                                    </span>
                                                </div>
                                                <div class="slds-col">
                                                    <span>
                                                        <lightning-button variant="brand" label="Done" title="Done"
                                                                          onclick={handleOtherDone}></lightning-button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <template if:true={bShowMappedAddresses}>
                                <br />
                                <lightning-button variant="brand-outline" label="Modify Selected Address"
                                                  title="Modify Selected Address" onclick={handleModifyAddress}
                                                  class="slds-m-left_xxx-small"></lightning-button>
                                <br />
                                <br />
                                <ul>
                                    <template for:each={selectedOptions} for:item="updatedAddress">
                                        <li key={updatedAddress.value}>
                                            <div class="slds-grid slds-gutters_xx-small slds-grid_align-center centerVertical">
                                                <div class="slds-col slds-size--2-of-12 slds-p-top_xx-small"
                                                     align="left">
                                                    <p>{updatedAddress.label}</p>
                                                </div>
                                                <div class="slds-col slds-size--8-of-12 slds-p-top_xx-small"
                                                     align="center">
                                                    <p>{selectedAddressStr}</p>
                                                </div>

                                            </div>
                                        </li>
                                    </template>
                                </ul>
                            </template>
                        </div>
                    </template>

                    <template if:true={bShowAddAddress}>
                        <div class="slds-m-around_medium">
                            <div class="slds-grid slds-grid_align-spread slds-border_bottom" style="height: 42px;">
                                <div class="slds-col">
                                    <lightning-button-icon icon-name="utility:back" onclick={handleCancel}
                                                           class="slds-m-around_small"></lightning-button-icon>
                                </div>

                                <div class="slds-col">
                                    <span>
                                        <div class="slds-text-heading_medium">New Address</div>
                                    </span>
                                </div>

                                <div class="slds-col slds-grow-none slds-col_bump-right">
                                    <hr />
                                    <span>
                                        <hr>
                                    </span>
                                </div>

                                <div class="slds-col">
                                    <span>
                                        <lightning-button label="Cancel" title="Cancel" onclick={handleCancel}
                                                          variant="brand-outline" class="slds-m-right_medium"></lightning-button>
                                    </span>
                                </div>
                                <div class="slds-col">
                                    <span>
                                        <lightning-button label="Apply" title="Apply" onclick={handleAddApply}
                                                          variant="brand" class="slds-m-right_medium" disabled={newApplyButton}></lightning-button>
                                    </span>
                                </div>
                            </div>

                            <br />

                            <div class="slds-grid slds-grid_align-center">
                                <div class="slds-col slds-size_9-of-12">
                                    <div class="slds-col slds-size--6-of-12 slds-p-around_xx-small">
                                        <label class="setlabel">Type</label>
                                        <lightning-combobox class="setField" variant="label-hidden" name="address"
                                                            value={addAddressType} onchange={handleaddAddressType}
                                                            placeholder="Select Address Type" options={addressTypes}
                                                            message-when-value-missing="Error: You must Enter a Value" required>
                                        </lightning-combobox>
                                    </div>

                                    <div class="slds-col slds-p-around_xx-small">
                                        <label class="setlabel">Address 1</label>
                                        <lightning-input class="setField" variant="label-hidden" value={addAddress1}
                                                         onkeydown={handleaddAddress1} onchange={handleaddAddress1}
                                                         placeholder="Address" type="text" maxlength="60"
                                                         message-when-value-missing="Error: You must Enter a Value" required
                                                         pattern="^[^*,():;@!%?&#34;&#39;]+$" message-when-pattern-mismatch="Error: Special Characters not allowed">
                                        </lightning-input>
                                    </div>

                                    <div class="slds-col slds-p-around_xx-small">
                                        <label class="setlabel1">Address 2</label>
                                        <lightning-input class="setField" variant="label-hidden" value={addAddress2}
                                                         onkeydown={handleaddAddress2} onchange={handleaddAddress2}
                                                         placeholder="Address" type="text" maxlength="60"
                                                         pattern="^[^*,():;@!%?&#34;&#39;]+$" message-when-pattern-mismatch="Error: Special Characters not allowed">
                                        </lightning-input>
                                    </div>

                                    <div class="slds-col slds-p-around_xx-small">
                                        <label class="setlabel">City</label>
                                        <lightning-input class="setField" variant="label-hidden" value={addAddressCity}
                                                         onkeydown={handleaddCity} onchange={handleaddCity} placeholder="City"
                                                         type="text" maxlength="35"
                                                         message-when-value-missing="Error: You must Enter a Value" required
                                                         pattern="^[^*,():;@!%?&#34;&#39;]+$" message-when-pattern-mismatch="Error: Special Characters not allowed">
                                        </lightning-input>
                                    </div>

                                    <div class="slds-col slds-p-around_xx-small">
                                        <div class="slds-grid slds-gutters_small">
                                            <div class="slds-col slds-size_7-of-12">
                                                <span>
                                                    <label class="setlabel">State</label>
                                                    <lightning-combobox class="setField" variant="label-hidden"
                                                                        name="state" value={addAddressState} onchange={handleaddState}
                                                                        onkeydown={handleaddState}
                                                                        placeholder="State" options={stateOptions}
                                                                        dropdown-alignment="auto"
                                                                        message-when-value-missing="Error: You must Enter a Value"
                                                                        required>
                                                    </lightning-combobox>
                                                </span>
                                            </div>
                                            <div class="slds-col slds-size_5-of-12">
                                                <span>
                                                    <label class="setlabel">Zip</label>
                                                    <lightning-input class="setField" variant="label-hidden"
                                                                     value={addAddressZip} onchange={handleZipChange}
                                                                     onkeydown={handleZipChangeClear} placeholder="Zip" type="text"
                                                                     maxlength="5"
                                                                     message-when-value-missing="Error: You must Enter a Value"
                                                                     required>
                                                    </lightning-input>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>

                    <template if:true={bShowUSPSValidation}>
                        <c-usps-validation-hum record-id={recordId} address-to-update={addressToUpdate} set-of-type={selectedOptions}
                                               oncancel={handleUSPSCancel} onback={handleUSPSBack}
                                               onuspssaveaddresses={handleUSPSSaveAddresses} show-epost-error={showUSPSSecondError}
                                               ondeletetypeselection={handleRemoveUSPSSelection} is-lightning={isLightning}></c-usps-validation-hum>
                    </template>
                    <template if:true={bShowExistingCaseModal}>
                        <c-logging-existing-case-modal-hum record-id={policyId} onclosemodal={handleCloseExistingCaseModal} onsavelog={handleSelectedExistingCase}></c-logging-existing-case-modal-hum>
                    </template>
                </template>
            </template>
            <template if:true={ePostLoading}>
                <lightning-spinner alternative-text="Loading"></lightning-spinner>
            </template>
            <template if:false={loaded}>
                <lightning-spinner alternative-text="Loading"></lightning-spinner>
            </template>
        </div>
    </lightning-card>
</template>