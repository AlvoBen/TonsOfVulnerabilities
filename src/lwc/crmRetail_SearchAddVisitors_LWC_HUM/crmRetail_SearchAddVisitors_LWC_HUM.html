<!--
Page Name        : crmRetail_SearchAddVisitors_LWC_HUM
Version          : 1.0 
Created Date     :03/10/2022
Function         : Lightning Web Component used Notification functionality for CRM Retail.
Modification Log :
* Developer                 Code review         Date                  Description
*************************************************************************************************
* Vinoth L       	                	        07/01/2022            Original Version
* Sahil Verma       	                	    09/23/2022            User Story 3850860 - T1PRJ0154546 / SF / MF9 Storefront Modernization - Navigation upon check-in
* Mohamed Thameem      	               	        06/12/2023            User Story 4695921: T1PRJ0154546 / SF/ MF9 Storefront - Allow Search By Phone Number Only
* Vinoth L										10/03/2023			  User Story 5225414: T1PRJ0154546 / SF / MF9 Storefront - Show Future Policy Members in Search Results
**************************************************************************************************-->
<template>
    <lightning-card>
        <div class="slds-grid slds-m-around_medium">
            <div class="slds-col">
                <h1 class="pageTitle">{visitorCheckInPageTitle}</h1>
            </div>
            <div class="slds-grid slds-m-around_medium positionBtn">
                <button class="slds-button slds-button_brand" onclick={handleScanCardButtonClick} disabled={isVisitorCheckInDisabled} title="ScanCard">{scanCardButtonLabel}</button>
                <button class="slds-button slds-button_brand" slot="actions" disabled={isVisitorCheckInDisabled} onclick={validateInputOnSearchClick} title="Search">{searchButtonLabel}</button>
                <button class="slds-button slds-button_brand" slot="actions" onclick={resetFields} title="Reset">{resetButtonLabel}</button>
                <lightning-button-icon icon-name="utility:knowledge_base" variant="brand" alternative-text="Service Strategy Documentation"  onclick={redirectToFilesTab} class="slds-m-left_xx-small sizingBtnIcon" title="Service Strategy Documentation"></lightning-button-icon>
            </div>
        </div>

        <div class="crm_grouped_grid">
            <template for:each={groupedFields} for:item="input">
                <div key={input.id}>
                    <template if:true={input.isCombobox}>
                        <lightning-combobox options={input.options} value={input.value} data-item={input.id}
                            name={input.name} placeholder={input.placeholder} label={input.label}
                            onchange={input.onchangeEvent}></lightning-combobox>
                    </template>
                    <template if:false={input.isCombobox}>
                        <lightning-input date-style={input.datestyle} message-when-bad-input={input.messageWhenbadInput}
                            pattern={input.pattern} message-when-pattern-mismatch={input.messageWhenPatternMismatch}
                            data-item={input.id} name={input.name} placeholder={input.placeholder} label={input.label}
                            type={input.type} onblur={input.onblurEvent} onchange={input.onchangeEvent}
                            onfocus={input.onfocusEvent}></lightning-input>
                    </template>
                </div>
            </template>
        </div>
        <template if:true={isSwitchOn_4695921}>
            <div class="crm_grid">
                <lightning-badge label="OR"></lightning-badge>
                <lightning-menu-divider></lightning-menu-divider>
            </div>
        </template>
        <div class="crm_standalone_grid">
            <template for:each={standAloneFields} for:item="input">
                <div key={input.id}>
                    <template if:true={input.showOR}>
                        <div align="center" class="crm_or-badge"><lightning-badge label="OR"></lightning-badge></div>
                    </template>
                    <template if:false={input.showOR}>
                        <lightning-input field-level-help={input.helptext} pattern={input.pattern}
                            message-when-pattern-mismatch={input.messageWhenPatternMismatch} data-item={input.id}
                            name={input.name} placeholder={input.placeholder} label={input.label} type={input.type}
                            onblur={input.onblurEvent} onchange={input.onchangeEvent}
                            onfocus={input.onfocusEvent}></lightning-input>
                    </template>
                </div>
            </template>
        </div>

    </lightning-card>
      <template if:true={ifSearchCriteriaValid}>  
        <br>      
        <lightning-card class="cardSpacing"> 
            <div class="slds-grid slds-m-around_medium">
                <div class="slds-col">
                    <h1 class="pageTitle">{searchResultsTitle}</h1>                      
                </div>  
                <div class="slds-grid slds-m-around_medium positionBtn">                    
                        <button class="slds-button slds-button_brand" onclick={onOnsiteCheckIn} title="Onsite" disabled={isCheckInDisabled}>{onsiteButtonLabel}</button>
                        <button class="slds-button slds-button_brand" slot="actions" onclick={onVirtualCheckIn} title="Virtual" disabled={isCheckInDisabled}>{virtualButtonLabel}</button>
                        <button class="slds-button slds-button_brand" slot="actions" onclick={onNewBtnClicked} title="New">{newButtonLabel}</button>                                              
                </div>                                                                        
            </div>          
            <template if:true = {isLoaded}>                                                              
                <div class="slds-p-around_medium adjustWidth">                                                                                                                                  
                    <lightning-datatable class="searchvisitor" key-field="id" sorted-by={sortBy} sorted-direction={sortDirection} onsort={handleSortAccountData} data={data} columns={columns} max-row-selection=1 onrowaction={handleRowAction}></lightning-datatable>  
                </div>
            </template>              
        </lightning-card>        
    </template>  
    <template if:true = {isModalActive}>
        <c-crm-retail_-scancard_-l-w-c_-h-u-m is-active={isModalActive}  replace-acc={replaceAccount} view-mode={pageName} onscancardevent={handleScanCardEvt} onclosescancardmodal={handleScanCardModalClose} oncloseinactivemembermodal={handleinactivememModalCloase}></c-crm-retail_-scancard_-l-w-c_-h-u-m>
    </template> 

<c-crm-retail_-generic-modal_-l-w-c_-h-u-m open-modal={inactiveModalOpen} show-close="true" no-footer="true" no-header="true" onclose={handleCloseModal}>

        <div slot="body">

            <div if:false={hasVisitorRecords}>

                <p class="slds-align_absolute-left crm_text_msg">{displaymsgforInactiveAcc}</p>

                <div class="slds-align_absolute-center">
                    <lightning-button variant="brand" name="Yes" label="Yes" class="yesButton" onclick={handleNewButtonClick}></lightning-button>        
                    <lightning-button variant="brand" name="No" label="No" onclick={handleCloseModal}></lightning-button>                   
                </div>
            
            </div>

            <div if:true={hasVisitorRecords}>

                <p  class="slds-align_absolute-left crm_text_msg">{displaymsgforExistingAccPrefix}&nbsp;<b>{visitorData.Name}</b>{displaymsgforExistingAccSuffix}</p>
                
                <lightning-datatable key-field="Id" data={tableData} hide-checkbox-column="true" columns={inactiveColumns}></lightning-datatable>

                <div class="slds-align_absolute-center crm_modal_footer_button">
                    <lightning-button variant="brand" name="Onsite Check-in" style="padding-right:15px;" label="Onsite Check-in" onclick={onInactiveCheckIn}></lightning-button>
                    <lightning-button variant="brand" name="Virtual Check-in" style="padding-right:12px;" label="Virtual Check-in" onclick={onVirtualInactiveCheckIn}></lightning-button>
                    <lightning-button variant="brand" name="New" label="New" onclick={handleNewButtonClick}></lightning-button>
                </div>

            </div>

        </div>

    
    </c-crm-retail_-generic-modal_-l-w-c_-h-u-m>     


    <template if:true = {isNotificationModalActive}>        
        <c-storefront-notification-l-w-c-h-u-m switch-map={switchMap} page-name={pageName} notification-wrap-data={notificationData} onnotificationack={ackNotification} onnotificationclose={handleNotificationModalClose}></c-storefront-notification-l-w-c-h-u-m>                                
    </template>  


    <c-crm-retail_-generic-modal_-l-w-c_-h-u-m style="--modal-max-width:40rem" open-modal={isDuplicateModalOpen} title={genericModalHeader} onclose={handleduplicatemodalclosedevt}>

            <div slot="body">

                <template for:each={duplicateIntList} for:item="item">
                    <li key={item}>{item}</li>
                </template>

            </div>   

            <button slot="footer" class="slds-button slds-button_neutral" onclick={handleduplicatemodalclosedevt} title="Cancel">{cancelButtonLabel}</button>

    </c-crm-retail_-generic-modal_-l-w-c_-h-u-m>


    <template if:true = {isSpinnerVisible}>               
        <lightning-spinner alternative-text="Loading" variant="brand" size="large" role="alert" class="slds-spinner_large spinnerClass"></lightning-spinner>  
    </template> 

    <c-crm-retail_-generic-modal_-l-w-c_-h-u-m style="--modal-max-width:40rem" open-modal={showFutureCheckInModal} title={futureModalTitle} onclose={handleFutureCloseModal}>

        <div slot="body"> {futureModalMessage} </div>   
        <button slot="footer" class="slds-button slds-button_neutral" onclick={handleFutureCloseModal} title="Cancel">{cancelButtonLabel}</button>

    </c-crm-retail_-generic-modal_-l-w-c_-h-u-m>

</template>