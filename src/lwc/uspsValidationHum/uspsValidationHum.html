<!--
File Name        : uspsValidationHum.html
Version          : 1.0 
Created Date     : 08/20/2021   
Function         : Lightning Web Component used to validate an address against USPS
Modification Log :
* Developer                          Date                  Description
*************************************************************************************************
* Kiran Bhuvanagiri                 08/20/2021            User Story 2421627: Original Version
* Kiran Bhuvanagiri                 01/04/2022            User Story 2759501: Case Documentation for Address Changes: UI Updates New/ Existing Case  (RxRF)
* Kiran Bhuvanagiri					05/23/2022			  User Story 2882456: Case Documentation for Demographic Updates (CRMS) 
* Jonathan Dickinson		        09/27/2022		      REQ - 3751914
* Jonathan Dickinson			 09/22/2023				   User Story 5061288: T1PRJ0870026   MF 27406 HPIE/CRM - SF Tech- Mail Order Management - Pharmacy -  Details tab - Address section
************************************************************************************************** -->

<template>
    <template if:true={uspsLoaded}>
        <div class="slds-m-around_medium">
            <template if:false={isLightning}>
                <div class="slds-grid slds-grid_align-spread slds-border_bottom" style="height: 40px;">
                    <div class="slds-col">
                        <lightning-button-icon icon-name="utility:back" class="slds-m-around_small"
                            onclick={handleBack}>
                        </lightning-button-icon>
                    </div>
                    <div class="slds-col">
                        <span>
                            <div class="slds-text-heading_medium">USPS Address Verification</div>
                        </span>
                    </div>
                    <div class="slds-col slds-grow-none slds-col_bump-right">
                        <hr />
                        <span>
                            <hr>
                        </span>
                    </div>
                    <template if:false={hasAddressLogging}>
                        <div class="slds-col">
                            <span>
                                <lightning-button label="Cancel" title="Cancel" onclick={handleCancel}
                                    variant="brand-outline" class="slds-m-right_medium"></lightning-button>
                            </span>
                        </div>
                        <div class="slds-col">
                            <span>
                                <lightning-button label="Save" title="Save" variant="brand" disabled={disableSaveButton}
                                    class="slds-m-right_medium" onclick={uspsHandleSave}></lightning-button>
                            </span>
                        </div>
                    </template>
                    <template if:true={hasAddressLogging}>
                        <div class="slds-col">
                            <span>
                                <lightning-button label="Cancel" title="Cancel" onclick={handleCancel}
                                    variant="brand-outline" class="slds-m-right_medium"></lightning-button>
                            </span>
                        </div>
                        <div class="slds-col">
                            <span>
                                <lightning-button-menu label="Save & Log" alternative-text="Show menu" variant="brand"
                                    disabled={disableSaveButton}>
                                    <lightning-menu-item value="NewCase" onclick={handleNewCase} label="New Case">
                                    </lightning-menu-item>
                                    <lightning-menu-item value="ExistingCase" onclick={handleExistingCase}
                                        label="Existing Case"></lightning-menu-item>
                                </lightning-button-menu>
                            </span>
                        </div>

                    </template>
                </div>
            </template>
            <template if:true={isLightning}>
                <div class="slds-grid slds-border_bottom" style="height: 40px;">
                    <div class="slds-col slds-size_1-of-12">
                        <lightning-button-icon icon-name="utility:back" class="slds-m-around_small"
                            onclick={handleBack}>
                        </lightning-button-icon>
                    </div>
                    <div class="slds-col slds-size_11-of-12">
                        <span>
                            <div class="slds-text-heading_medium">USPS Address Verification</div>
                        </span>
                    </div>
                </div>
                <div class="slds-grid slds-grid_align-spread" style="height: 40px;">
                    <template if:false={hasAddressLogging}>
                        <div class="slds-col">
                            <span>
                                <lightning-button label="Cancel" title="Cancel" onclick={handleCancel}
                                    variant="brand-outline" class="slds-m-right_medium"></lightning-button>
                            </span>
                        </div>
                        <div class="slds-col">
                            <span>
                                <lightning-button label="Save" title="Save" variant="brand" disabled={disableSaveButton}
                                    class="slds-m-right_medium" onclick={uspsHandleSave}></lightning-button>
                            </span>
                        </div>
                    </template>
                    <template if:true={hasAddressLogging}>
                        <c-generic-case-comment-logging record-id={recordId} responseobj={addressDataObj}
                            onsavedata={handleSaveLog} oncancel={handleCancel} use-save-data={useSaveData} submit={submit}
                            no-pop-over={noPopOver}>
                        </c-generic-case-comment-logging>
                    </template>
                </div>
            </template>
            <template if:true={showEpostError}>
                <div style="height: 0.01rem">
                    <div class="slds-notify_container slds-is-relative">
                        <div class="slds-notify slds-notify_toast slds-theme_error" role="status">
                            <span class="slds-assistive-text">error</span>
                            <span
                                class="slds-icon_container slds-icon-utility-error slds-m-right_small slds-no-flex slds-align-top">
                                <lightning-icon icon-name="utility:error" size="small" variant="inverse">
                                </lightning-icon>
                            </span>
                            <h2 class="slds-text-heading_small ">An error occurred while updating Address for this
                                Member. Please check all inputs and try again.</h2>
                            <div class="slds-notify__close">
                                <button class="slds-button slds-button_icon slds-button_icon-inverse" title="Close"
                                    id="ePostErrorBtn" onclick={handleHideErrorMsg}>
                                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Close</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <br />

            <div>
                <div class="slds-m-bottom_x-small">
                    <h3><b>Current Selected Address Type(s)</b></h3>
                </div>

                <ul class="slds-list_horizontal">
                    <template for:each={setOfType} for:item="type">
                        <li key={setOfType.key}>
                            <lightning-pill class="addressTypePill slds-m-right_small" name={type.name}
                                label={type.label} onremove={handleRemove}></lightning-pill>
                        </li>
                    </template>
                </ul>
            </div>
            <br />

            <template if:true={isLightning}>
                <div class="slds-grid">
                    <div class="slds-col slds-p-bottom_x-small slds-size_1-of-2">
                        <div class="slds-grid slds-grid_vertical slds-gutters">
                            <div class="slds-col slds-p-bottom_x-small">
                                <span>
                                    <div class="slds-text-heading_medium"><b>Address Entered By You</b></div>
                                </span>
                            </div>
                            <div class="slds-col slds-grid slds-p-bottom_small">
                                <div class="slds-col slds-size_1-of-12">
                                    <lightning-radio-group class="slds-text-heading_medium" name="radioGroup" label=""
                                        options={addressOptions} value={radioValue} type="radio" variant="label-hidden"
                                        onchange={handleOptionChange}>
                                    </lightning-radio-group>
                                </div>
                                <div class="slds-col slds-size_5-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">Address Line 1<br /></div>
                                        <div class="slds-text-heading_small">{addressToUpdate.AddressLine1}</div>
                                    </span>
                                </div>
                                <div class="slds-col slds-size_6-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">City<br /></div>
                                        <div class="slds-text-heading_small">{addressToUpdate.City}</div>
                                    </span>
                                </div>
                            </div>
                            <div class="slds-col slds-grid slds-p-bottom_small">
                                <div class="slds-col slds-size_1-of-12"></div>
                                <div class="slds-col slds-size_5-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">Address Line 2<br /></div>
                                        <div class="slds-text-heading_small">{addressToUpdate.AddressLine2}</div>
                                    </span>
                                </div>
                                <div class="slds-col slds-size_3-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">State Code<br /></div>
                                        <div class="slds-text-heading_small">{addressToUpdate.StateCode}</div>
                                    </span>
                                </div>
                                <div class="slds-col slds-size_3-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">Zip Code<br /></div>
                                        <div class="slds-text-heading_small">{addressToUpdate.ZipCode}</div>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <template if:true={showValidatedAddress}>
                        <div class="slds-col slds-p-bottom_x-small slds-size_1-of-2">
                            <div class="slds-grid slds-grid_vertical slds-gutters">
                                <div class="slds-col slds-p-bottom_x-small">
                                    <span>
                                        <div class="slds-text-heading_medium"><b>USPS Recommendation</b></div>
                                    </span>
                                </div>
                                <div class="slds-col slds-grid slds-p-bottom_small">
                                    <div class="slds-col slds-size_1-of-12">
                                        <lightning-radio-group class="slds-text-heading_small" name="radioGroup"
                                            label="" options={USPSAddrsOptions} value={radioValue} type="radio"
                                            variant="label-hidden" onchange={handleOptionChange}>
                                        </lightning-radio-group>
                                    </div>
                                    <div class="slds-col slds-size_5-of-12">
                                        <span>
                                            <div class="slds-text-heading_small">Address Line 1<br /></div>
                                            <div class="slds-text-heading_small">{validatedAddress.AddressLine1}</div>
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                        <span>
                                            <div class="slds-text-heading_small">City<br /></div>
                                            <div class="slds-text-heading_small">{validatedAddress.City}</div>
                                        </span>
                                    </div>
                                </div>
                                <div class="slds-col slds-grid slds-p-bottom_small">
                                    <div class="slds-col slds-size_1-of-12"></div>
                                    <div class="slds-col slds-size_5-of-12">
                                        <span>
                                            <div class="slds-text-heading_small">Address Line 2<br /></div>
                                            <div class="slds-text-heading_small">{validatedAddress.AddressLine2}</div>
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_3-of-12">
                                        <span>
                                            <div class="slds-text-heading_small">State Code<br /></div>
                                            <div class="slds-text-heading_small">{validatedAddress.StateCode}</div>
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_3-of-12">
                                        <span>
                                            <div class="slds-text-heading_small">Zip Code<br /></div>
                                            <div class="slds-text-heading_small">{validatedAddress.ZipCode}</div>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    <template if:true={isError}>
                        <br />
                        <div class="slds-col slds-grid slds-grid_vertical slds-gutters slds-size_1-of-2">
                            <div class="slds-col slds-p-bottom_x-small">
                                <span>
                                    <div class="slds-text-heading_medium"><b>USPS Recommendation</b></div>
                                </span>
                            </div>
                            <div class="slds-col">
                                <template if:true={showUspsError}>
                                    <div class="slds-notify_container slds-is-relative" style="text-align: left; ">
                                        <div class="slds-notify slds-notify_toast slds-theme_error uspsLightningError"
                                            role="status">
                                            <span class="slds-assistive-text">error</span>
                                            <span
                                                class="slds-icon_container slds-icon-utility-error slds-m-right_small slds-no-flex slds-align-top"
                                                title="Description of icon when needed">
                                                <svg class="slds-icon slds-icon_small" aria-hidden="true">
                                                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#error">
                                                    </use>
                                                </svg>
                                            </span>
                                            <div class="slds-notify__content">
                                                <h2 class="slds-text-heading_small ">{sUspsErrorMsg}</h2>
                                            </div>
                                            <div class="slds-notify__close">
                                                <button class="slds-button slds-button_icon slds-button_icon-inverse"
                                                    title="Close" id="uspsErrorBtnLightning"
                                                    onclick={handleHideErrorMsg}>
                                                    <svg class="slds-button__icon slds-button__icon_large"
                                                        aria-hidden="true">
                                                        <use
                                                            xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close">
                                                        </use>
                                                    </svg>
                                                    <span class="slds-assistive-text">Close</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
            </template>

            <template if:false={isLightning}>
                <div class="slds-grid slds-grid_vertical slds-gutters">
                    <div class="slds-col slds-p-bottom_x-small">
                        <span>
                            <div class="slds-text-heading_medium"><b>Address Entered By You</b></div>
                        </span>
                    </div>
                    <div class="slds-col slds-p-bottom_x-small">
                        <div class="slds-grid slds-gutters_xx-small">
                            <div class="slds-col slds-size--6-of-12">
                                <span>
                                    <div class="slds-text-heading_small">Address Line 1:<br /></div>
                                    <div class="slds-text-heading_small">{addressToUpdate.AddressLine1}</div>
                                </span>
                            </div>
                            <div class="slds-col slds-size--4-of-12">
                                <span>
                                    <div class="slds-text-heading_small">City:<br /></div>
                                    <div class="slds-text-heading_small">{addressToUpdate.City}</div>
                                </span>
                            </div>
                            <div class="slds-col slds-size--2-of-12">
                                <span>
                                    <div class="slds-text-heading_small">State Code:<br /></div>
                                    <div class="slds-text-heading_small">{addressToUpdate.StateCode}</div>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-p-bottom_x-small">
                        <div class="slds-grid slds-gutters_xx-small">
                            <div class="slds-col slds-size--6-of-12">
                                <span>
                                    <div class="slds-text-heading_small">Address Line 2:<br /></div>
                                    <div class="slds-text-heading_small">{addressToUpdate.AddressLine2}</div>
                                </span>
                            </div>
                            <div class="slds-col slds-size--4-of-12">
                                <span>
                                    <div class="slds-text-heading_small">Zip Code:<br /></div>
                                    <div class="slds-text-heading_small">{addressToUpdate.ZipCode}</div>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col">
                        <div class="slds-float_right">
                            <lightning-button-stateful label-when-off="Select" label-when-on="Selected"
                                icon-name-when-on="utility:check" variant="brand" selected={inputAddressSelected}
                                onclick={handleInputAddressSelect}>
                            </lightning-button-stateful>
                        </div>
                    </div>
                </div>

                <template if:true={showValidatedAddress}>
                    <br />

                    <div class="slds-grid slds-grid_vertical slds-gutters">
                        <div class="slds-col slds-p-bottom_x-small">
                            <span>
                                <div class="slds-text-heading_medium"><b>USPS Recommendation</b></div>
                            </span>
                        </div>
                        <div class="slds-col slds-p-bottom_x-small">
                            <div class="slds-grid slds-gutters_xx-small">
                                <div class="slds-col slds-size--6-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">Address Line 1:<br /></div>
                                        <div class="slds-text-heading_small">{validatedAddress.AddressLine1}</div>
                                    </span>
                                </div>
                                <div class="slds-col slds-size--4-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">City:<br /></div>
                                        <div class="slds-text-heading_small">{validatedAddress.City}</div>
                                    </span>
                                </div>
                                <div class="slds-col slds-size--2-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">State Code:<br /></div>
                                        <div class="slds-text-heading_small">{validatedAddress.StateCode}</div>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="slds-col slds-p-bottom_x-small">
                            <div class="slds-grid slds-gutters_xx-small">
                                <div class="slds-col slds-size--6-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">Address Line 2:<br /></div>
                                        <div class="slds-text-heading_small">{validatedAddress.AddressLine2}</div>
                                    </span>
                                </div>
                                <div class="slds-col slds-size--4-of-12">
                                    <span>
                                        <div class="slds-text-heading_small">Zip Code:<br /></div>
                                        <div class="slds-text-heading_small">{validatedAddress.ZipCode}</div>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="slds-col">
                            <div class="slds-float_right">
                                <lightning-button-stateful label-when-off="Select" label-when-on="Selected"
                                    icon-name-when-on="utility:check" variant="brand" selected={uspsAddressSelected}
                                    onclick={handleUspsAddressSelect}>
                                </lightning-button-stateful>
                            </div>
                        </div>
                    </div>
                </template>

                <template if:true={isError}>
                    <br />
                    <div class="slds-grid slds-grid_vertical slds-gutters">
                        <div class="slds-col slds-p-bottom_x-small">
                            <span>
                                <div class="slds-text-heading_medium"><b>USPS Recommendation</b></div>
                            </span>
                        </div>
                        <div class="slds-col">
                            <template if:true={showUspsError}>
                                <div class="slds-notify_container slds-is-relative" style="text-align: left; ">
                                    <div class="slds-notify slds-notify_toast slds-theme_error uspsErrorWidth"
                                        role="status">
                                        <span class="slds-assistive-text">error</span>
                                        <span
                                            class="slds-icon_container slds-icon-utility-error slds-m-right_small slds-no-flex slds-align-top"
                                            title="Description of icon when needed">
                                            <svg class="slds-icon slds-icon_small" aria-hidden="true">
                                                <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#error">
                                                </use>
                                            </svg>
                                        </span>
                                        <div class="slds-notify__content">
                                            <h2 class="slds-text-heading_small ">{sUspsErrorMsg}</h2>
                                        </div>
                                        <div class="slds-notify__close">
                                            <button class="slds-button slds-button_icon slds-button_icon-inverse"
                                                title="Close" id="uspsErrorBtnClassic" onclick={handleHideErrorMsg}>
                                                <svg class="slds-button__icon slds-button__icon_large"
                                                    aria-hidden="true">
                                                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close">
                                                    </use>
                                                </svg>
                                                <span class="slds-assistive-text">Close</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </template>
        </div>
    </template>
    <template if:false={uspsLoaded}>
        <template if:true={isLightning}>
            <div class="slds-align_absolute-center slds-is-relative slds-m-vertical_large">
                <lightning-spinner
                    alternative-text="Loading">
                </lightning-spinner>
            </div>
        </template>
        <template if:false={isLightning}>
            <lightning-spinner alternative-text="Loading"></lightning-spinner>
        </template>
    </template>
</template>