<!--
Page Name        : Go365LiveChat_VF_HUM
Version          : 1.0 
Created Date     : October 25 2016
Function         : Custom window for Live Chat form on Live agent for Go365 site
Modification Log :
*   Modification ID     Developer                     Code Review         Date                 Description
* ------------------------------------------------------------------------------------------------------------------------------                
*           1.0         Rajesh Keswani                                     10/25/2016          Original Version
*           1.1         Vishal Verma                  144291               11/06/2017          REQ - 321230 Unique Identifier for Secondary Chat ID
*           1.2        Rajesh CG                  	  158171 		       12/15/2017          REQ - 337743 Configure Customer Alert Setting for Live Agent CR-701
*			1.3        Rajesh C        				  171913 			   01/10/2018          REQ - 350669 CR735: Securing the Save Chat Option - Live Chat & Post Chat Windows
*           1.4        Prafull Verma				  328794	           12/28/2018          REQ - 380424: Web Chat Windows Display Proportionately on Small Glass
*           1.5        Akshay Pai                                           01/18/2021         REQ - 1840119 - Visual Cue for New Messages in Chat Window – Go365 Secure
*           1.6        Lakshmi Madduri                                      3/24/2021          US-1910841 SonarQube Fixes
  ------------------------------------------------------------------------------------------------------------------------------>
<apex:page controller="HUMPreChatController" id="tPage" showheader="false" standardStyleSheets="false" >

<!--[if IE 8]>      <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>      <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Chat</title>
    <meta charset="utf-8"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge"/>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
    <script type="text/javascript">
    
        //Code related to Code Metrics.
        var src = "{!JSENCODE(sWebChatVarMap['CodeMetricsJS'].value__c)}";
        if (window.location.host.substring(0, 2) == "qa") 
        {
            src = "{!JSENCODE(sWebChatVarMap['CodeMetricsQaJS'].value__c)}";
        } 
        else if (window.location.host.substring(0, 4) == "test") 
        {
            src = "{!JSENCODE(sWebChatVarMap['CodeMetricsTestJS'].value__c)}";
        }
        document.write('<script src="' + src + '" type="text/javascript"><' + '/script>');
        
        //Storing values from the prechat page.
        var sButtonId = '{!JSENCODE($CurrentPage.parameters.liveagent.prechat:SelBtnId)}';
        var sOrgId = '{!JSENCODE($CurrentPage.parameters.liveagent.prechat:org_id)}'; 
        var sDepId = '{!JSENCODE($CurrentPage.parameters.liveagent.prechat:deployment_id)}';
        var sSecondaryChatId = '{!JSENCODE($CurrentPage.parameters.liveagent.prechat:SecChatID)}';    
        //liveagent Initialisation 
        liveagent.chasitor.setOrgId(sOrgId);
        liveagent.chasitor.setDeploymentId(sDepId);
        liveagent.chasitor.setButtonId(sButtonId);
        liveagent.addEventListener(liveagent.chasitor.Events.CHAT_REQUEST_SUCCESSFUL,chatRequestSuccess);
        liveagent.addEventListener(liveagent.chasitor.Events.CHAT_ESTABLISHED,chatEstablished);
        liveagent.addEventListener(liveagent.chasitor.Events.AGENT_CHAT_TRANSFERRED,agentChatTransferred);
        if({!bGo365Switch})
		{
			liveagent.addEventListener(liveagent.chasitor.Events.AGENT_CHAT_MESSAGE,newAgentMessage);        
			//Getting custom label details
			window.$Label = window.$Label || {};
			$Label.HUMNewMsgDesktopNotification = '{!JSENCODE($Label.HUMNewMsgDesktopNotification)}';
        }
        //CHAT_REQUEST_SUCCESSFUL event callback helper function
        function chatRequestSuccess() 
        {
            var details = liveagent.chasitor.getDetails();
            console.log(details);
            for(i=0;i<details.prechatDetails.length;i++)
            {
                if(details.prechatDetails[i].label=='MemberGenKey')
                {
                    HumAnalytics.regid = details.prechatDetails[i].value;
                }
                else if(details.prechatDetails[i].label=='sLSessionID')
                {
                    HumAnalytics.ssid = details.prechatDetails[i].value;
                }
                HumAnalytics.secid = sSecondaryChatId;
            }
        }
        
        //CHAT_ESTABLISHED event callback helper function
        function chatEstablished() 
        {
            var details = liveagent.chasitor.getDetails();
            var agentName = details['agent']['agentName'];
            
            document.getElementById('agNameId').style.display = '';
            document.getElementById('sendBtn').style.display = '';
            
            document.getElementById('hideTillChat').style.display = '';
            document.getElementById('agName').innerHTML = agentName;
            var labels = {
                AGENT_TYPING: agentName + ' is typing...',
            };
            SfdcApp.LiveAgent.Chasitor.loadLabels(labels);
            commitTranscript();
        }
        
        //AGENT_CHAT_TRANSFERRED event callback helper function
        function agentChatTransferred() 
        {
            var details = liveagent.chasitor.getDetails();
           
            var agentName = details['agent']['agentName'];
            document.getElementById('agName').innerHTML = agentName;
            var agentName = details['agent']['agentName'];
            var labels = {
                AGENT_TYPING: agentName + ' is typing...',
            };
            SfdcApp.LiveAgent.Chasitor.loadLabels(labels);
        }
        
        //Cannot Move it into static resource as it is using parameters that are related to live agent
        //Live agent components cannot be loaded inside static resource 
        function commitTranscript()
        {
            try
            {
                Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.HUMPreChatController.onCommitTranscript}',liveagent.chasitor.getChatKey(),getAgentDetail(),function(result, event)
                {
                    if (event.status) 
                    {
                        return true;
                    } 
                    else
                    {
                        return false;
                    }
                 }, 
                 {
                    escape:true
                 });
            }
            catch (ex) 
            {
                alert(ex.message);
                return false;
            }
            return false;  
        }
        
        //commitTranscript helper function
        function getAgentDetail()
        {
            var details = liveagent.chasitor.getDetails();
            var tId='';
            tId = details['agent']['userId'];
            return tId;
        }
        
        //parsing the interaction info from liveagent details
        function getInteractionId()
        {
            var details = liveagent.chasitor.getDetails();
            var intId='';
            for(i=0;i<details.prechatDetails.length;i++)
            {
                if(details.prechatDetails[i].label=='InteractionId')
                {
                    intId = details.prechatDetails[i].value;
                }
            }
            return intId;
        }
        
        </script> 
        <!-- Loading CSS files received from digital team for Humana view standards -->
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/base.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/framework.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/global.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/global1.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/humanacom.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/lib.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/styles.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/renderings.css')}" />
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMLiveChatWindowCSS,'/LiveChatWindowCSS/main.css')}" />
        
        
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HumGo365LiveAgentCSS,'/content/dist/css/go365.css')}"/>
        <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HumGo365SampleCSS,'/c2csample/custom.css')}"/>
        
        <!-- Loading jQuery toolkit as per VF standards -->
        <apex:includeScript value="{!URLFOR($Resource.CRM_JQUERY, 'jquery.min.js')}" /> 
        <apex:outputText rendered="{!bGo365Switch}">
            <apex:includeScript value="{!URLFOR($Resource.NewChatMsgNotification_SR_HUM,'NewChatMsgNotification/NewChatMsgNotification.js')}"/>   
            <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.NewChatMsgNotification_SR_HUM,'NewChatMsgNotification/NewChatMsgNotification.css')}" />    
        </apex:outputText>   
    </head>
    <liveAgent:clientchat >
    <body class="x5">
    <main>
        <div class="chat-page-heading">
            <h1>Go365 Chat</h1>
        </div>
        
        <div class="chat-wrapper">
            <div class="container">
                 <div class="row">
           
                    <liveAgent:clientChatAlertMessage />
                    <liveAgent:clientChatStatusMessage />
                    <table id="waitingMessage" cellpadding="0" cellspacing="0">
                        <tr>
                            <td><script type="text/javascript">
                                SfdcApp.LiveAgent.Chasitor.addQueueComponent("queuePosition");
                                </script>
                                <div class="hide_queuePos" id="liveAgentQueuePosition">
                                    <span id="agnStatus">You are currently <span id="queuePosition" class="liveAgentQueuePosition"></span> in
                                        the queue.&nbsp;&nbsp;</span>A chat specialist will be with you soon.
                                </div>
                            </td>
                        </tr>
                    </table>
                    <div class="row">
                            <div class="row" style="display: none;" id="agNameId">
                             
                                    <p class="x0 legal-copy">
                                        You are now connected with <span id="agName" value=""></span>.
                                    </p>
                            </div>
                            <div class="row">
                                <div class="seventeen columns scrollable-content x2-left">
                                    <div class="section-content ">
                                        <liveAgent:clientChatLog />
                                        <apex:outputPanel rendered="{!bGo365Switch}">  
											<div id="newAgentMessage" onclick = "scrollToBottom();">
												<p id = "NewGo365Message" align="right">{!$Label.HUMNewMsgNotification}</p>
											</div>
										</apex:outputPanel>                                        
                                    </div>
                                </div>
                            </div>
                            <div class="row">
							<div><liveAgent:clientChatLogAlertMessage /></div><br />
							<liveagent:clientChatInput useMultiline="true" />
                            </div>
                            <div class="row x1 paddingStyle">
                                    <button class="go-strong-button" style="display: none;" id="sendBtn" onclick="SfdcApp.LiveAgent.Chasitor.sendMessage();" title="Send">
                                        <span>Send</span>
                                    </button>
                                    <span class="go-primary-button" style="display: none;" id="hideTillChat"> <liveAgent:clientChatEndButton /></span> 
                                    
                            </div>
                    </div>
                </div>          
            </div>
         </div>
            
    </main>
    </body> 
     </liveAgent:clientchat>
    </html>
</apex:page>