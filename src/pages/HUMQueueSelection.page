<!--
Page Name        : HUMQueueSelectionController
Version          : 1.0 
Created Date     : June 4 2014
Function         : Page is used to select work queue for logged user

Modification Log :
*  Developer Name                   Code Review                   Date                  Description
* ------------------------------------------------------------------------------------------------------------------------------                
*  M Surya Kumari                   17093                         06/04/2014            Original Version 
*  M Surya Kumari                   17093                         06/18/2014            Added section to display error messages for user who doesn't belong to any group
*  Manish Kumar                     24069                         04/11/2016            Added logic to fire event after updating to proper Queue
*  Manish Kumar                     24880                         08/25/2016            Added logic to prevent error message being logged from Logging framework
*  Santhi Mandava                   41557                         09/29/2016            Added a new class to error message field.
*  Santhi Mandava                                                 10/17/2016            Fixed submit button alignment issue.
*  Melkisan Selvaraj									  			  08/22/2019	        REQ - 405880. Launch Compass Functionality
*  Mithra Bharadwaj                                                                  US#1522825 SonarQube Changes
*  Lakshmi Madduri                                                7/7/2021              Launch Unified Search 
*  Akshay Pai                                                     11/09/2021            REQ - 2773030. Metrix Defect Fix
---------------------------------------------------------------------------------------------------------------------------------------------->
<apex:page controller="HUMQueueSelectionController" action="{!init}" showHeader="false" title="Work Queue Selection" sidebar="false">

  <apex:stylesheet value="{!URLFOR($Resource.HUMQueueSelection, '/QueueSelection/main.css')}" />
  <apex:includeScript value="/support/console/36.0/integration.js"/>
  <apex:includeScript value="{!URLFOR($Resource.HUMQueueSelection,'/QueueSelection/main.js')}"/>
  <script>
    var numberOfQueue = '{!JSENCODE(numberOfQueue)}';
    var sTabName = '{!JSENCODE($Label.UnifiedSearch_Home_TabName)}';
    function LaunchCoveo()
    {                       
          var messageValue = {"coveoTabName": sTabName} ;           
          if (sforce.console.isInConsole()) 
          {
              var event = sforce.console.fireEvent('launchCoveo',JSON.stringify(messageValue));                
          }                
    } 
  </script>
  <apex:form id="theForm" >
    <apex:actionFunction action="{!saveSubFunction}" reRender="OP_SubFunctionId" name="SaveSubFunctionAF"/>
    <apex:pageMessages ></apex:pageMessages>
    <apex:pageBlock mode="edit" title="Queue Selection" html-log_this="false">
                <apex:pageblockButtons location="Top" rendered="{!isUnifiedSearchOn}">
                    <apex:commandbutton value="Unified Search" onclick="LaunchCoveo();"  />
                </apex:pageblockButtons>
      <apex:actionRegion >
        <apex:pageBlockSection id="OutputPanel" rendered="{!IF(queueList.size > 0, true, false)}" html-log_this="false">
          <apex:pageBlockSectionItem id="pbi1">
            <apex:outputLabel value="{!$Label.HUMCurrentWorkQueue}" for="currentQueue" styleClass="outputLabel" html-log_this="false"/>
            <apex:outputText value="{!Queue}" id="currentQueue" html-log_this="false"/>
          </apex:pageBlockSectionItem>
          <br/><br/>
          <apex:pageBlockSectionItem html-log_this="false">
            <apex:outputLabel value="{!$Label.HUMSelectaWorkQueue}" for="queueSelection" styleClass="outputLabel" html-log_this="false"/>
            <apex:outputPanel id="queueSelection" html-log_this="false">
              <table><tr><td>
                    <apex:selectList value="{!sSelectedQueue}" multiselect="false" size="1" required="true" disabled="{!IF(queueList.size <= 1, true, false)}">
                      <apex:selectOptions value="{!queueList}"/>
                    </apex:selectList>
                  </td><td>
                    <apex:commandButton styleClass="commandButton" style="margin-top: -7px;" html-log_this="false" onclick="SaveQueue('{!JSENCODE(sTabTitle)}'); return false;" reRender="OutputPanel" value="Submit" disabled="{!IF(queueList.size <= 1, true, false)}" />
                  </td></tr></table>
            </apex:outputPanel>
          </apex:pageBlockSectionItem>
        </apex:pageBlockSection>
        <apex:outputPanel rendered="{!IF(queueList.empty, true, false)}" html-log_this="false">
          <apex:pageBlockSection title="{!$Label.HUMQueueSelection}" html-log_this="false">
            <B log_this="false"> <apex:outputText html-log_this="false" value="{!$Label.HUMWorkQueueNotPresentMessage}" styleClass="outputText queueErrorMessage"/> </B>
          </apex:pageBlockSection>
        </apex:outputPanel>
        <apex:actionFunction action="{!saveQueue}" rerender="theForm" name="SaveQueueAF" oncomplete="changeTabTitleFinal('{!JSENCODE(sTabTitle)}'); return false;"/>
      </apex:actionRegion>
    </apex:pageBlock>

    <apex:outputPanel rendered="{!AND(showSubFunctionPb, queueList.size > 0)}">
      <apex:actionRegion >
        <apex:pageBlock id="pBlock2Id" mode="edit" title="Sub Function Selection" html-log_this="false" rendered="{!IsRapidForceApp}">
          <apex:pageBlockSection id="OP_SubFunctionId" html-log_this="false">
            <apex:pageBlockSectionItem id="pbi2">
              <apex:outputLabel value="{!$Label.HUMSubFunction}" styleClass="outputLabel" html-log_this="false"/>
              <apex:outputText style="margin-left: 2px;" value="{!curSubFunction}" id="currentSFunction" html-log_this="false"/>
            </apex:pageBlockSectionItem>
            <br/><br/>
            <apex:pageBlockSectionItem html-log_this="false">
              <apex:outputLabel value="{!$Label.HUMSelectSubFunction}" styleClass="outputLabel" html-log_this="false"/>
              <apex:outputPanel id="sFunctionSelection" html-log_this="false">
                <table><tr><td>
                      <apex:selectList value="{!sSelectedSub}" multiselect="false" size="1" required="true"  style="margin-top: -5px;">
                        <apex:selectOptions value="{!options}"/>
                      </apex:selectList>
                    </td><td>
                      <apex:commandButton styleClass="commandButton" style="margin-top: -7px;" html-log_this="false" onclick="SaveRedirect();return false; "  value="Save" id="savebutton"/>
                    </td></tr></table>
              </apex:outputPanel>
            </apex:pageBlockSectionItem>
          </apex:pageBlockSection>
        </apex:pageBlock>
      </apex:actionRegion>
    </apex:outputPanel>
  </apex:form>
</apex:page>