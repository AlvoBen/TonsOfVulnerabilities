<!--
Apex Page Name : screenFlow.page
Version         : 1.0
Created On      : 10/19/2021
Function        : This page is used to open lighting flow

Modification Log:
* Developer Name            Code Review           Date                       Description
* Aishwarya Pawar                                 10/19/2021                 Original version 
* Santhi Mandava                                  08/24/2022                 Fixed duplicate templates issue
**************************************************************************************************-->

<apex:page id="screenFlow" showHeader="false" sidebar="false" lightningStylesheets="true">
    <html>
    <head>
        <apex:includeLightning />
    </head>
    <body class="slds-scope">
    <div id="screenFlow"/>
    <script>
        let flowCmp;
        let statusChange = function (event) {
            parent.postMessage({
                flowStatus: event.getParam("status"),
                flowParams: event.getParam("outputVariables"),
                flowOrigin: "{!$CurrentPage.parameters.origin}"
            }, "{!$CurrentPage.parameters.origin}");
           if(event.getParam("status") === 'FINISHED') {
               flowCmp.destroy();
           }
        };
        $Lightning.use("c:screenFlowApp", function () {
            // Create the flow component and set the onstatuschange attribute
            $Lightning.createComponent("lightning:flow", {"onstatuschange": statusChange},
                "screenFlow",
                function (component) {
                    flowCmp = component;
                    component.startFlow("{!$CurrentPage.parameters.flowname}", {!$CurrentPage.parameters.params});
                }
            );
        });
    </script>
    </body>
    </html>
</apex:page>