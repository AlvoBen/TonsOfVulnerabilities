<!--
Page Name        : HUMCustomInteractionlog
Version          : 1.0 
Created Date     : 05/21/2014 
Function         : This Page holds Interaction Log opened in Bottom Side bar section of Member detail pages.
Modification Log :

*   Modification ID     Developer               Code Review             Date                 Description
* -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------               
*   1.0                 Ninad Patil             16484                   05/21/2014            Original       
*   1.1                 Ninad Patil             16484                   06/17/2014            Modified for Multiple Interaction Members
*   1.2                 Ninad Patil             16484                   06/27/2014            Moved Significant portion of java script to Another file. 
*   1.3                 Pradeep Raju            16484                   06/30/2014            Commenting out the code related to alerts
*   1.4                 Pradeep Raju            16484                   07/03/2014            Uncommented the code for alerts
*   1.5                 Pradeep Raju            16484                   07/10/2014            Commented out the code for alerts
*   1.6                 Pradeep Raju            16484                   07/11/2014            Uncommented the code for alerts
*   1.7                 Shreya Choodamani       16484                   07/23/2014            Commented the code for alerts
*   1.8                 Shreya Choodamani       16484                   07/24/2014            Uncommented the code for alerts
*   1.9                 Ninad Patil             17100                   08/09/2014            Resubmitting After coding standards correction.   
*   2.0                 Pradeep Raju            17100                   08/10/2014            Commented out the code for alerts
*   2.1                 Pradeep Raju            17100                   08/11/2014            Uncommented the code for alerts
*   2.2                 Ninad Patil             18313                   10/07/2014            fixed code review comment : sAccId removed.
*   2.3                 Shreya Choodamani       20233                   01/06/2015            Added action function and action status for the Save button added as per REQ - 66088
*   2.4                 Pradeep Raju            24021                   06/17/2015            Updated the code at lines# 152 & 156 to make use of custom labels
*   2.5                 Sagar Tapadia           25983                   08/21/2015            Added Loading Action Status for Buttons and also changed re rendering of panels based on button click.
*   2.6                 Sharan Shanmugam        29837                   02/10/2016            Re raising it for review as part of Story REQ - 220870
*   2.7                 Harshith Mandya         26131                   04/13/2016            Defect Fix #210892.0001
*   2.8                 Harshith Mandya         26131                   04/13/2016            Defect Fix #221203.0001
*   2.9                 Pradeepkumar Dani       46100                   10/19/2016            UI changes as part of REQ - 287463.
*   2.10		        Praveen Kumar Parimi    72345                   02/17/2017            Fixed the CA Ticket - 6366647 AKA REQ - 301433.
*   2.11				Pooja Kumbhar									04/29/2020			  Checkmarx ActionPoller Frequency Check error fix.
*   2.12				Pooja Kumbhar									05/14/2020		      Checkmarx Not resolved
*   2.13                Satyam Malviya                                  02/01/2021            user story 1826725 -  PR00090631 - MF 2 - SF - TECH - NBA Clean up - part 1     
*   2.14                Mithra Bharadwaj                               02/09/2021            US#1522825 SonarQube Changes
-->
<apex:page controller="HUMCustomInteractionLogController" id="intPage">
  <apex:includeScript value="/support/console/35.0/integration.js" />
  <apex:includeScript value="{!URLFOR($Resource.HUMInteractionLog,'/HUMInteractionLog/HUMCustomInteractionLogPage.js')}" />
  <apex:stylesheet value="{!URLFOR($Resource.HUMInteractionLog,'/HUMInteractionLog/HUMCustomInteractionLogDetailPageStyle.css')}" />
  <apex:stylesheet value="{!URLFOR($Resource.HUMInteractionLog,'/HUMInteractionLog/HUMCustomIntLogStyle.css')}"/>
  <!--Start of Form -->
  <apex:form id="intForm">
    <apex:pageBlock id="pbIntLogPage" mode="edit" title="{!$Label.HUMIntLogTitle}">
      <apex:pageMessages id="pgIntMsg" />
      <apex:actionFunction action="{!validateAssociateCaseButton}" name="validateAssociateCaseButton" reRender="pbIntLogPage" status="pleaseWaitInt">
        <apex:param assignTo="{!recordId}" name="resultId" value="" />
      </apex:actionFunction>
      <apex:actionFunction reRender="pbIntLogPage" name="disableAssignCase" action="{!disableAssociateCaseButton}" status="pleaseWaitInt"/>
      <apex:pageBlockButtons location="top">
        <apex:commandButton onclick="saveInteraction();" reRender="pbsInteractionLog" value="{!$Label.HUMSaveBtn}" />
        <apex:commandButton onclick="save();" reRender="pbsInteractionLog" value="{!$Label.HUMAssociateInteraction}" rendered="{!bAssignCase}"/>
        <apex:commandButton onclick="SaveAndNew();return false;" reRender="pbsInteractionLog" value="{!$Label.HUMSaveNewBtn}" />
      </apex:pageBlockButtons>
      <apex:actionRegion >
        <apex:pageBlockSection columns="3" id="pbsInteractionLog">
          <apex:panelgrid columns="1" styleClass="panelGridStyle">
            <br/>
            <br/>
            <apex:pageblockSectionItem >
              <apex:outputpanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText styleClass="fieldStyle" value="{!$Label.HUMIntNameFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:outputField value="{!oFetchInteraction.Caller_Name__c}" />
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputpanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText value="{!$Label.HUMIntWithFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:outputField value="{!oFetchInteraction.Interacting_With__c}" rendered="{!bAccessInteractingWith}" />
                      <apex:outputText value="{!oFetchInteraction.Interacting_With__r.Name}" rendered="{!!bAccessInteractingWith}" />
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputpanel >
                <table class="tabStyle IWT-Margin">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText value="{!$Label.HUMIntWithTypeFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:outputField value="{!oFetchInteraction.Interacting_With_type__c}" />
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
          </apex:panelgrid>
          <apex:panelgrid columns="1" styleClass="panelGridStyle">
            <apex:pageblockSectionItem >
              <apex:outputPanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText styleClass="fieldStyle" value="{!$Label.HUMIntOriginFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:inputField value="{!oFetchInteraction.Interaction_Origin__c}" />
                    </td>
                  </tr>
                </table>
              </apex:outputPanel>
            </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputPanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText value="{!$Label.HUMIntNumberFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:outputField label="Name" value="{!oFetchInteraction.name}" />
                    </td>
                  </tr>
                </table>
              </apex:outputPanel>
            </apex:pageblockSectionItem>
            <apex:pageblockSectionItem id="pbsSectInqAbt">
              <apex:outputpanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText value="{!$Label.HUMIntAboutFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:selectList id="selectINqAbout" multiselect="false" onchange="JSonchangeInqAbt(this.options[this.selectedIndex].value,this.options[this.selectedIndex].Text);" size="1" value="{!oHUMIntMemers.Interacting_About__c}">
                        <apex:selectOptions value="{!lstSelectOptionIntAbt}" />
                      </apex:selectList>
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputPanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText value="{!$Label.HUMIntAboutTypeFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:outputField value="{!oHUMIntMemers.Interacting_About_Type__c}" />
                    </td>
                  </tr>
                </table>
              </apex:outputPanel>
            </apex:pageblockSectionItem>
          </apex:panelgrid>
          <apex:panelgrid columns="1" styleClass="panelGridStyleSmall">

          </apex:panelgrid>
        </apex:pageBlockSection>
      </apex:actionRegion>
    </apex:pageBlock>
    <!-- Action Function starts -->
    <apex:actionFunction action="{!initializeInteraction}" name="setRecordId" onComplete="getPrimaryTabObjectId();" reRender="pbsInteractionLog,fnonChangeINqAbt">
      <apex:param assignTo="{!sStandardUrl}" name="resultId" value="" />
    </apex:actionFunction>
    <apex:actionFunction action="{!save}" status="pleaseWaitInt" name="setRecordIdAccCase" oncomplete="refreshTab();" reRender="pbsInteractionLog,pgIntMsg,fnonChangeINqAbt">
      <apex:param assignTo="{!sAccountId}" name="resultId" value="" />
    </apex:actionFunction>
    <apex:actionFunction action="{!saveInteractionRecord}" name="setRecordIdAccInt" onComplete="synchAllLogs();" reRender="pbsInteractionLog,pgIntMsg" status="pleaseWaitInt"></apex:actionFunction>
    <apex:actionFunction status="pleaseWaitInt" action="{!SaveAndNew}" name="actFnSaveAndNew" oncomplete="EventFiring();" reRender="pbsInteractionLog,pgIntMsg,fnonChangeINqAbt">
      <apex:param assignTo="{!sAccountId}" name="resultId" value="" />
    </apex:actionFunction>
    <apex:actionFunction status="pleaseWaitInt" action="{!SaveAndNew}" name="actFnSaveAndNewVFPage" oncomplete="EventFiring();" reRender="pbsInteractionLog,pgIntMsg,fnonChangeINqAbt">
    </apex:actionFunction>
    <apex:actionFunction action="{!flushInteraction}" name="flushInteraction" reRender="intForm" />
    <apex:actionFunction status="pleaseWaitInt" action="{!onChangeInqAbt}" name="onChangeInqAbt" oncomplete="openPrimaryTabsOnchange();" reRender="pbsInteractionLog,fnonChangeINqAbt">
      <apex:param assignTo="{!sAccountId}" name="resultId" value="" />
    </apex:actionFunction>
    <apex:actionStatus id="pleaseWaitInt">
      <apex:facet name="start">
        <div class="waitingSearchDiv waitingSearchDivOpacity outerPanel" ></div>
        <div id="searchingStatus" class="waitingSearchDiv innerPanel">
          <div class="waitingHolder" style="imageClass">
            <img class="waitingImage" src="/img/loading.gif"/>
            <span class="waitingDescription">{!$Label.HUMLoadingStatus}</span>
          </div>
        </div>
      </apex:facet>
      <apex:facet name="stop"/>
    </apex:actionStatus>
    <!-- Action Function ENDS -->
    <!-- Purpose of the below output panel is to reRender JS function to get updated values from Controller  -->
    <apex:outputpanel id="fnonChangeINqAbt">
      <script type="text/javascript">
        var sAccId = '{!JSENCODE(sAccountId)}';
        var sInteractionId = '{!JSENCODE(oFetchInteraction.id)}';
        var sAccName = '{!JSENCODE(sAccName)}';
        var prevSelectedInqAbt = '{!JSENCODE(sPrevSelectedInqAbt)}';
        var currSelectedInqAbt = document.getElementById("{!$Component.intPage.intForm.pbIntLogPage.pbsInteractionLog.pbsSectInqAbt.selectINqAbout}");
        var bGetAccess = '{!JSENCODE(IF(bGetAccess, "true", "false"))}';

        window.onload = function() {
        if (sforce.console.isInConsole()) {
        getEnclosingPrimaryTabId();
        }
        }
        sforce.console.onFocusedSubtab(eventHandler);
      </script>
    </apex:outputpanel>
  </apex:form>
  <!--End of Form-->
</apex:page>