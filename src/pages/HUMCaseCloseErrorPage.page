<!--
Page Name        : HUMCaseCloseErrorPage
Version          : 1.0 
Created Date     : 03/20/2015 
Function         : Page is used to display error message and list of open work tasks to end user
                   when user tries close case with open tasks

Modification Log :
*  Developer Name                    Code Review               Date                 Description
* ------------------------------------------------------------------------------------------------------------------------------                
*  SuryaKumari Medicherla           22085                    03/20/2015            Original Version 
*  SuryaKumari Medicherla                                    04/13/2015            Code Modified to Fix Defect: 179525 
*  Manish Kumar                                              04/13/2015            Code Modified to Fix Defect: 179516 
*  Amar Gadewar                                              06/08/2017            Code Modified to Fix Defect: 293493 
*  Atia Uzma                                                 02/19/2021          User Story 1956960: T1PRJ0001827 - MF 1 - SF - TECH - On/Off Switch Cleanup for 11/20/2020 , 02/12/2021, 03/05/2021 and 3/19/2021 releases (CRM)
-->
<apex:page id="thePage" standardController="Case" action="{!CaseClose}" extensions="HUMCaseCloseErrorPageExtension"  sidebar="false">
  <apex:includeScript value="/soap/ajax/26.0/connection.js"/>
  <apex:includeScript value="/support/console/26.0/integration.js"/>
  <apex:includeScript value="{!$Resource.HUMCaseCloseErrorPage}"/>
  <apex:stylesheet value="{!URLFOR($Resource.HUMTaskEditPage, 'main.css')}"/>
  <apex:sectionHeader title="{!$Label.HUMCaseClose}"/>
  <script>
    primaryID = '';
    window.onLoad = onLoadFunction();
  </script>

  <apex:form id="theForm">
    <apex:outputpanel id="theOP">
      <apex:pageBlock mode="edit" title="{!$Label.HUMCaseEdit}">
        <apex:pageblockButtons location="top">
          <apex:commandButton action="{!returnToCase}" value="{!$Label.HUMReturnToCase}" immediate="true"/>
        </apex:pageblockButtons>
        <apex:pageMessages ></apex:pageMessages>
      </apex:pageBlock>
      <apex:outputpanel id="tasks">
        <apex:pageBlock mode="edit" title="{!$Label.HUMOpenTasks}" rendered="{!bRenderTaskFlag}">
          <apex:pageblockTable value="{!lstTasks}" var="oTask">
            <apex:column >
              <apex:facet name="header">{!$Label.HumTaskNumber}</apex:facet>
              <a href="javascript:void(0);" onclick="openTaskEditPage(true,'{!JSENCODE(oTask.id)}');return false;">{!oTask.Task_Number__c}</a>
            </apex:column>
            <apex:column >
              <apex:facet name="header">{!$Label.HumTaskType}</apex:facet>
              <apex:outputText value="{!oTask.type}"/>
            </apex:column>
            <apex:column value="{!oTask.Status}"/>
            <apex:column value="{!oTask.Priority}"/>
            <apex:column >
              <apex:facet name="header">{!$Label.HUMDateTimeOpen}</apex:facet>
              <apex:outputField value="{!oTask.CreatedDate}"/>
            </apex:column>
            <apex:column >
              <apex:facet name="header">{!$Label.HUMDateTimeClosed}</apex:facet>
              <apex:outputText value="{!oTask.Date_Time_Closed__c}"/>
            </apex:column>
            <apex:column >
              <apex:facet name="header">{!$Label.HumAgeSinceCreated}</apex:facet>
              <apex:outputText value="{!oTask.Age_Since_Created__c}"/>
            </apex:column>
            <apex:column value="{!oTask.ActivityDate}"/>
            <apex:column >
              <apex:facet name="header">{!$Label.HumCreatedBy}</apex:facet>
              <apex:outputText value="{!oTask.CreatedBy.Name}"/>
            </apex:column>
            <apex:column >
              <apex:facet name="header">{!$Label.HumCreatedByqueue}</apex:facet>
              <apex:outputText value="{!oTask.Created_By_Queue__c}"/>
            </apex:column>
            <apex:column value="{!oTask.Task_Owner__c}"/>
            <apex:column value="{!oTask.Owner_Queue__c }"/>
          </apex:pageblockTable>
        </apex:pageBlock>
      </apex:outputpanel>
    </apex:outputpanel>
    <apex:actionFunction name="reQueryRecords"  action="{!CheckForOpenTaskCountCount}" reRender="theOP"/>
  </apex:form>

  <script>
    //Below variables will be used by Javascript functions in the static resource
    var primaryID;

    var taskID = '{!JSENCODE(sParentID)}';

    var tabTitle = '{!JSENCODE(sParentName)}'

    var TaskEditPageName ='{!$Page.HUMTaskEditPage}';


  </script>
</apex:page>