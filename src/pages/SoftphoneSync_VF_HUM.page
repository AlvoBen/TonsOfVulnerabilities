<!--
Page Name        : SoftphoneSync_VF_HUM.page
Version          : 1.0
Created On       : 08/10/2019
Function         : Page used for sync users from CRM to DB2.

Modification Log: 
* Developer Name           Code Review                 Date                         Description
*-----------------------------------------------------------------------------------------------------------------------------
* Joel George                                     08/10/2019                   Original Version
****************************************************************************************************************************
-->
<apex:page standardController="Softphone_Agent__c" recordSetVar="agents" extensions="SoftPhoneSync_C_HUM" lightningStylesheets="true">
    
    <script src="/support/console/36.0/integration.js"/>
    <script src="{!URLFOR($Resource.CRM_JQUERY, 'jquery.min.js')}"></script>
    <script src="{!URLFOR($Resource.CRM_JQUERY, 'jquery-ui.min.js')}" />
    
    <script>
//dont enable P9 Critical Fix    $j = jQuery.noConflict(true);    
    var vbatchSize = {!batchSize};
    var vtotalSize = {!totalSize};
    var vProcessed = (vbatchSize < vtotalSize) ? vbatchSize : vtotalSize ;
    var t1 = new Date();    
    
    function updateMessage()
    {
        //TIME STAMP START
        var t2 = new Date();
        var dif = t1.getTime() - t2.getTime();       
        var Seconds_from_T1_to_T2 = dif / 1000;
        var Seconds_Between_Dates = Math.abs(Seconds_from_T1_to_T2);
        t1 = new Date(); 
        //TIME STAPMP END
        
        if(vProcessed >= vtotalSize)
        {
            jQuery("[id$='text']")[0].style.display = 'none';
            jQuery("[id$='statusImage_div']")[0].style.display = 'none';
            
            jQuery("[id$='InfoPanel1']")[0].style.display = 'block'; 
            jQuery("[id*='buttons']")[0].style.display = 'block';           
        }
        else if(vProcessed < vtotalSize)
        {
            vProcessed += ( (vProcessed + vbatchSize ) < vtotalSize ) ? vbatchSize : (vtotalSize - vProcessed) ; 
            jQuery("[id$='text']")[0].innerText = "    Please wait... Syncing "+vProcessed+" of " +vtotalSize+ " records";
            LoadHumanaTwo();
        }
    }
    </script>  
    <apex:form id="theForm">
        <apex:pageblock mode="maindetail">
            <apex:outputPanel id="InfoPanel" style="display:none">               
                <apex:outputText id="text1" value="  Syncing of {!totalSize} records is complete, please click to return" escape="false"/>
                <input type="button" name="Return" value="Return" id="submitorder" onclick="updateMessage()" /> 
            </apex:outputPanel>
            <apex:outputPanel id="InfoPanel1" style="display:none">
                <apex:PageMessage strength="2" summary="Syncing of {!totalSize} records is complete, please click to return" severity="Info" />
            </apex:outputPanel>
            
            <div id="statusImage_div" style="text-align:center; vertical-align: middle; margin-top:10%"> 
                <img src="/img/loading.gif" /> 
                <apex:outputText id="text" value="  Please wait... Syncing {!IF((batchSize < totalSize), batchSize, totalSize)} of {!totalSize} records" escape="false"/>
            </div> 
            
            <apex:outputPanel id="InfoPanel2" style="display:none">
                <input type="button" name="Return" value="Return" id="submitorder" onclick="updateMessage()" /> 
            </apex:outputPanel>
            
            <apex:pageblockButtons id="buttons" location="bottom" style="display:none">
                <apex:commandButton action="{!pageref}" value="Return" style="margin-left: 20%;"/>
            </apex:pageblockButtons>
            
            <apex:actionFunction action="{!invokeSoftPhoneService}" name="LoadDataHumanaOne" oncomplete="updateMessage();"/>
            <apex:actionFunction action="{!invokeSoftPhoneService}" name="LoadHumanaTwo" oncomplete="updateMessage();" rerender="theForm"/>
        </apex:pageblock>
    </apex:form>
    
    <script>
    LoadDataHumanaOne();
    </script>
</apex:page>