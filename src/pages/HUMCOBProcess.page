<!--
Page Name        : HUMCOBProcess
Version          : 1.0 
Created Date     : 05/21/2014 
Function         : This Page is used to display the COB Case Action details.
Modification Log :
*   Modification ID     Developer               Code Review             Date                 Description
* ------------------------------------------------------------------------------------------------------------------------------                
*   1.0              Krishna Tadikonda              17929           07/02/2014                 Original     
*   2.0              Krishna Tadikonda              18164           09/24/2014                 Added action function to call a function onclick of the  Add OI checkbox
*   3.0              Asha Deepika Koyyana           19409           11/14/2014                 As per Requirement 70318,added action function to call a function onchange of OI carrier Name, to 
                                                                                               display Other Carrier Name field when  Other Carrier is selected in OI carrier name.
*   4.0              Asha Deepika Koyyana           19843           12/09/2014                Fixed defect #164313      
*   5.0              Krishna Tadikonda                              01/20/2015                Fixed defect #168928 
*   6.0              Santhi Mandava                 23304           05/22/2015                Updated script to include unsaved changes popup.                                                                
*   7.0              Santhi Mandava                 24209           06/22/2015                Updated script to resolve unsaved changes popup in save button click.
*   8.0              Prudhvi Pamarthi                               01/27/2020                REQ - 406052 REGRESSION defect 429477.0001
*   9.0              Prudhvi Pamarthi                               02/25/2020                REQ - 406052 defectfix#458463.0001
*  10.0              Vardhman Jain                                  02/29/2024                US5303780 - Classic VIT  Remediation COB, Policy Member, Verify and update Demographics ; VIT37070839, VIT37935980,   VIT37935986
*  ------------------------------------------------------------------------------------------------------------------------------      
-->
<apex:page controller="HUMCOBProcessController" sidebar="false" action="{!personResponseMethod}">

  <apex:stylesheet value="{!URLFOR($Resource.HUMCOBProcess, '/HUMCOBProcess/HUMCOBProcessCSS.css')}" />
  <apex:includeScript value="{!URLFOR($Resource.HUMCOBProcess, '/HUMCOBProcess/HUMCOBProcessJS.js')}" />
  <apex:includeScript value="/support/console/31.0/integration.js" />
  <apex:includeScript value="{!$Resource.HUMUnSavedChangesJS}"/>

  <apex:form id="frm">
    <apex:outputPanel id="op1">

      <apex:actionfunction name="checkCloseTab" action="{!saveAction}" oncomplete="returnToMainTab(false);" rerender="op1, errMsg"/>
      <!-- Minimum script that should remain on Page -->
      <script>
        var tId;
        var currentTabID;
        var isSuccess;

        function returnToMainTab(isCancel) {
        tId = '{!JSENCODE(sTabId)}';
        isSuccess = '{!bIsSuccess}';
        if(isSuccess == 'true' || isCancel)
        {
			var buttons = document.getElementsByClassName('btn');
			for (var i = 0; i < buttons.length; i++) {
				var button = buttons[i];
				button.disabled = true;
				button.className = 'btn btnDisabled';
			}
            resetTabUnsavedChanges();
         }
         else{
			var buttons = document.getElementsByClassName('btn');
            for (var i = 0; i < buttons.length; i++) {
				var button = buttons[i];
				button.disabled = false;
				button.className = 'btn';
            }
         } 
       }
      </script>


    </apex:outputPanel>
    <apex:pageMessages escape="false" id="errMsg" />
    <apex:pageBlock id="pbView" rendered="{!sLoadView == $Label.HUMCOBView}">
      <apex:outputpanel >
        <script>
          window.onload = testSetTabUnsavedChanges('COBReadMode');
        </script>
      </apex:outputpanel>
      <div>
        <table class="list">
          <thead class="rich-table-thead">
            <tr class="headerRow">
              <apex:outputpanel rendered="{!RowDispTableMapSize > 0}">
                <apex:repeat value="{!rowdispTableMap[1]}" var="response_row">
                  <th class="headerRow">
                    <center>
                      <apex:outputtext value="{!response_row.column_title__c}" />
                    </center>
                  </th>
                </apex:repeat>
              </apex:outputpanel>
            </tr>
          </thead>
          <apex:repeat value="{!columnrows}" var="row_num">
            <tr>
              <apex:repeat value="{!rowdispTableMap[row_num]}" var="response_row">
                <td align="center">
                  <apex:outputField rendered="{!response_row.Grid_Question__r.Question_Type__c == $Label.HUMCOBTextType}" value="{!response_row.response__c}" />
                  <apex:outputfield rendered="{!response_row.Grid_Question__r.Question_Type__c == $Label.HUMCOBCheckboxType}" value="{!response_row.boolean_response__c}" />
                  <apex:outputfield rendered="{!response_row.Grid_Question__r.Question_Type__c == $Label.HUMCOBDateQuestionType}" value="{!response_row.date_response__c}" />
                  <apex:outputfield rendered="{!response_row.Grid_Question__r.Question_Type__c == $Label.HUMCOBDropDownType && response_row.response__c != $Label.HUMCOBNoneSelectOption}" value="{!response_row.response__c}" />
                </td>
              </apex:repeat>
            </tr>
          </apex:repeat>
        </table>
      </div>
      <div>
        <br />
        <br />
        <apex:pageblocksection columns="1" title="{!$Label.HUM_Add_OI_Information}">
          <apex:pageblocktable value="{!dispCaseResponses}" var="res">
            <apex:column style="align:left; width:50%;">
              <apex:outputtext value="{!res.Process_Question__c}" />
            </apex:column>
            <apex:column style="align:left; width:50%;">
              <apex:outputtext value="{!res.Process_Question_Response__c}" />
            </apex:column>
          </apex:pageblocktable>
        </apex:pageblocksection>
      </div>
    </apex:pageBlock>
    <!-- Process Edit Page Starts Here -->
    <apex:pageBlock id="pbEdit" rendered="{!sLoadView == $Label.HUMCOBEdit}">
      <apex:outputpanel >
        <script>
          window.onload = testSetTabUnsavedChanges('COB');
        </script>
      </apex:outputpanel>
      <apex:pageBlockButtons id="pbb">
        <apex:actionStatus id="saveStatus">
          <apex:facet name="stop">
            <apex:commandButton id="saveId" rerender="errMsg" value="{!$Label.HUMCaseActionSaveBtn}" onClick="this.disabled=true;" oncomplete="checkCloseTab();" status="saveStatus"/>
          </apex:facet>
          <apex:facet name="start">
            <apex:commandButton value="{!$Label.HUMCaseActionSaveBtn}" status="saveStatus" disabled="true" />
          </apex:facet>
        </apex:actionStatus>
        <apex:commandButton id="cancelId" value="{!$Label.HUMCancel}" action="{!cancel}" oncomplete="returnToMainTab(true);" />
      </apex:pageBlockButtons>

      <apex:pageBlock id="pb">
        <apex:pageBlockSection dir="LTR" columns="1" collapsible="false" id="PgSection1">

          <!--  COB Tabular Row Starts here-->
          <apex:actionregion >
            <apex:pageblock id="InitTable" title="{!$Label.HUMGuide}" rendered="{!boolRenderMainTable}">
              <div class="pbBody">
                <table class="list">

                  <thead class="rich-table-thead">
                    <tr class="headerRow">
                      <apex:outputpanel rendered="{!mapSequenceResponsesSize > 0}">
                        <apex:repeat value="{!mapSequenceResponses[1]}" var="response_row">
                          <apex:outputpanel rendered="{!response_row.boolCOBTableDisplay}">
                            <th style="align:center" class="headerRow">
                              <apex:outputtext rendered="{!response_row.boolCOBTableDisplay}" value="{!response_row.responseRec.column_title__c}" />
                            </th>
                          </apex:outputpanel>
                        </apex:repeat>
                      </apex:outputpanel>
                    </tr>
                  </thead>
                  <apex:repeat value="{!lstRowHolders}" var="row_num">
                    <tr>
                      <apex:repeat value="{!mapSequenceResponses[row_num]}" var="response_row">
                        <apex:outputpanel rendered="{!response_row.boolCOBTableDisplay}">
                          <td>
                            <apex:outputfield rendered="{!response_row.sDataType == $Label.HUMCOBTextType}" value="{!response_row.responseRec.response__c}" />
                            <apex:inputfield rendered="{!response_row.sDataType == $Label.HUMCOBCheckboxType}" onclick="prepareAddOITable('{!response_row.responseRec.Row_Number__c}','{!response_row.responseRec.column_title__c}','{!response_row.responseRec.boolean_response__c}');checkVerified(this.id,'{!response_row.responseRec.column_title__c}');false" value="{!response_row.responseRec.boolean_response__c}">
                            </apex:inputfield>
                            <apex:outputfield rendered="{!response_row.sDataType == $Label.HUMCOBDateQuestionType}" value="{!response_row.responseRec.response__c}" />
                            <apex:outputfield rendered="{!response_row.sDataType == $Label.HUMCOBDropDownType}" value="{!response_row.responseRec.response__c}" />

                          </td>
                        </apex:outputpanel>
                      </apex:repeat>
                    </tr>
                  </apex:repeat>
                </table>
              </div>
              <apex:actionfunction action="{!prepareAddOITable}" name="prepareAddOITable"  rerender="AddOIPanel,RemoveOIPanel,QuestionsDisplayBlock" status="RenderStatus">
                <apex:param name="pingId" assignTo="{!iRowNumAddOI}" value=""/>
                <apex:param name="colName" assignTo="{!sColumnName}" value="" />
                <apex:param name="boolValue" assignTo="{!boolOIResponse}" value=""/>
              </apex:actionfunction>
            </apex:pageblock>
          </apex:actionregion>
          <!--  COB RemoveOI Row Starts here-->
          <apex:outputPanel id="RemoveOIPanel">
            <apex:pageblock id="RemoveOI" rendered="{!boolRenderRemoveOI}" title="{!$Label.HUM_Remove_OI}">
              <div class="pbody">
                <table class="list">
                  <tr class="headerRow">
                    <apex:repeat value="{!mapSequenceResponses[1]}" var="response_row">
                      <td style="display:{!IF(response_row.boolRemoveOITableDisplay,'','none')};">
                        <apex:outputpanel rendered="{!response_row.boolRemoveOITableDisplay}">
                          <apex:outputtext rendered="{!response_row.boolRemoveOITableDisplay}" value="{!response_row.responseRec.column_title__c}" />
                        </apex:outputpanel>
                      </td>
                    </apex:repeat>
                  </tr>
                  <apex:repeat value="{!lstRowHolders}" var="row_num">
                    <tr class="headerRow">
                      <apex:repeat value="{!mapSequenceResponses[row_num]}" var="response_row">
                        <td style="display:{!IF(response_row.boolRemoveOITableDisplay,'','none')};">
                          <apex:outputpanel rendered="{!mapRemoveOIRowDisplayBool[row_num]}">
                            <apex:outputPanel rendered="{!response_row.boolRemoveOITableDisplay}">
                              <apex:outputfield rendered="{!response_row.sDataType == $Label.HUMCOBTextType && response_row.responseRec.column_title__c != $Label.HUMCOBOtherCarrierName}" value="{!response_row.responseRec.response__c}" />
                              <apex:inputfield rendered="{!response_row.sDataType == $Label.HUMCOBCheckboxType}" value="{!response_row.responseRec.boolean_response__c}">
                                <apex:actionsupport action="{!reCalculateRemoveOIDisplay}" event="onclick" rerender="RemoveOIPanel" status="RenderStatus">
                                  <apex:param name="rownum" value="{!row_num}" assignTo="{!iRowNumRemoveOI}"/>
                                </apex:actionsupport>
                              </apex:inputfield>
                              <apex:outputpanel rendered="{!response_row.boolDisplayCancellationDate}">
                                <apex:inputfield rendered="{!response_row.sDataType == $Label.HUMCOBDateQuestionType}" value="{!response_row.responseRec.date_response__c}" />
                              </apex:outputpanel>
                              <apex:selectList rendered="{!response_row.sDataType == $Label.HUMCOBDropDownType}" size="1" value="{!response_row.sSelectedPicklistValue}">
                                <apex:selectOptions value="{!response_row.lstPicklistValues}" />
                                <apex:actionsupport action="{!displayOtherCarrier}" event="onchange" rerender="RemoveOIPanel" status="RenderStatus">
                                  <apex:param name="rownum" value="{!row_num}" assignTo="{!iRowNumRemoveOI}"/>
                                  <apex:param value="{!response_row.sSelectedPicklistValue}" name="OICarrierValue" assignTo="{!sOICarrierValue}" />
                                </apex:actionsupport>
                              </apex:selectList>
                              <apex:outputpanel rendered="{!response_row.boolDisplayOtherCarrier && response_row.responseRec.column_title__c == $Label.HUMCOBOtherCarrierName}">
                                <apex:inputfield rendered="{!response_row.sDataType == $Label.HUMCOBTextType}" value="{!response_row.responseRec.response__c}" />
                              </apex:outputpanel>
                            </apex:outputPanel>
                          </apex:outputpanel>
                        </td>
                      </apex:repeat>
                    </tr>
                  </apex:repeat>
                </table>
              </div>
            </apex:pageblock>
          </apex:outputPanel>
          <!--  COB AddOI Row Starts here-->
          <apex:outputPanel id="AddOIPanel">
            <apex:pageblock id="AddOI" rendered="{!boolRenderAddOI}" title="{!$Label.HUM_Add_OI}">
              <table class="list">
                <thead class="rich-table-thead">
                  <tr class="headerRow">
                    <apex:repeat value="{!mapSequenceResponses[1]}" var="response_row">
                      <td style="display:{!IF(response_row.boolAddOITableDisplay,'','none')};">
                        <apex:outputpanel rendered="{!response_row.boolAddOITableDisplay}">
                          <apex:outputtext rendered="{!response_row.boolAddOITableDisplay}" value="{!response_row.responseRec.column_title__c}" />
                        </apex:outputPanel>
          </td>
          </apex:repeat>
          </tr>
          </thead>
          <apex:repeat value="{!lstRowHolders}" var="row_num">
            <tr style="display:{!IF(mapAddOIRowDisplayBool[row_num],'','none')};">
              <apex:repeat value="{!mapSequenceResponses[row_num]}" var="response_row">
                <td style="display:{!IF(response_row.boolAddOITableDisplay,'','none')};">
                  <apex:outputpanel rendered="{!mapAddOIRowDisplayBool[row_num]}">
                    <apex:outputPanel rendered="{!response_row.boolAddOITableDisplay}">
                      <apex:outputfield rendered="{!response_row.sDataType == $Label.HUMCOBTextType  && response_row.responseRec.column_title__c != $Label.HUMCOBOtherCarrierName}" value="{!response_row.responseRec.response__c}" />
                      <apex:inputfield rendered="{!response_row.sDataType == $Label.HUMCOBCheckboxType}" value="{!response_row.responseRec.boolean_response__c}" />
                      <apex:inputfield rendered="{!response_row.sDataType == $Label.HUMCOBDateQuestionType}" value="{!response_row.responseRec.date_response__c}" />
                      <apex:selectList rendered="{!response_row.sDataType == $Label.HUMCOBDropDownType}" size="1" value="{!response_row.sSelectedPicklistValue}">
                        <apex:selectOptions value="{!response_row.lstPicklistValues}" />
                        <apex:actionsupport action="{!displayOtherCarrier}" event="onchange" rerender="AddOIPanel" status="RenderStatus">
                          <apex:param name="rownum" value="{!row_num}" assignTo="{!iRowNumRemoveOI}"/>
                          <apex:param value="{!response_row.sSelectedPicklistValue}" name="OICarrierValue" assignTo="{!sOICarrierValue}" />
                        </apex:actionsupport>
                      </apex:selectList>
                      <apex:outputpanel rendered="{!response_row.boolDisplayOtherCarrier && response_row.responseRec.column_title__c == $Label.HUMCOBOtherCarrierName}">
                        <apex:inputfield rendered="{!response_row.sDataType == $Label.HUMCOBTextType}" value="{!response_row.responseRec.response__c}" />
                      </apex:outputpanel>
                    </apex:outputPanel>
                  </apex:outputpanel>
                </td>
              </apex:repeat>
            </tr>
          </apex:repeat>
          </table>
          </apex:pageblock>
          </apex:outputPanel>
          <!-- Displaying input Questions starts here -->
          <apex:outputpanel id="QuestionsDisplayBlock">
            <apex:pageBlockSection dir="LTR" columns="1" title="{!$Label.HUM_Add_OI_Information}" collapsible="false" id="PgSection1" rendered="{!boolDisplayQuestions}">
              <apex:pageblocktable value="{!lstWrapperQuestions}" var="Question">
                <apex:column style="border-color:white;border-bottom-width:0px;">
                  <apex:panelgrid columns="2" border="0" width="100%" columnClasses="colStyle1,colStyle2" rendered="{!Question.boolDisplayQuestion}">
                    <apex:outputPanel rendered="{!(Question.boolDisplayQuestion && Question.questionRec.Question_Type__c != $Label.HUMCOBLinkType)}" style="align:left;">
                      <apex:outputtext value="{!Question.questionRec.Question_Label__c}"  />
                    </apex:outputPanel>
                    <apex:outputpanel style="align:left;">
                      <apex:outputpanel rendered="{!(Question.questionRec.Question_Type__c == $Label.HUMCOBTextType && Question.boolDisplayQuestion)}">
                        <apex:inputtext value="{!Question.sValue}" />
                      </apex:outputpanel>
                      <apex:outputpanel rendered="{!(Question.questionRec.Question_Type__c == $Label.HUMCOBDateQuestionType && Question.boolDisplayQuestion)}">
                        <apex:inputtext value="{!Question.sValue}" />
                      </apex:outputpanel>
                      <apex:outputpanel rendered="{!(Question.questionRec.Question_Type__c == $Label.HUMCOBTextAreaType && Question.boolDisplayQuestion)}">
                        <apex:inputfield value="{!Question.questionRec.Display_Text_Area__c}" />
                      </apex:outputpanel>
                      <apex:inputfield rendered="{!(Question.questionRec.Question_Type__c == $Label.HUMCOBCheckboxType && Question.boolDisplayQuestion)}" value="{!Question.questionRec.Display_Checkbox__c}" />
                      <apex:selectlist rendered="{!(Question.questionRec.Question_Type__c == $Label.HUMCOBDropDownType && Question.boolDisplayQuestion)}" value="{!Question.sSelectedDropDownOption}" size="1">
                        <apex:selectoptions value="{!Question.lstDropdownOptions}"  />
                        <apex:actionsupport action="{!reCalculatePageQuestions}" event="onchange" rerender="QuestionsDisplayBlock" status="RenderStatus">
                          <apex:param value="{!Question.questionRec.Question_Label__c}" name="labelName" assignTo="{!sQuestionLabelName}" />
                          <apex:param value="{!Question.sSelectedDropDownOption}" name="responseValue" assignTo="{!sResponseValue}" />
                        </apex:actionsupport>
                      </apex:selectlist>
                      <apex:outputLink rendered="{!(Question.questionRec.Question_Type__c == $Label.HUMCOBLinkType  && Question.boolDisplayQuestion)}" style="color:blue;" value="{!Question.questionRec.Display_text__c}">{!Question.questionRec.Question_Label__c}</apex:outputLink>
                    </apex:outputpanel>
                  </apex:panelgrid>
                </apex:column>
              </apex:pageblocktable>
            </apex:pageBlockSection>
          </apex:outputpanel>
        </apex:pageBlockSection>
      </apex:pageBlock>
    </apex:pageBlock>
    <apex:actionStatus id="RenderStatus">
      <apex:facet name="start">
        <div class="waitingSearchDiv waitingSearchDivOpacity" style="width: 100%; height: 300%; display: block; opacity: 0.59;"></div>
        <div id="00B80000007AEEH_searching" class="waitingSearchDiv" style="width: 100%; height: 300%; display: block;">
          <div class="waitingHolder" style="top: 150px; width: 110px;">
            <img class="waitingImage" src="/img/loading.gif" />
            <span class="waitingDescription" style="font-weight:bold; color:Black;">{!$Label.HUMLoadingStatus}</span>
          </div>
        </div>
      </apex:facet>
      <apex:facet name="stop" />
    </apex:actionStatus>

    <c:HUMConstructorExceptionComponent errorLogs="{!lstLogErrors}"/>
  </apex:form>
</apex:page>