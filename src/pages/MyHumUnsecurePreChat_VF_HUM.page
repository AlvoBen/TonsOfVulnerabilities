<!--
Page Name        : MyHumUnsecurePreChat_VF_HUM
Version          : 1.0 
Created Date     : December 12 2019
Function         : Custom window for Post Chat form on Live agent
Modification Log :
*   Modification ID     Developer                     Code Review           Date                 Description
* ------------------------------------------------------------------------------------------------------------------------------                
*   1.0                 Joel George                                         12/12/2019          Original Version
*   1.1                 Joel George                                         02/10/2020          Added Tealium code
*   1.2                 T Prasanna Sai Kumar                                03/11/2021          REQ - 1915578 - Live Agent Security Vulnerabilities for SonarQube Scan - MyHumana UnSecure Live Agent
*   1.3                 Alvaro Madrid                                       08/18/2022          REQ - 3750632 - Adding BotTranscript to LiveChat Agent.
*   1.4                 Kiran Kotni                                         01/04/2023          REQ - 3786815 - Update Unsecure Humana.com Pre Chat Survey
*   1.5                 Kiran Kotni                                         01/04/2023          REQ - 3796187 - Unsecure Auto Created Tabs in CRM
*   1.6                 Alvaro Madrid                                       01/06/2023          US 3792114 - Routing for Unsecure Chats on Humana.com
------------------------------------------------------------------------------------------------------------------------------------>
<apex:page controller="UnsecuredPreChat_C_HUM" showHeader="false" action="{!initVariable}">
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/base.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/framework.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/global.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/global1.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/humanacom.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/humanacom1.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/lib.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/styles.css')}"/>
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/tools.css')}"/> 
    <link rel="stylesheet" text="text/css" href="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/HUMPreChat.css')}"/>
    <!-- Loading jQuery toolkit as per VF standards -->
	<apex:includeScript value="{!URLFOR($Resource.CRM_JQUERY, 'jquery.min.js')}" />  

    <!-- This script takes the endpoint URL parameter passed from the deployment page and makes it the action for the form -->

    <head>
        <style>
            /* Chrome, Safari, Edge, Opera */
            input[type=number]::-webkit-outer-spin-button,
            input[type=number]::-webkit-inner-spin-button {
              -webkit-appearance: none;
              margin: 0;
            }
            
            /* Firefox */
            input[type=number] {
              -moz-appearance: textfield;
            }
        </style>
        <title>Humana Unsecure Chat</title>
    </head>

    <body>
        <!-- Start Tealium analytics v1_3 - do not remove or change -->
    <script type="text/javascript">
        var utag_data = {};
        if (typeof HumAnalytics == "undefined"){
            var HumAnalytics = window.HumAnalytics = {};
        }
        HumAnalytics.appid = [];
        HumAnalytics.autorenewflag = [];
        HumAnalytics.copayexcflag = [];
        HumAnalytics.prodcat = [];
        HumAnalytics.prodid = [];      
        HumAnalytics.prodname = [];
        HumAnalytics.prodpkgqty = [];      
        HumAnalytics.prodqty = [];
        HumAnalytics.prodsav = [];   
        HumAnalytics.prodtranstype = [];          
        HumAnalytics.prodtype = []; 
        HumAnalytics.produp = [];
    </script>

    <!-- Loading script asynchronously -->
    <script type="text/javascript">
        (function(a,b,c,d){
            a='{!JSENCODE(sWebChatVarMap['HumanaUnsecure_Tealium'].value__c)}';
            b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
            a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
            }
        )();
    </script>
    <!-- End Tealium analytics - do not remove or change -->

    <!-- Form that gathers information from the chat visitor and sets the values to Chat Custom Details used later in the example -->
    <form method="post" id="prechatForm">
     <div class="row">
        <div class="small-glass-container">
            <div class=" columns x1 eighteen"> 
                <div class="row">
                    <div class="eighteen columns x1">
                        <div class="lifeblock-heading">
                            <h1 class="link-list-heading lifeblock core-green bl-tail tl-br-curve" tabindex="0">
                                <span class="content">Humana chat</span>
                            </h1>
                        </div>
                    </div>
                </div>
                <apex:outputpanel >
                    <div class="row">
                        <div class="small-glass-container" id="preChat" style="padding-left: 10px;">
                            <div class="row">
                                <div style="margin-left: 10px;margin-right: 10px;">
                                    <p class="x1" style="font-weight: normal !IMPORTANT;">
                                        {!$Label.MyHumana_Thank_You}
                                    </p>
                                </div>
                            </div>
                            <div class="row" id="FnDiv">
                                <p class="x2" style="font-weight: normal !IMPORTANT;">
                                    <img src="https://www.humana.com/Areas/HumanaCom/Content/images/forms/required.png" alt="Required" />Required
                                </p>                                    
                                <label>
                                    First Name <img alt="Required" class="required-icon" id="FirstNameRequired" src="{!URLFOR($Resource.HUMLiveAgentCSS,'/library/images/forms/required.png')}"/>
                                </label>
                                <label class="label" for="firstName">
                                    <img alt="error" class="error-icon displayStyle" id="categorySelectError" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/error.png')}"/>
                                    <span class="field-validation-error errMsgStyle displayStyle" id="categorySelectErrMsg">{!$Label.HUMRequiredErrMsg}</span>
                                </label>
                                <input type="text" name="liveagent.prechat:ContactFirstName" class="six input-text validation" id="firstName" size="20" onfocus="removeErrorClass();"/><br />
                            </div>
                            <br/>
                            <div class="row" id="LnDiv">
                                <label>
                                    Last Name <img alt="Required" class="required-icon" id="categorySelectRequired" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/required.png')}"/>
                                </label>
                                <label class="label" for="lastName">            
                                    <img alt="error" class="error-icon displayStyle" id="categorySelectError" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/error.png')}"/>
                                    <span class="field-validation-error errMsgStyle displayStyle" id="categorySelectErrMsg">{!$Label.HUMRequiredErrMsg}</span>
                                </label>
                                <input type="text" name="liveagent.prechat:ContactLastName" class="six input-text validation" id="lastName" size="20" onfocus="removeErrorClass();"/><br />
                            </div>
                            <br/> 
                            <apex:outputPanel rendered="{!humanaRoutingSwitch}">
                                <div class="row" id="DobDiv">
                                    <label>
                                        Date of Birth (xx/xx/xxxx) <img alt="Required" class="required-icon" id="dateOfBirthRequired" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/required.png')}"/>
                                    </label>
                                    <label class="label" for="dateOfBirth">            
                                        <img alt="error" class="error-icon displayStyle" id="categorySelectError" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/error.png')}"/>
                                        <span class="field-validation-error errMsgStyle displayStyle" id="categorySelectErrMsg">{!$Label.HUMRequiredErrMsg}</span>
                                    </label>
                                    <input type="date" name="liveagent.prechat:DOB" class="six input-text validation" id="dateOfBirth" onfocus="removeErrorClass();"/><br />
                                </div>
                                <br/>
                                <div class="row" id="ZcDiv">
                                    <label>
                                        Zip Code <img alt="Required" class="required-icon" id="zipCodeRequired" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/required.png')}"/>
                                    </label>
                                    <label class="label" for="zipCode">            
                                        <img alt="error" class="error-icon displayStyle" id="categorySelectError" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/error.png')}"/>
                                        <span class="field-validation-error errMsgStyle displayStyle" id="categorySelectErrMsg">{!$Label.HUMRequiredErrMsg}</span>
                                    </label>
                                    <input type="number" name="liveagent.prechat:ZipCode" class="six input-text validation" id="zipCode" maxLength="5" onKeyUp="validateZipCode()" onfocus="removeErrorClass();"/><br />
                                    <div id="errMsg"></div>
                                </div>
                                <br/>
                            </apex:outputPanel>
                            <div class="row">
                                <label>Member ID (optional)</label>
                                <input type="text" name="liveagent.prechat:HumId" class="six input-text validation" id="humId" size="20"/><br />
                                Member ID is required to answer member-specific questions. 
                            </div>
                            <br/>
                            <apex:outputPanel rendered="{!humanaRoutingSwitch}">
                                <div class="row" id="PtDiv">
                                    <label>
                                        Plan Type <img alt="Required" class="required-icon" id="PlanTypeRequired" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/required.png')}"/>
                                    </label>
                                    <label class="label" for="PlanNameSelect">            
                                        <img alt="error" class="error-icon displayStyle" id="categorySelectError" src="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/images/forms/error.png')}"/>
                                        <span class="field-validation-error errMsgStyle displayStyle" id="categorySelectErrMsg">{!$Label.HUMRequiredErrMsg}</span>
                                    </label>
                                    <div class="selector fixedWidth focus">
                                        <span class="userSelectWebKit" id="PlanNameSpan">{!$Label.HUMSelectLabel}</span>
                                        <select id="PlanNameSelect" name="liveagent.prechat:Plan Name" class="validation selector fixedWidth hover" size="1" onchange="onSelectingPlanName(this.options[this.selectedIndex]);" onfocus="removeErrorClass();">
                                            <option value="Select">{!$Label.MyHumUnsecSelect}</option>
                                            <option value="Medicare or Medicaid">{!$Label.MyHumUnsecMedicare}</option>
                                            <option value="Insurance through my employer">{!$Label.MyHumUnsecInsurance}</option>
                                        </select> 
                                    </div>
                                </div>
                                <br/>
                            </apex:outputPanel>
                            <div class="row">
                                <label>What can we help you with? (optional)</label>
                                <div class="fourteen columns x2">
                                    <textarea class="input-text resizeStyle" cols="190" id="issue" name="liveagent.prechat:Issue" onfocus="removeErrorMessage(this);" onkeyup="textLimit(this,200);" rows="6"/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="row x1-top x1">
                                    <p class="x1" style="font-weight: normal !IMPORTANT; padding-left: 10px;">
                                        {!$Label.HUMUnsecureTermsOfUse} 
                                        <a class="link-tertiary" href="#" onclick="fnGoToTermsOfUse();" style="font-weight: normal !IMPORTANT;">
                                            {!$Label.HUMUnsecureTermsOfUse2} 
                                        </a>
                                    </p>
                                </div>
                            </div> 
                            
                            <!-- Interaction  Association starts -->
                            <input type="hidden" name="liveagent.prechat:CallerName" id="prechat_field_name" value="" />
                            <input type="hidden" name="liveagent.prechat:CurrQueue" id="prechat_field_currqueue" value=""/>
                            <input type="hidden" name="liveagent.prechat:IntOrigin" value="Web Chat" />    
                            <input type="hidden" name="liveagent.prechat.findorcreate.map:Interaction__c" value="Caller_Name__c,CallerName;Interaction_Origin__c,IntOrigin;Created_By_Queue__c,CurrQueue"/>
                            <input type="hidden" id="createdInt" name="liveagent.prechat.findorcreate.map.doCreate:Interaction__c" value="Caller_Name__c,true;Interaction_Origin__c,true;Created_By_Queue__c,true" />                           
                            <input type="hidden" name="liveagent.prechat.findorcreate.saveToTranscript:Interaction__c" id="int2" value="Interaction__c"/>
                            <input type="hidden" name="liveagent.prechat.findorcreate.showOnCreate:Interaction__c" id="int3" value="true" />     
                            <!-- Interaction  Association ends -->

                            <input name="liveagent.prechat:ChatType" type="hidden" value="{!sChatType}" id="ChatTypeValue" />
                            <input name="liveagent.prechat.save:ChatType" type="hidden" value="Chat_Type__c"/> 
                            <input name="liveagent.prechat:Skill Name" type="hidden" value="" id="SkillNameLabel" />
                            <input type="hidden" name="liveagent.prechat.name" id="prechat_visitor_name" value="" /> 
                            <input name="liveagent.prechat:Skill Name" type="hidden" value="" id="prechat_field_SkillName" />
                            <input name="liveagent.prechat:BotTranscript" type="hidden" value="" id="BotTranscriptDecrypt" />
                            <input name="liveagent.prechat.save:SecChatID" type="hidden" value="Secondary_Chat_ID__c"/>
                            <input name="liveagent.prechat:SecChatID" id="secchatid" type="hidden" value=""/>
                            <input name="liveagent.prechat.save:SkillName" type="hidden"  value="SkillId"/> 
                            <input name="liveagent.prechat:URL" id="testURI" type="hidden" value=""/>
                            <input name="liveagent.prechat.save:URL" type="hidden" value="URL__c"/>

                            <input name="liveagent.prechat.findorcreate.map:LiveChatTranscript" type="hidden" value="SkillId,SkillName;Secondary_Chat_ID__c,SecChatID;FirstName__c,ContactFirstName;LastName__c,ContactLastName;Humana_ID__c,HumId"/>
                            <input type="hidden" name="liveagent.prechat.findorcreate.map.doCreate:LiveChatTranscript" value="SkillId,true;Secondary_Chat_ID__c,true;FirstName__c,true;LastName__c,true;Humana_ID__c,true" />
                            <input type="hidden" name="liveagent.prechat.findorcreate.showOnCreate:LiveChatTranscript" value="true" />  
                            
                            <input name="liveagent.prechat.save:HumId" type="hidden" value="Humana_ID__c"/>
                            <input name="liveagent.prechat.save:ContactFirstName" type="hidden" value="FirstName__c"/>
                            <input name="liveagent.prechat.save:ContactLastName" type="hidden" value="LastName__c"/>
                            <input name="liveagent.prechat.save:Issue" type="hidden" value="Issue__c"/>
                            <input name="liveagent.prechat:deployment_id" id="depId" type="hidden" value="{!sWebChatVarMap['DeploymentID'].value__c}"/>
                            <input name="liveagent.prechat:org_id" id="comId" type="hidden" value="{!sWebChatVarMap['CompanyID'].value__c}"/>
                            <input name="liveagent.prechat:SelBtnId" type="hidden" id="SelButttonID" value=""/>
                            <input name="liveagent.prechat.findorcreate.displayToAgent:SelBtnId" type= "hidden" value= "false" />
                          
                            <input name="liveagent.prechat.findorcreate.displayToAgent:BotTranscript" type= "hidden" value= "false" />
                            <input name="liveagent.prechat.findorcreate.displayToAgent:deployment_id" type= "hidden" value= "false" />
                            <input name="liveagent.prechat.findorcreate.displayToAgent:org_id" type= "hidden" value= "false" /> 
                            <input name="liveagent.prechat.findorcreate.displayToAgent:InteractionId" type= "hidden" value= "false" />                            
                            <input name="liveagent.prechat:InteractionId" id="interactionid" type="hidden" value=""/>
                            <input name="liveagent.prechat:InteractionName" id="interactionname" type="hidden" value=""/>

                            <input type="submit" value="Start chat" id="prechat_submit" onclick="createSubmitURL();return false;" class="link-primary x1-right"/>
                            <a class="link-tertiary x1-left" href="javascript:window.close();"><span>{!$Label.HUMCancel}</span></a>
                        </div>
                        
                        <div class="row" id="termsOfUse">
                            <div class="thirteen columns x1-left">
                                <H2>
                                    &nbsp;&nbsp;{!$Label.HUMTermsOfUse2}</H2>
                                <div class="row">
                                    <ul class="bulleted">
                                        <li>
                                            {!$Label.Go365_Unsecure_See_Our}
                                            <a class="link-tertiary" href="{!$Label.Unsecure_Legal}" target="_blank" rel="noopener noreferrer">{!$Label.go365_Unsecure_LegalDisclaimer}</a>
                                            {!$Label.Go365_Unsecure_Here}
                                        </li>
                                        <li>
                                            {!$Label.Go365_Unsecure_See_Our}
                                            <a class="link-tertiary" href="{!$Label.Unsecure_IPS_Link}" target="_blank" rel="noopener noreferrer">{!$Label.go365_Unsecure_IPS}</a>
                                            {!$Label.Go365_Unsecure_Here}
                                        </li>
                                        <li>
                                            {!$Label.Go365_Unsecure_See_Our}
                                            <a class="link-tertiary" href="{!$Label.Unsecure_NPP_Link}" target="_blank" rel="noopener noreferrer">{!$Label.Go365_Unsecure_NPP}</a>
                                            {!$Label.Go365_Unsecure_Here}
                                        </li>
                                        <li>{!$Label.MyHumana_Unsecure_Term_4}</li>
                                        <li>{!$Label.MyHumana_Unsecure_Term_5}</li>
                                        <li>{!$Label.MyHumana_Unsecure_Term_6}</li>
                                    </ul>
                                </div>
                                
                                <div class="row x1">
                                    <div class="eighteen columns">
                                        <button class="link-ForBackButton x1-right" onclick="fnGoBackToPreChat();" style="background: green !IMPORTANT;" type="button">
                                            <span>{!$Label.HUMBack}</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </apex:outputpanel>
            </div>
        </div>
    </div>
    </form>
    </body>
    <apex:includeScript value="{!URLFOR(sWebChatVarMap['DeploymentJS'].value__c)}"/> 
    <apex:includeScript value="{!URLFOR(sWebChatVarMap['PreChatJS'].value__c)}"/>
    <apex:includeScript value="{!URLFOR($Resource.HUMUnsecureLiveAgentCSS,'/library/HUMPreChat.js')}"/>
    
    <!-- Set the visitor's name for the agent in the Console to first and last name provided by the customer -->
    <script type="text/javascript">
        var sSecondary_Chat_Id = '{!JSENCODE(sSecondary_Chat_Id)}';
        var sSelbtnId = document.getElementById('SelButttonID');
        var sUrlNew = '';
        var sUr = document.getElementById("testURI");
        sSelbtnId.value= '{!JSENCODE(chatBtnId)}';
        var sIntId = document.getElementById('interactionid');
        var sIntMemberId = document.getElementById('intMemberId');
        var sInteractionName = document.getElementById('interactionname'); 
        var sTheForm = document.forms["prechatForm"];
        var stheFormToSubmit = document.getElementById("prechatForm");
        var humUnsecureSwitch = {!humanaRoutingSwitch};

        if({!humanaRoutingSwitch} == false){
            selectedID = '{!JSENCODE(chatBtnId)}'; 
        }
        else{
            var btnSkillHashMap = JSON.parse('{!btnSkillMapJson}');
         	var btnHashMap = JSON.parse('{!btnMapJson}'); 
        }

        var sPlanName = document.getElementById("PlanNameSelect");
    	var sPlanNameSpan = document.getElementById("PlanNameSpan");
        var sSkillName = '{!JSENCODE(sSkillName)}';
    	var sSkillNameLabel = document.getElementById('SkillNameLabel');
        var sCurrQueue = '{!JSENCODE(sUserQueue)}';
        var sDecryptBotTranscript = document.getElementById("BotTranscriptDecrypt");
        var sRemotingTargetOnLoadDecrypt = '{!$RemoteAction.UnsecuredPreChat_C_HUM.decryptUserIdentifiers}';
        document.getElementById('secchatid').value = sSecondary_Chat_Id ;        

        jQuery(document).ready(function(){
            jQuery('#termsOfUse').hide();
        });
        
        liveagent.details.preChatInit("{!JSENCODE(sWebChatVarMap['LiveChatURL'].value__c)}", 'detcall');                  
         //liveagent initialization
        liveagent.init("{!JSENCODE(sWebChatVarMap['LiveChatURL'].value__c)}","{!JSENCODE(sWebChatVarMap['DeploymentID'].value__c)}","{!JSENCODE(sWebChatVarMap['CompanyID'].value__c)}", false, true);
    </script>
</apex:page>