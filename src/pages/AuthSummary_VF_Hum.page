<!--
Page Name        : AuthSummary_VF_HUM
Version          : 2.0 
Created Date     : 1/15/2015
Function         : This Page is used to display the Authorizations Summary table.
Modification Log :
* Developer               Code Review                     Date                 Description
* ------------------------------------------------------------------------------------------------------------------------------                
* Sruthi Adivikolanu      29042                           12/15/2015          Original Version
* Ranjeeth Nagishetty     30012                           02/12/2016          REQ - 237351:Authorization Summary Page - 
                                                                                                    Ability to filter and sort authorization/referral results
* Kritika Popat           30647                           03/26/2016          Added new DataTable standards
* Manish Kumar            30710                           03/28/2016          Added Logging capabilities
* Prasanthi Kandula       30770                           04/01/2016          Defect Fix#221215 To handle Enter on FilterBy checkbox
* Prasanthi Kandula       38054                           04/06/2016          Defect #221363.0001 fix, to get the correct Interaction log
* Santhi Mandava          24990                           04/14/2016          Defects 219980.0001 and 221517.0001 fix
* Santhi Mandava          25231                           04/19/2016          Fixed defect 223156.0001. 
* Gargey Sharma           26529                           05/04/2016          Defect #224985.0001, Changed "FILTER BY" to "Filter By"
* Manish Kumar            26846                           05/05/2016          Added caption for datatable.
* Santhi Mandava          27470                           05/14/2016          Fixed defects 225285.0001,225293.0001,225314.0001
* Praveen Kumar Parimi    27942                           05/16/2016          Introduced the side link panel for guided process link.
* Manish Kumar            28163                           05/23/2016          Defect#226708.0001
* Praveen Kumar Parimi    28468                           05/26/2016          Removed fetchInteractionId() action method since Req#196131 is cancelled.
* Santhi Mandava          28937                           06/03/2016          Fixed defect#228405.0001
* Santhi Mandava          30629                           06/20/2016          Implemented summary accordion logging.
* Pallavi Ravishankar     38525                           09/07/2016          Implemented REQ 270173 and REQ 270174 - Logging 
* Santhi Mandava          40488                           09/19/2016          Added attributes AttachmentKey, AttachmentDesc to the logging component
* Sharan Shanmugam                                        06/28/2017          Implemented REQ - 311393 - Authorization Status in Authorizations tab     
* Joel George             109729                          07/12/2017          Implemented REQ - 322639 - UI changes as per requirement.
* Joel George             116450                          08/03/2017          Defect:304936.0001 - Fixed Alignment
* Joel George			  125710 		  				                  09/05/2017	        Req 322640 Removal of Prompt PA Button
* Joel George			  127726		 		  		                  09/12/2017	        Fix for CA ticket 7028711.
* Sharan Shanmugam										                    09/22/2017		      REQ - 329665 Modified to meet coding standards 	
* Sai Ayyagari            184451              			      02/21/2018          REQ - 350853 Fix for HUMExceptionHelper, store the list of exceptions capture
* Suraj Patil              317875             			      12/08/2018          NBA MF-4 Guidance Alert
* Suraj Patil	            		  	                        12/31/2018          396762 REQ - 354312_Fields getting overlapped on left panel Defect test document
* Prudhvi Pamarthi                                        02/18/2019          REQ - 361155 - Not allowing case creation on Legacy Deleted policies
* Suraj Patil			  334242						                    02/04/2019		      Defect - 400092 Alert scroll bar  Doesn't work in Case Edit Page.
* Sumit Pharande			 							                                          REQ-386780 - Removed ; from Collapsible Side panel URL to pass correct Account id
* Melkisan Selvaraj       359862                          06/27/2019          Defect# 425573.0001 Fix - Filter buttons
* Suraj Patil			  								                      08/07/2019		      REQ - 405997 - Regression Defect - 423752
* Prasanthi Kandula                                       01/24/2020          Defect fix 454820.0001 - P9JQuery Date Sorting issue
* Prudhvi Pamarthi                                        2/10/2020           REQ - 410623- CA#8492996 Fix
* Santhi Mandava                                          02/19/2020          US790922 Added pause logging functionality for rapidforce users
* Kapil Arora                                             04/17/2020          US#1021296 MF 1 - AHT - Ability to launch multiple line items from Claim Summary and Auth/Referral Summary Pages (RF)
* Vinay Lingegowda                                        04/29/2020          USER STORY 1038532 - Add Clear Filter button for Medical Authorizations section of Auth/Referral Summary page (RF)
* Sunil Kumar Reddy Y                                     04/30/2020          User Story 1062501: PR00091574 - MF 1 - Quality - Display informational message at the top of Claim and Auth/Referral Summary pages to provide guidance about CTRL+Click feature (RF)
* Amar Gadewar                                            06/02/2020          User Story 1145819 : PR00091574 - MF 1 - Quality - Display informational message at the top of Claim and Auth/Referral Summary pages to provide guidance about CTRL+Click feature (CRM)
* Amar Gadewar                                            06/03/2020          User Story 1145807: PR00091574 - MF 1 - AHT - Ability to launch multiple line items from Claim Summary and Auth/Referral Summary Pages (CRM)
* Suresh Kokkeragadda                                     06/24/2020          User Story 1203671: PR00091574 - MF 1 - SF - TECH - On/Off Switch Cleanup 07/07 and 07/17 releases (CRM)
* Yogesh Gupta                                            10/16/2020		  REQ - 1263946 PR00090631 - MF 10 - MVP  Alert Rules configuration - General
* Riya Agarwal                                            01/13/2021          REQ - 1835131 - PR00095212- MF1 -SF -Auto-Populate Custom Benefit Grid
* Rahul Chaurasia										  04/30/2021		  BUG 2251562 - 1279935 - UAT - Auth/Referral Summary page: Section drop down links are moving when scrolling on the page. They should remain present.
* Anuradha Gajbhe										  06/18/2021		  User Story 2315210 - MF 6 - SF - Tech - Performance Tuning - Authorization Summary and Detail Pages.
* Swapnali Sonawane										  09/02/2021          User Story 1796290 T1PRJ0002472 / 94010 - MVP MF 6 - Authorization/Referral Summary - Strides
* Nirmal Garg								   			  09/16/2021	      Added browser logic for coveo
* Anuradha Gajbhe                                         12/06/2021          US-2847494 JQuery/Bootstrap/Angular update - Authorization pages and clinical program pages
* Vivek													  07/09/2022		  Updated the JS query to new Datatables to version to 1.12.1
* Kiran Kumar B 										  09/13/2022		  User Story 3733229: INC1896143 - CRM Classic authorization summary page
* Tharun Madishetti                   07/14/2023      US-4647138: T1PRJ0891742 - VIT19761200 - Data Table Upgrade - Authorizations, Benefits, & Claims (Group 1)
*---------------------------------------------------------------------------------------------------------------------------- -->

<apex:page controller="AuthSummary_C_HUM" sidebar="false" id="page" tabStyle="Policy_Member__c" showheader="true">
  <apex:includeScript value="/support/console/36.0/integration.js"/>
  <apex:includeScript value="{!URLFOR($Resource.CRM_PLATFORM_TOOLKIT, '/Bootstrap/dist/js/bootstrap.min.js')}" />
  <apex:includeScript value="{!URLFOR($Resource.CRM_JQUERY, 'jquery.min.js')}"/>

  <apex:includeScript value="{!URLFOR($Resource.CRM_DataTables_1_13_4, 'datatables.min.js')}" />
  <apex:includeScript value="{!URLFOR($Resource.html2canvas, '/html2canvas.min.js')}"/>
  <apex:includeScript value="{!URLFOR($Resource.CRM_DataTables_1_13_4, '/DataTables-1.13.4/js/jquery.dataTables.min.js')}"/>
  <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.CRM_DataTables_1_13_4, 'datatables.min.css')}"/>    
  <apex:stylesheet value="{!URLFOR($Resource.ClinicalAuthSummary_JS_HUM,'/ClinicalAuthsummaryCSS.css')}"/>

  <apex:includescript value="{!URLFOR($Resource.CRM_DataTables_1_13_4,'/DataTables-1.13.4/js/jquery.dataTables.js')}"/>
  <apex:includescript value="{!URLFOR($Resource.ClinicalAuthSummary_JS_HUM,'/ClinicalAuthSummaryJS.js')}"/>
  <apex:stylesheet value="{!URLFOR($Resource.CRM_PLATFORM_TOOLKIT,'/Logging/css/LoggingCompCSS.css')}"/>
  <apex:includeScript value="{!URLFOR($Resource.Collapsible_RightConsole_SR_HUM, '/js/CollapsibleAuthSummaryConsole.js')}" />
  <apex:stylesheet value="{!URLFOR($Resource.Collapsible_RightConsole_SR_HUM, '/styles/CollapsibleRightConsoleAuthSummary.css')}" />
  <apex:includeScript value="{!URLFOR($Resource.CRM_DataTables_1_13_4, '/Moment-2.29.4/moment.min.js')}" />
  <apex:includeScript value="{!URLFOR($Resource.CRM_DataTables_1_13_4, '/Sorting/datetime-moment.js')}" />  


  <script>
    var enterpriseID = "{!sAttachKey}";
    var accountID = "{!sAccId}";

    //script need to be present on page
    function SetTabTitle() {
    sforce.console.setTabTitle('Auth/Referral Summary: ' +'{!$CurrentPage.parameters.Name}');
    }
    function gotoSectionNew(target){
    if(!isAlertsPanelCollapsed ){
    jQuery("#main-container").animate({ scrollTop: jQuery('#main-container').scrollTop() + jQuery('#' + target).offset().top-115 }, 'slow');
    }
    else{
    jQuery('html, body').animate({scrollTop: jQuery('#' + target).offset().top-115}, 'slow');
    }
    }
    //Issue 1 Open Account-Case Page with Member to Member interaction in one tab and Open Account-Case Page with Agent/provider/group to Member interaction in other tab then RIght side panel goes away on 1st tab. Because Event name was not unique per tab
    //issue 2 When Interacting with is Agent/provider/group and Interacting About Member/unknown member then blank Right panels added on page. Because event was missing on page.
    //Adding CollapseRightAlertPanelCase event listener to hide right side panel and appending primary tab id to make event unique
    var getPrimaryTabId = function getPrimaryTabId() {
    sforce.console.getEnclosingPrimaryTabId(getTabPrimaryId);
    }
    var getTabPrimaryId = function getTabPrimaryId(result) {
    CollapseRightAlertPanelCase = 'CollapseRightAlertPanelCase' +result.id;
    sforce.console.addEventListener(CollapseRightAlertPanelCase, function(result){
    document.getElementById('sideBar-container').style.display='none';
    document.getElementById('loggingStickyHeader').style.width='85%';
    document.getElementById('floatinglinkdiv').style.width='85%';
    });
    }
    getPrimaryTabId();

    jQuery(document).ready(function () {
    jQuery.fn.DataTable.datetime('MM/DD/YYYY');
    jQuery.fn.DataTable.datetime('MM/DD/YYYY hh:mm:ss A');
    jQuery.fn.DataTable.datetime('MM/DD/YYYY hh:mm A');
    });

  </script>

  <style>
    .bPageBlock .detailList tr td, .bPageBlock .detailList tr th, .hoverDetail .bPageBlock .detailList tr td, .hoverDetail .bPageBlock .detailList tr th
    {
    border-bottom:none !IMPORTANT;
    }
    body .bPageTitle .ptBody .pageType{
    margin-top:0px;
    font-size :0.8em;
    }
    .pageDescription {
    margin-top:-10px;

    }
    h3{
    font-size:15px;
    font-weight: bold;
    font-family: arial;
    }
  </style>

  <div style="width: 200px; float:left; font-size:12px; top:0px; position:fixed;z-index: 1000" class="MimicLink">
    <c:DynamicCustomLinks_CMP_HUM DynamicLinkController="{!this}" />
  </div>
  <div style="float:left; font-size:12px;">
    <div id="main-container" style="float:left height:705px;Width:84%;margin-left:200px;">
      <div id="goToSectionDivID">
          <div id= "floatinglinkdiv" style= "position:fixed; z-index:1000; width: 100%;" >
            <apex:pageBlock id="comppb" >
              <div style="text-align:Center; margin-bottom: 1%; margin-top: 1%; margin-right: 1%;">
                <a class="linklet link linkMimic" id="Medical Authorization Information" onclick="gotoSectionNew('gotoMedicalAuthinfo');"   data-uidsfdc="21" >
                  <span class="listTitle link_cursor" >
                    {!$Label.Medical_Authorization}
                  </span>
                </a>

                &nbsp;
                &nbsp;
                <a class="linklet link linkMimic" id="Pharmacy Authorization Information"  onclick="gotoSectionNew('gotoPharmacyAuthinfo');" data-uidsfdc="21" >
                  <span class="listTitle link_cursor" >
                    {!$Label.Pharmacy_Authorization}
                  </span>
                </a>
              </div>
            </apex:pageBlock>
          </div>

      </div>

      <div id="loggingStickyHeader" class="LoggingCompCSS LoggingCompCSSAuthNew" style="width:82.5%;margin-right:1%;">
        <c:Logging_CMP_HUM enablePause="true" DisplayMessage="true" Logging_Color="red" AttachmentKey="{!sAttachKey}" AttachmentDesc="PersonID" Logged_Item_Color="blue" Screenshot_Area_Id="pageContent" RecordId="{!sRecId}" disableButton="{!bdisableButton}"/>
      </div>
      <br/>
      <br/>
      <br/>
      <div id="pageContent" style="margin-top:8%; background:white; ">
        <table class="pageHeader enable_logging" style="white-space: nowrap;margin-bottom: -10px;" >
          <tr>
            <td>
			<apex:outputPanel id="authcoveo" rendered="{!bCoveoUser}">
			  <c:UnifiedSearch_CMP_HUM id="uniId" policyMemberId="{!sRecId}" pageNameToPass="Authorization/Referral Summary"/>
			 </apex:outputPanel>
              <apex:sectionHeader id="idsummaryheader" title="Authorization/Referral Summary" subtitle="{!sMemName}" />
            </td>
          </tr>
        </table>
        <apex:form id="form" style="font-size:12px">
          <!-- For Constructor Related exception -->
          <c:HUMConstructorExceptionComponent errorLogs="{!listErrorLogs}" />
          <!-- <apex:actionFunction name="initiate" action="{!authDetailsRequest}" rerender="message" oncomplete="OpenSubtabonsearch('{!$Component.page.form.myHiddenField}','{!sRecId}','{!bAuthIdExists}');" > -->
          <apex:actionFunction name="initiate" action="{!authDetailscheckRequest}" rerender="message" oncomplete="OpenSubtabonsearch('{!$Component.page.form.myHiddenField}','{!sRecId}','{!bAuthIdExistsdet}');" >		 
            <apex:param value="" name="authIdAF"/>
          </apex:actionFunction>
          <input type="hidden" value="" id="myHiddenField"/>

          <apex:actionFunction name="initiateAgain" action="{!initiateRequest}" rerender="ErrorMsgOP,dataTablSection" oncomplete="drawTable({!bShowResults},{!bIsError});"/>
            <apex:actionFunction action="{!MentorGridService}" name="LaunchCASMentor" oncomplete="openBenefitGridWindow('{!bKMD}');"/>    

        </apex:form>

        <a id="gotoMedicalAuthinfo" name="Medical Authorization Information"></a>
        <div class="container-fluid" id="screenshot_area" style="background:white;">

          <div class="row">
            <br/>
            <apex:pageBlock mode="maindetail" id="medBlock">
              <apex:pageBlockSection columns="1" id="thePageBlockSectionPharmacyAuth" title="Medical Authorizations/Referrals">
                <apex:outputPanel id="ErrorMsgOP">
                  <apex:pageMessages rendered="{!(bShowServiceError || bShowError)}" ></apex:pageMessages>
                  <apex:pageMessages rendered="{!bShowMessage}"></apex:pageMessages>
                  <apex:pageMessages rendered="{!(!bIsError)}" />
                </apex:outputPanel>
                <div class="col-xs-12" style="font-size:12px" id="divGoToSection">
                  <nav class="navbar navbar-default">
                    <div class="navbar-header">
                      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2" aria-expanded="true">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>

                    </div>
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
                      <form style="margin-left: -29px;" class="navbar-form navbar-left" role="search1" id="ddFilters1">
                        <div class="form-group">
                          <span style="font-size: 12px;margin-top: -8px;" class="navbar-brand panel-title filterByStyling">Go To</span>
                          <input type="text" class="form-control example1_disable_while_logging" placeholder="Authorization/Referral Number" id="keyword1" aria-expanded="true" style="width: 250px;"  onkeypress="return noProviderEnter(event) ;" />
                        </div>
                        <div class="btn-group">
                          <button type="button" style="margin-top: -8px;" class="btn btn-default example1_disable_while_logging" aria-haspopup="true" aria-expanded="false" onclick="Clincalsearch()" id= "goId" >Go</button>
                        </div>
                        <div class="form-group">
                          <apex:outputPanel id="message" >
                            <!-- <apex:pageMessages rendered="{!bAuthIdExists}"></apex:pageMessages> -->
                            <apex:pageMessages rendered="{!bAuthIdExistsdet}"></apex:pageMessages>
                          </apex:outputPanel>
                        </div>

                      </form>
                    </div>
                  </nav>
                </div>

                <div class="col-dataxs-12" id="divFilterBySection">
                  <nav class="navbar navbar-default">
                    <div class="navbar-header">
                      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>
                      <span style="font-size: 12px;" class="navbar-brand panel-title filterByStyling">Filter By</span>
                    </div>

                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                      <form class="navbar-form navbar-left" role="search" id="ddFilters" style="font-size:12px;">
                        <div class="form-group">
                          <input type="text" class="form-control example1_disable_while_logging" placeholder="Keyword" id="keyword" onkeydown="if (event.keyCode==13){ return false;}" />

                        </div>
                      </form>
                    </div>
                  </nav>
                </div>

                <div class="col-xs-12" id="divAuthTableSection" >

                  <div class="table-responsive" >
                    <apex:outputPanel layout="block" id="dataTablSection"  style="margin-right : 35px;">
                      <table id="example1" class="table table-striped table-bordered table-hover responsive nowrap enable_logging" cellspacing="0">
                        <caption style="display:none">Auth Summary</caption>
                        <thead>
                          <tr>
                            <th log_this="false"></th>
                            <th title="Authorization/Referral Number" id="authnum">Auth/Referral #</th>
                            <th title="Authorization Type" id="authType">Auth Type</th>
                            <th title="Overall Status" id="status">Overall Status</th>
                            <th title="Admission Date/First Day" id="admsndate">Admission/First Day</th>
                            <th title="Discharge Date/Last Day" id="lastday">Discharge/Last Day</th>
                            <th title="Admission/Service Type" id="type">Admission/Service Type</th>
                            <th title="Treating Provider" id="treating">Treating Provider</th>
                            <th title="Facility" id="facility">Facility</th>
                            <th title="Requesting Provider" id="requesting">Requesting Provider</th>
                          </tr>
                        </thead>
                        <tbody>
                          <apex:repeat value="{!lstAuth}" var="lst">
                            <tr>
                              <td width="10px" log_this="false"></td>
                              <td headers="authnum" log_this="false">
                                <a id="authid" style="text-decoration: underline;" log_ignore_click="true" value="{!lst.sAuthorizationOrReferralNumber}" href="javascript:OpenSubtabClick('{!lst.sAuthorizationOrReferralNumber}','{!sRecId}','{!lst.sAuthorizationType}');">{!lst.sAuthorizationOrReferralNumber}</a>
                              </td>
                              <td headers="authType">{!lst.sAuthorizationType}</td>
                              <td headers="status">{!lst.sOverallStatus}</td>
                              <td headers="admsndate">{!lst.sAdmFirstDay}</td>
                              <td headers="lastday">{!lst.sDischargeLastDay}</td>
                              <td headers="type">{!lst.sServiceType}</td>
                              <td headers="treating">{!lst.sTreatingProvider}</td>
                              <td headers="facility">{!lst.sFacility}</td>
                              <td headers="requesting">{!lst.sRequestingrovider}</td>
                            </tr>
                          </apex:repeat>
                        </tbody>
                      </table>
                    </apex:outputPanel>
                  </div>
                </div>
              </apex:pageBlockSection>

            </apex:pageBlock>
            <!-- Pharmacy Authorizations begins -->
            <br/>
            <apex:pageBlock mode="maindetail" id="finPageBlock">
              <a id="gotoPharmacyAuthinfo" name="Pharmacy Authorization Information"></a>
              <apex:pageBlockSection collapsible="true" columns="1" title="Pharmacy Authorizations" id="thePageBlockSectionPharmacyAuthorizations">
                <c:PharmacyBenefits_CMP_HUM id="pharmacybenefitsandAuth"/>
              </apex:pageBlockSection>
            </apex:pageBlock>
            <!-- Pharmacy Authorizations ends -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="opaque"/>
  <div id="spinner">
    <p align="center" style='{font-family:"Arial", Helvetica, sans-serif; color:white; font-size:20px;}'>
      <apex:image value="/img/loading.gif"/>&nbsp;Loading...
    </p>
  </div>
  <div class="alertTooltip" id="alertDetailsTooltip" style = "border-style: solid;font-family: Arial;display:none;" />
  <div id="sideBar-container" style="height:100%; position:fixed;float:right;z-index:1000">
    <apex:outputpanel rendered="{!$Permission.NBA_Alerts_V2 }" >
      <div id="RTISummaryPage" style="float:right;width:300px;height:100%">
        <apex:iframe src="/apex/CollapsibleRightConsole_VF_HUM?id={!sAccId}&ServiceFlag=false&CollapsedSidePanel=true&RTIFlag=false&sOtherPageName=Authorization/Referral Summary&polId={!sRecId}" height="600px" scrolling="true" id="alertsIframe"/>

      </div>
    </apex:outputpanel>
  </div>
  
   <script>
    var IsAutoLaunch = '{!IsAutoLaunchMentor}'; 
    var polMemId = '{!objPolMem}';  
    var IsCasPolicy = '{!bIsCasPolicy}';
    if(IsCasPolicy == 'true') LaunchCASMentor();
   </script>
   
</apex:page>