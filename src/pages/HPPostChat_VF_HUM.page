<!--
Page Name        : HPPostChat_VF_HUM
Version          : 1.0 
Created Date     : April 09 2019
Function         : Custom window for Post Chat form on Live agent
Modification Log :
*   Modification ID     Developer                     Code Review         Date                 Description
* ------------------------------------------------------------------------------------------------------------------------------                
*   1.0             Joel George                                     04/09/2019              Original Version
*   1.1             Melkisan Selvaraj                  357216       5/24/2019               Added Tealium script
*   1.2             Lakshmi Madduri                                 6/12/2019               Modifications for Tealium Script
*   1.3             T Prasanna Sai Kumar                            03/23/2021              REQ - 1910466 Live Agent Security Vulnerabilities for SonarQube Scan - HP Live Agent
*   1.4             Vishnu Pilli                                    11/02/2020              Updated th elogic to make Close Window visible and added PostMessage
*   1.5             Alvaro Madrid                                   05/10/2022              REQ - 3298630 CenterWell rebranding for Live Chat on HP.com
-->
<apex:page showheader="false" controller="HPPreChatController_C_HUM" standardStyleSheets="false" action="{!initVariable}">
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/base.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/framework.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/global.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/global1.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/humanacom.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/humanacom1.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/lib.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/styles.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/styles.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMLiveAgentCSS,'/library/tools.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.HPHUMPostWebChatPageCSS,'HUMPostWebChatPage/library/Postchatstyleclass.css')}" />

    <apex:includeScript value="{!URLFOR($Resource.CRM_JQUERY, 'jquery.min.js')}" />
    <script type="text/javascript">
    var src = "{!JSENCODE(sWebChatVarMap['CodeMetricsJS'].value__c)}";
        if (window.location.host.substring(0, 2) == "qa")
        {
            src = "{!JSENCODE(sWebChatVarMap['CodeMetricsQaJS'].value__c)}";
        }
        else if (window.location.host.indexOf("test") >=0)
        {
            src = "{!JSENCODE(sWebChatVarMap['CodeMetricsTestJS'].value__c)}";
        }
        document.write('<script src="' + src + '" type="text/javascript"><' + '/script>');
          var sChatDetails2 = '{!JSENCODE($CurrentPage.parameters.chatDetails)}';
          var sIntName='';
          var sNameMethod = '{!$RemoteAction.HPPreChatController_C_HUM.findInteractionName}';
          var pageParams = '{!JSENCODE(pageParams)}';
   
         function saveChatConfirmation()
          {
            var webChatDownloadConfirmResponse = confirm('{!$Label.Web_Chat_Download_Confirmation_Message}');      
            if (webChatDownloadConfirmResponse)
            {               
                callGoToHUMSaveChatTranscriptPageMethod();
            }
            return false;
          }
        </script>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Post Chat</title>
        <apex:includeScript value="{!URLFOR($Resource.HPHUMPostWebChatPageCSS,'HUMPostWebChatPage/library/HUMPostWebChatPage.js')}"/>
    </head>
    <body>
        <!--Do not remove. Tealium code snippet for Humana analytics/metrics-->
        <script type="text/javascript">
        var utag_data = {};
        if (typeof HumAnalytics == "undefined"){
            var HumAnalytics = window.HumAnalytics = {};}
    HumAnalytics.appid = [];
    HumAnalytics.autorenewflag = [];
    HumAnalytics.copayexcflag = [];
    HumAnalytics.prodcat = [];
    HumAnalytics.prodid = [];      
    HumAnalytics.prodname = [];
    HumAnalytics.prodpkgqty = [];      
    HumAnalytics.prodqty = [];
    HumAnalytics.prodsav = [];   
    HumAnalytics.prodtranstype = [];          
    HumAnalytics.prodtype = []; 
    HumAnalytics.produp = [];
        </script>
        <script type="text/javascript">
        <!-- Loading script asynchronously -->
            (function(a,b,c,d){
                a='{!JSENCODE(sWebChatVarMap['HP_Tealium'].value__c)}';
                b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
                a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
            })();
            /*
                GBO Watson: Adding post message to help GBO Watson team to close the window
            */
            function postMessageAndClose() {
                window.parent.postMessage('Close Window', '*');
                setTimeout(function(){ window.close(); }, 1000);
            }   //  end of postMessageAndClose
        </script>
        <apex:form id="theForm">
            <div id="test" class="row">
                <div class="small-glass-container">
                    <div class=" columns x1 eighteen">
                    <div class="row">
                        <apex:image styleClass="hpHeaderImage" url="{!URLFOR($Resource.HPHUMLiveAgentCSS,'library/images/header1.png')}"/>
                        <span class="hpHeader">CenterWell Pharmacy Chat</span>
                    </div>
                        <div class="row">
                            <div class="small-glass-container">
                                <div class="row">
                                    <div class="hpContainer">
                                        <apex:outputPanel rendered="{!IF($CurrentPage.parameters.transcript!='',true,false)}">
                                            <h1 class="hpHeading1">Thank you&#33;</h1>
                                            <span class="hpMainText">Thank you for your time, we hope your experience with CenterWell Pharmacy Chat was helpful.</span>
                                        </apex:outputPanel>
                                        <apex:outputPanel rendered="{!IF($CurrentPage.parameters.transcript=='',true,false)}">
                                            <h1 class="hpHeading1">Chat is not available</h1>
                                            <span class="hpMainText">{!$Label.HUMNoAgentAvailable} {!$Label.HUMAssistance1} <a target="_blank" href="{!HTMLENCODE(sWebChatVarMap['HPContactUsLink'].value__c)}"><span class="hpLink">{!$Label.HUMContactCenter}</span></a> {!$Label.HUMAssistance2}
                                            </span>
                                        </apex:outputPanel>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="hpContainer">
                                        <apex:outputPanel rendered="{!IF($CurrentPage.parameters.transcript!='',true,false)}">
                                            <apex:outputLink styleClass="hpLink" onclick="return saveChatConfirmation();">
                                                <apex:image url="{!URLFOR($Resource.HPHUMLiveAgentCSS,'library/images/download.svg')}"/>
                                                <span>Save Chat</span>
                                            </apex:outputLink>
                                        </apex:outputPanel>                                                                                                                          
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="hpContainer">
                                        <apex:outputPanel rendered="{!IF($CurrentPage.parameters.transcript!='',true,false)}">
                                            <span class="hpMainText">Please take a moment to complete a brief survey about your chat experience. <br></br><br></br></span>
                                        </apex:outputPanel>
                                        <div id="opPan">
                                            <apex:outputPanel rendered="{!IF($CurrentPage.parameters.transcript!='',true,false)}">                                                 
                                                <button class="hpBlueButton" onclick="openSurvey('{!JSENCODE(sWebChatVarMap['HPSurveyLink'].value__c)}');return false;" type="submit">
                                                    <span>OK</span>
                                                </button>
                                                <a href="javascript:postMessageAndClose();" class="hpCancelButton"><span>No thanks</span></a>
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!IF($CurrentPage.parameters.transcript=='',true,false)}">
                                                <button class="hpBlueButton" onclick="javascript:window.close();" type="submit" style="width:190px">
                                                    <span>Close window</span>
                                                </button>
                                            </apex:outputPanel>                                              
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
          <apex:actionFunction name="callGoToHUMSaveChatTranscriptPageMethod" action="{!goToHUMSaveChatTranscriptPage}"/>
        </apex:form>
    </body>
</apex:page>