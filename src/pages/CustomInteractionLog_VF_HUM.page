<!--
Page Name        : CustomInteractionLog_VF_HUM
Version          : 1.0 
Created Date     : 05/21/2014 
Function         : This Page holds Interaction Log opened in Bottom Side bar section of Member detail pages.
Modification Log :

*   Modification ID     Developer               Code Review             Date                 Description
* -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------               
*   1.0                 Ninad Patil             16484                   05/21/2014            Original       
*   1.1                 Ninad Patil             16484                   06/17/2014            Modified for Multiple Interaction Members
*   1.2                 Ninad Patil             16484                   06/27/2014            Moved Significant portion of java script to Another file. 
*   1.3                 Pradeep Raju            16484                   06/30/2014            Commenting out the code related to alerts
*   1.4                 Pradeep Raju            16484                   07/03/2014            Uncommented the code for alerts
*   1.5                 Pradeep Raju            16484                   07/10/2014            Commented out the code for alerts
*   1.6                 Pradeep Raju            16484                   07/11/2014            Uncommented the code for alerts
*   1.7                 Shreya Choodamani       16484                   07/23/2014            Commented the code for alerts
*   1.8                 Shreya Choodamani       16484                   07/24/2014            Uncommented the code for alerts
*   1.9                 Ninad Patil             17100                   08/09/2014            Resubmitting After coding standards correction.   
*   2.0                 Pradeep Raju            17100                   08/10/2014            Commented out the code for alerts
*   2.1                 Pradeep Raju            17100                   08/11/2014            Uncommented the code for alerts
*   2.2                 Ninad Patil             18313                   10/07/2014            fixed code review comment : sAccId removed.
*   2.3                 Shreya Choodamani       20233                   01/06/2015            Added action function and action status for the Save button added as per REQ - 66088
*   2.4                 Pradeep Raju            24021                   06/17/2015            Updated the code at lines# 152 & 156 to make use of custom labels
*   2.5                 Sagar Tapadia           25983                   08/21/2015            Added Loading Action Status for Buttons and also changed re rendering of panels based on button click.
*   2.6                 Sharan Shanmugam        29837                   02/10/2016            Re raising it for review as part of Story REQ - 220870
*   2.7                 Harshith Mandya         26131                   04/13/2016            Defect Fix #210892.0001
*   2.8                 Harshith Mandya         26131                   04/13/2016            Defect Fix #221203.0001
*   2.9                 Pradeepkumar Dani       46100                   10/19/2016            UI changes as part of REQ - 287463
*   3.0                 Pradeepkumar Dani       61786                   02/07/2017            GetOffers implementation using JS remoting
*   3.1                 Pradeepkumar Dani       70271                   03/02/2017            Log panel button reRendering optimization.
*   3.2                 Praveen Kumar Parimi    72345                   03/21/2017            Fixed the CA Ticket - 6366647 AKA REQ - 301433.
*   3.3                 Chaitanya Vegendla      82921                   04/09/2017            Added code for calling End Session
*   3.5                 Dinesh Subramaniyan                             08/14/2017            REQ - 326206 - Ability of a CRM Salesfroce application to identify closing the Member Account without creating a case on interaction(RF)
*   3.6                 Pradeepkumar Dani      127142                   03/02/2017            Log panel alerts reRendering optimization.
*   3.7                 Anupama Tavva           126085                  09/07/2017            Fix for Defect 314849.0001 under REQ - 325467
*   3.8                 Dinesh Subramaniyan                             11/20/2017            REQ - 338378: Ability in quick Start to capture the call back number after the interaction Is created (RF)
*   3.8                 Subhamay Mandal                                 04/13/2018            REQ - 360212 AHT - QS Member Demographic Verification andor Guidance Alerts are due (CRM)
*   4.0                 Sumit Pharande                                  11/30/2018            NBA- MF3/4
*   4.1                 Vinay Lingegowda                                07/26/2019            REQ - 405900 AHT - All Users - Ability to edit interaction details from any CRM page (RF)
*   4.2                 Vinay Lingegowda                                05/07/2020            US - 1083341 AHT - All Users - Ability to edit interaction details from any CRM page (CRM)
*   4.3                 Sunil Kumar Reddy Y                             05/22/2020            User Story 1114855: PR00091574 - MF 1 - SF - TECH - On/Off Switch Cleanup 6/5 and 6/19 releases (CRM)
*   4.4                 Satyam Malviya                                  02/01/2021            user story 1826725 -  PR00090631 - MF 2 - SF - TECH - NBA Clean up - part 1
*   4.5                 Mithra Bharadwaj											          SonarQube Changes
*   4.6				          Sahil Verma/Navajit Sarkar			                07/12/2021					  US#2287945 : Adding Authentication Data in the Interaction Record
*   4.4                 Sahil Verma                                     10/14/2021            Show popup on Case/Plan/Detail page on click of Save button on Interaction Log Panel as part of US - 2564484
*   4.5                 Navajit Sarkar/Sahil Verma                      02/17/2022             US#2191493 - SFDC_Caller Type population           
*   4.6                 Harshada Kamble/Anil Pavithran                  03/09/2023             US 2760646: T1PRJ0036776: SFDC Ability to Manually Modify Authentication Status (Multi Members)
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
<apex:page controller="CustomInteractionLog_C_HUM" id="intPage">
  <head>
    <link rel="stylesheet" href="{!URLFOR($Resource.Alerts_SR_HUM, '/CustomInteractionLog/CustomInteractionLogDetailPage.css')}" />
    <link rel="stylesheet" href="{!URLFOR($Resource.Alerts_SR_HUM, '/CustomInteractionLog/CustomInteractionLog.css')}" />
    <link rel="stylesheet" href="{!URLFOR($Resource.Alerts_SR_HUM, 'GuidanceAlerts.css')}" />

    <script src="/support/console/35.0/integration.js"></script>
    <script src="{!URLFOR($Resource.Alerts_SR_HUM, '/CustomInteractionLog/CustomInteractionLog.js')}"></script>
    <script src="{!URLFOR($Resource.Alerts_SR_HUM, 'GuidanceAlerts.js')}"></script> 
    <script>
      var intObj = new Object();
      intObj.vParams = '{ buffer: false, escape: true, timeout: 120000 }';
      intObj.vRecursion = false;
    </script>
  </head>
  <!-- Start of Form -->
  <apex:form id="intForm">
    <apex:pageBlock id="pbIntLogPage" mode="edit" title="{!$Label.HUMIntLogTitle}">
      <apex:pageMessages id="pgIntMsg" />
      <!-- US2760646: T1PRJ0036776: SFDC Ability to Manually Modify Authentication Status (Multi Members) -->
      <apex:outputpanel id="opPgMsg" rendered="{!multiMemberAuthSwitch}">
        <apex:pageMessages id="pbsMsg" rendered="{!bRenderErrorMsg}"/>
      </apex:outputpanel>
      <apex:actionFunction action="{!validateAssociateCaseButton}" name="validateAssociateCaseButton" reRender="pbIntLogPageButtons" status="pleaseWaitInt">
        <apex:param assignTo="{!recordId}" name="resultId" value="" />
      </apex:actionFunction>
      <apex:actionFunction reRender="pbIntLogPageButtons" name="disableAssignCase" action="{!disableAssociateCaseButton}" status="pleaseWaitInt"/>
      <apex:pageBlockButtons location="top">
        <apex:outputPanel id="pbIntLogPageButtons">
          <apex:commandButton onclick="saveInteraction();" reRender="pbsInteractionLog" value="{!$Label.HUMSaveBtn}" />
          <apex:commandButton onclick="save();" reRender="pgIntMsg" value="{!$Label.HUMAssociateInteraction}" rendered="{!bAssignCase}" oncomplete="removeInteractionStarFromTab();"/>
          <apex:commandButton onclick="SaveAndNew();return false;" reRender="pbsInteractionLog" value="{!$Label.HUMSaveNewBtn}" />
        </apex:outputPanel>
        <!--US#2287945 : Adding Authentication Data in the Interaction Record-->
        <apex:outputPanel id="idAuthCheckPanel" rendered="{!mf3Switch}">
          <!-- US2760646: T1PRJ0036776: SFDC Ability to Manually Modify Authentication Status (Multi Members) -->
          <apex:outputPanel id="idAuthCheckPanel1" rendered="{!!multiMemberAuthSwitch}">
              <apex:inputCheckbox id="idAuthSuccess" value="{!oFetchInteraction.Authenticated__c}" disabled="true" rendered="{!AND(oFetchInteraction.Interaction_Origin__c=='Inbound Call',isGenesysUser==true,authCheck==True)}"></apex:inputCheckbox>
              <apex:inputCheckbox id="idAuthSuccess2" value="{!oFetchInteraction.Authenticated__c}" onchange="AuthenticationCheck()" disabled="false" rendered="{!AND(oFetchInteraction.Interaction_Origin__c=='Inbound Call',isGenesysUser==true,authCheck==false)}"></apex:inputCheckbox>
              <apex:outputText id="idAuthSuccessLabel" style="{!if(oFetchInteraction.Authenticated__c == true,'color:Green;font-size:12px;line-height: normal !important; font-weight: bold; padding-left: 2px;padding-top: 2px;', 'color:red;font-size:12px;line-height: normal !important; font-weight: bold; padding-left: 2px;padding-top: 2px;')}" value="{!authCheckLabel}" rendered="{!AND(oFetchInteraction.Interaction_Origin__c=='Inbound Call',isGenesysUser==True)}"></apex:outputText>
          </apex:outputPanel>
          <!-- US2760646: T1PRJ0036776: SFDC Ability to Manually Modify Authentication Status (Multi Members) -->
          <apex:outputPanel id="idAuthCheckPanel2" rendered="{!multiMemberAuthSwitch}">
                <apex:inputCheckbox id="idAuthSuccess1" value="{!oHUMIntMemers.Authenticated__c}" disabled="true" rendered="{!AND(oFetchInteraction.Interaction_Origin__c=='Inbound Call',isGenesysUser==true,authCheck==true)}"></apex:inputCheckbox>
                <apex:inputCheckbox id="idAuthSuccess3" value="{!oHUMIntMemers.Authenticated__c}" onchange="AuthenticationCheck()" disabled="false" rendered="{!AND(oFetchInteraction.Interaction_Origin__c=='Inbound Call',isGenesysUser==true,authCheck==false)}"></apex:inputCheckbox>
                <apex:outputText id="idAuthSuccessLabel1" style="{!if(oHUMIntMemers.Authenticated__c == true,'color:Green;font-size:12px;line-height: normal !important; font-weight: bold; padding-left: 2px;padding-top: 2px;', 'color:red;font-size:12px;line-height: normal !important; font-weight: bold; padding-left: 2px;padding-top: 2px;')}" value="{!authCheckLabel}" rendered="{!AND(oFetchInteraction.Interaction_Origin__c=='Inbound Call',isGenesysUser==True)}"></apex:outputText>
          </apex:outputPanel>
        </apex:outputPanel>
      </apex:pageBlockButtons>

      <apex:actionRegion >
        <apex:pageBlockSection columns="3" id="pbsInteractionLog">
          <apex:panelgrid columns="1" styleClass="panelGridStyle">

            <apex:pageblockSectionItem >
              <apex:outputpanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle_2">
                      <apex:outputText styleClass="fieldStyle" value="{!$Label.HUMIntNameFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:inputtext value="{!oFetchInteraction.Caller_Name__c}" MaxLength="150" id="intCallerName" />
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputpanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle_2">
                      <apex:outputText value="{!$Label.HUMIntWithFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:inputField value="{!oFetchInteraction.Interacting_With__c}" rendered="{!bAccessInteractingWith}" id="intInterwith"/>
                      <apex:inputText value="{!oFetchInteraction.Interacting_With__r.Name}" rendered="{!!bAccessInteractingWith}" id="intInterwithTxt"/>
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputpanel >
                <table class="tabStyle IWT-Margin">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle_2">
                      <apex:outputText value="{!$Label.HUMIntWithTypeFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:inputField value="{!oFetchInteraction.Interacting_With_type__c}" id="intInterwithtyp"/>
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
          </apex:panelgrid>
          <apex:panelgrid columns="1" styleClass="panelGridStyle_1">
            <apex:pageblockSectionItem id="pbsSectInqAbt" >
              <apex:outputpanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle_1">
                      <apex:outputText value="{!$Label.HUMIntAboutFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:selectList id="selectINqAbout" multiselect="false" onchange="JSonchangeInqAbt(this.options[this.selectedIndex].value,this.options[this.selectedIndex].Text);" size="1" value="{!oHUMIntMemers.Interacting_About__c}">
                        <apex:selectOptions value="{!lstSelectOptionIntAbt}" />
                      </apex:selectList>
                    </td>
                  </tr>
                </table>
                </apex:outputPanel>
              </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputPanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle_1">
                      <apex:outputText value="{!$Label.HUMIntAboutTypeFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:outputField value="{!oHUMIntMemers.Interacting_About_Type__c}" />
                    </td>
                  </tr>
                </table>
              </apex:outputPanel>
            </apex:pageblockSectionItem>
          </apex:panelgrid>
          <apex:panelgrid columns="1" styleClass="panelGridStyle_2">
            <apex:pageblockSectionItem >
              <apex:outputPanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText styleClass="fieldStyle" value="{!$Label.HUMIntOriginFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:inputField value="{!oFetchInteraction.Interaction_Origin__c}" />
                    </td>
                  </tr>
                </table>
              </apex:outputPanel>
            </apex:pageblockSectionItem>
            <apex:pageblockSectionItem >
              <apex:outputPanel >
                <table class="tabStyle">
                  <tr class="tabRowStyle">
                    <td class="tabTextColStyle">
                      <apex:outputText value="{!$Label.HUMIntNumberFieldLabel}" />
                    </td>
                    <td class="tabFieldColStyle">
                      <apex:outputField label="Name" value="{!oFetchInteraction.name}" />
                    </td>
                  </tr>
                </table>
              </apex:outputPanel>
            </apex:pageblockSectionItem>
          </apex:panelgrid>
          <apex:panelgrid columns="1" styleClass="panelGridStyleSmall">
          </apex:panelgrid>
        </apex:pageBlockSection>
      </apex:actionRegion>
    </apex:pageBlock>
    <!-- Action Function starts -->
        <apex:actionFunction action="{!initializeInteraction}" name="setRecordId" onComplete="getPrimaryTabObjectId();" reRender="pbsInteractionLog,fnonChangeINqAbt,loadCallBackQS,fAlert,idAuthCheckPanel">
      <apex:param assignTo="{!sStandardUrl}" name="resultId" value="" />
    </apex:actionFunction>
    <apex:actionFunction action="{!save}" status="pleaseWaitInt" name="setRecordIdAccCase" oncomplete="refreshTab();" reRender="pgIntMsg">
      <apex:param assignTo="{!sAccountId}" name="resultId" value="" />
    </apex:actionFunction>
        <apex:actionFunction action="{!saveInteractionRecord}" name="setRecordIdAccInt" onComplete="if ({!isGenesysUser} == true){synchAllLogs();openIntSavedPopup();phoneBookCallerTypeUpdate(sInteractionName);}else{synchAllLogs();}" reRender="idAuthCheckPanel,pbsInteractionLog,pgIntMsg,fnonChangeINqAbt"
            status="pleaseWaitInt"></apex:actionFunction>
        <apex:actionFunction status="pleaseWaitInt" action="{!SaveAndNew}" name="actFnSaveAndNew" oncomplete="EventFiring();" reRender="idAuthCheckPanel,pbsInteractionLog,pgIntMsg,fnonChangeINqAbt,fAlert">
      <apex:param assignTo="{!sAccountId}" name="resultId" value="" />
    </apex:actionFunction>
        <apex:actionFunction status="pleaseWaitInt" action="{!SaveAndNew}" name="actFnSaveAndNewVFPage" oncomplete="EventFiring();" reRender="idAuthCheckPanel,pbsInteractionLog,pgIntMsg,fnonChangeINqAbt,fAlert">
    </apex:actionFunction>
    <apex:actionFunction action="{!flushInteraction}" name="flushInteraction" reRender="intForm" />
    <apex:actionFunction status="pleaseWaitInt" action="{!onChangeInqAbt}" name="onChangeInqAbt" oncomplete="openPrimaryTabsOnchange();" reRender="pbsInteractionLog,fnonChangeINqAbt,fAlert">
      <apex:param assignTo="{!sAccountId}" name="resultId" value="" />
    </apex:actionFunction>
    <apex:actionFunction action="{!authCheckHandler}" name="AuthenticationCheck" reRender="idAuthCheckPanel"/>
    
    <apex:actionStatus id="pleaseWaitInt">
      <apex:facet name="start">
        <div class="waitingSearchDiv waitingSearchDivOpacity outerPanel" ></div>
        <div id="searchingStatus" class="waitingSearchDiv innerPanel">
          <div class="waitingHolder" style="imageClass">
            <img class="waitingImage" src="/img/loading.gif"/>
            <span class="waitingDescription">{!$Label.HUMLoadingStatus}</span>
          </div>
        </div>
      </apex:facet>
      <apex:facet name="stop"/>
    </apex:actionStatus>
    <!-- Action Function ENDS -->
    <!-- Purpose of the below output panel is to reRender JS function to get updated values from Controller  -->
    <apex:outputpanel id="fnonChangeINqAbt">
      <script type="text/javascript">
        var sAccId = '{!JSENCODE(sAccountId)}';
        var sInteractionId = '{!JSENCODE(oFetchInteraction.id)}';
        var sInteractionName = '{!JSENCODE(oFetchInteraction.Interacting_With_type__c)}';
        var sAccName = '{!JSENCODE(sAccName)}';
        var prevSelectedInqAbt = '{!JSENCODE(sPrevSelectedInqAbt)}';
        var currSelectedInqAbt = document.getElementById("{!$Component.intPage.intForm.pbIntLogPage.pbsInteractionLog.pbsSectInqAbt.selectINqAbout}");
        var bGetAccess = '{!JSENCODE(IF(bGetAccess, "true", "false"))}';
	      var hasError = {!hasError};
        var isGenesysUser = {!isGenesysUser};
        var SwitchOBInteraction = {!SwitchOBInteraction};
        var bcallerTypePopSwitch = {!callerTypePopSwitch};
        var multiMemberAuthSwitchvalue ={!multiMemberAuthSwitch}

        window.onload = function() {
        if (sforce.console.isInConsole()) {
        getEnclosingPrimaryTabId();
        }
        }
        sforce.console.onFocusedSubtab(eventHandler);
        intObj.vRecursion = false;

      </script>
    </apex:outputpanel>
    <apex:outputpanel id="loadCallBackQS">
      <script type="text/javascript">
        var sAccCallBack = '{!JSENCODE(sHomePhone)}';
        sforce.console.fireEvent('MemberSearchResultPhoneNumber',sAccCallBack);
      </script>
    </apex:outputpanel>
  </apex:form>
</apex:page>