using System;
using System.Collections;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.IO;
using System.Text;
using System.Xml;
using System.Text.RegularExpressions;
using Epi.Collections;
using Epi;
using Epi.Data;
using Epi.DataSets;
using Epi.Fields;
using Epi.Resources;

namespace Epi.Data.Services
{



    public class MetadataXmlProvider : IMetadataProvider
    {
        //MetadataProvider Database Members





        [Obsolete("Use of DataTable in      context is no different than the use of a multidimensional System.Object array (not recommended).", false)]
        public DataTable GetCodeTableColumnSchema(string tableName)
        {
            Util.Assert(tableName.StartsWith("meta") == false);
            return db.GetTableColumnSchema(tableName);
        }






        public DataTable GetCodeTableData(string tableName)
        {
            Util.Assert(tableName.StartsWith("meta") == false);
            return db.GetTableData(tableName);
        }







        public DataTable GetCodeTableData(string tableName, string columnNames)
        {
            Util.Assert(tableName.StartsWith("meta") == false);
            return this.db.GetTableData(tableName, columnNames);
        }







        public DataTable GetCodeTableData(string tableName, List columnNames)
        {
            Util.Assert(tableName.StartsWith("meta") == false);
            return this.db.GetTableData(tableName, columnNames);
        }








        public DataTable GetCodeTableData(string tableName, string columnNames, string sortCriteria)
        {
            return this.db.GetTableData(tableName, columnNames, sortCriteria);
        }

        //

        //Fields
        private Project project;
        private IDbDriverFactory dbFactory = null;



        protected IDbDriver db;
        //Fields

        //Events



        public event ProgressReportBeginEventHandler ProgressReportBeginEvent;




        public event ProgressReportUpdateEventHandler ProgressReportUpdateEvent;




        public event SimpleEventHandler ProgressReportEndEvent;
        //Events

        //Constructors





        public MetadataXmlProvider(Project proj)
        {
            //Input validation
            if (proj == null)
                throw new System.ArgumentNullException("proj");
            //Input validation

            project = proj;


            XmlNode root = GetRootNode();
            root.AppendChild(GetXmlDocument().CreateElement("Views"));
            Save();
        }

        //Constructors

        //Public Properties




        public Project Project
        {
            get
            {
                return project;
            }
        }




        public IDbDriverFactory DBFactory
        {
            get { return dbFactory; }
        }

        //Public Properties

        //Public Methods










        public string GetAvailDataTableName(string viewName)
        {
            string name = string.Empty;
            return name;
        }





        public DataTable GetCodeTableList()
        {
            try
            {
                DataSets.TableSchema.TablesDataTable tables = db.GetTableSchema();

                DataRow[] rowsFiltered = tables.Select("TABLE_NAME not like 'code%'");
                foreach (DataRow rowFiltered in rowsFiltered)
                {
                    tables.Rows.Remove(rowFiltered);
                }
                return tables;
            }
            catch (Exception ex)
            {
                throw new System.ApplicationException("Could not retrieve code tables from database", ex);
            }
        }


        //Select Statements





        public virtual DataTable GetViewsAsDataTable()
        {
            try
            {
                Query query = db.CreateQuery(
                    @"select [ViewId], [Name], [CheckCodeBefore], [CheckCodeAfter], [RecordCheckCodeBefore],
                    [RecordCheckCodeAfter], [CheckCodeVariableDefinitions], [IsRelatedView]
     from metaViews"
                    );

                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve view data table", ex);
            }
        }







        public ViewCollection GetViews(XmlElement currentViewElement, XmlNode viewsNode)
        {
            ViewCollection views = new Collections.ViewCollection();
            foreach (XmlNode childNode in viewsNode.ChildNodes)
            {
                if (currentViewElement == null)
                {

                    currentViewElement = (XmlElement)childNode;
                }

                View newView = new View(this.Project, currentViewElement);
                newView.Name = childNode.Attributes["Name"].Value;
                views.Add(newView);
            }
            return views;
        }





        public ViewCollection GetViews()
        {
            try
            {
                Collections.ViewCollection views = new Collections.ViewCollection();
                DataTable table = GetViewsAsDataTable();
                foreach (DataRow row in table.Rows)
                {
                    views.Add(new View(row, this.Project));
                }
                return views;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve view collection", ex);
            }
        }
        /*




                public DataTable GetPagesForProject()
                {
                    try
                    {
                        DbQuery query = db.CreateQuery("select P.[PageId], V.[ViewId], P.[Name] AS PageName, V.[Name] AS ViewName, P.[Position] " +
                            "from metaViews V inner join metaPages P on V.[ViewId] = P.[ViewId] " +
                            "order by V.[Name], P.[Position]");
                        return db.Select(query);
                    }
                    catch (Exception ex)
                    {
                        throw new GeneralException("Could not retrieve page", ex);
                    }
                }
        */






        public DataTable GetPagesForView(int viewId)
        {
            try
            {
                //Input Validation
                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select [PageId], [ViewId], [Name], [Position], [CheckCodeBefore], [CheckCodeAfter] " +
                    "from metaPages " +
                    "where [ViewId] = @ViewId " +
                    "order by [Position] asc");
                query.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve page", ex);
            }
        }






        public virtual List GetViewPages(View view)
        {
            try
            {
                List pages = new List();
                XmlNode pagesNode = view.ViewElement.SelectSingleNode("Pages");
                foreach (XmlNode pageNode in pagesNode.ChildNodes)
                {
                    Page page = new Page(view);
                    page.Id = Int32.Parse(pageNode.Attributes["PageId"].Value);
                    page.Position = Int32.Parse(pageNode.Attributes["Position"].Value);
                    page.Name = pageNode.Attributes["Name"].Value;
                    pages.Add(new Page(view, page.Id));
                }
                return (pages);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve page collection", ex);
            }
        }






        [Obsolete("Use of DataTable in      context is no different than the use of a multidimensional System.Object array (not recommended).", false)]
        public DataTable GetViewCheckCode_Before(int viewID)
        {
            try
            {
                //Input Validation
                if (viewID < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select V.[ViewID], V.[Name], V.[CheckCodeBefore] " +
                    "from metaViews V " +
                    "where V.[ViewId] = @ViewID");
                query.Parameters.Add(new QueryParameter("@ViewID", DbType.Int32, viewID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve view's check code", ex);
            }
        }






        [Obsolete("Use of DataTable in      context is no different than the use of a multidimensional System.Object array (not recommended).", false)]
        public DataTable GetViewCheckCode_After(int viewID)
        {
            try
            {
                //Input Validation
                if (viewID < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select V.[ViewID], V.[Name], V.[CheckCodeAfter] " +
                    "from metaViews V " +
                    "where V.[ViewId] = @ViewID");
                query.Parameters.Add(new QueryParameter("@ViewID", DbType.Int32, viewID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve view's check code", ex);
            }
        }






        [Obsolete("Use of DataTable in      context is no different than the use of a multidimensional System.Object array (not recommended).", false)]
        public DataTable GetCheckCodeVariableDefinition(int viewID)
        {
            try
            {
                //Input Validation
                if (viewID < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select V.[ViewID], V.[Name], V.[CheckCodeVariableDefinitions] " +
                    "from metaViews V " +
                    "where V.[ViewID] = @ViewID");
                query.Parameters.Add(new QueryParameter("@ViewID", DbType.Int32, viewID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve check code variables", ex);
            }
        }






        [Obsolete("Use of DataTable in      context is no different than the use of a multidimensional System.Object array (not recommended).", false)]
        public DataTable GetRecordCheckCode_Before(int viewID)
        {
            try
            {
                //Input Validation
                if (viewID < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select V.[ViewID], V.[Name], V.[RecordCheckCodeBefore] " +
                    "from metaViews V " +
                    "where v.[ViewID] = @ViewID");
                query.Parameters.Add(new QueryParameter("@ViewID", DbType.Int32, viewID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve record check code", ex);
            }
        }







        public DataRow GetFieldIdByNameAsDataRow(string viewName, string fieldName)
        {
            try
            {
                Query query = db.CreateQuery("select [FieldId] from (metaFields f inner join metaViews v on v.[ViewId] = f.[ViewId]) where v.[Name] = @ViewName and f.[Name] = @FieldName");
                query.Parameters.Add(new QueryParameter("@ViewName", DbType.String, viewName));
                query.Parameters.Add(new QueryParameter("@FieldName", DbType.String, fieldName));
                DataTable dt = db.Select(query);
                if (dt.Rows.Count == 0)
                {
                    throw new GeneralException("Field not found");
                }
                return dt.Rows[0];
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve control based on view and field name", ex);
            }
        }






        public DataRow GetFieldAsDataRow(Field field)
        {
            string queryString =
                "select F.[FieldId], F.[Name] As Name, F.[PageId], F.[ViewId], F.[FieldTypeId], F.[CheckCodeAfter] As ControlAfterCheckCode, F.[CheckCodeBefore] As ControlBeforeCheckCode,  " +
                "F.[ControlTopPositionPercentage], F.[ControlLeftPositionPercentage], F.[ControlHeightPercentage], F.[ControlWidthPercentage], " +
                "F.[ControlFontFamily] As ControlFontFamily, F.[ControlFontSize] As ControlFontSize, F.[ControlFontStyle] As ControlFontStyle, F.[ControlScriptName], " +
                "F.[PromptTopPositionPercentage], F.[PromptLeftPositionPercentage], F.[PromptText], F.[PromptFontFamily], F.[PromptFontSize], F.[PromptFontStyle], F.[ControlFontFamily], F.[ControlFontSize], F.[ControlFontStyle], F.[PromptScriptName], " +
                "F.[ShouldRepeatLast], F.[IsRequired], F.[IsReadOnly],  " +
                "F.[ShouldRetainImageSize], F.[Pattern], F.[MaxLength], F.[ShowTextOnRight], " +
                "F.[Lower], F.[Upper], F.[RelateCondition], F.[ShouldReturnToParent], F.[RelatedViewId], " +
                "F.[SourceTableName], F.[CodeColumnName], F.[TextColumnName], " +
                "F.[Sort], F.[IsExclusiveTable], F.[TabIndex], F.[HasTabStop],F.[SourceFieldId], F.[DataTableName] " +
                "from metaFields F where F.[ViewId] = @viewId AND F.[FieldId] = @fieldID " +
                "order by F.[ControlTopPositionPercentage], F.[ControlLeftPositionPercentage]";

            Query query = db.CreateQuery(queryString);
            query.Parameters.Add(new QueryParameter("@viewID", DbType.Int32, field.GetView().Id));
            query.Parameters.Add(new QueryParameter("@fieldID", DbType.Int32, field.Id));
            return db.Select(query).Rows[0];
        }







        public DataRow GetFieldAsDataRow(int viewId, string fieldName)
        {
            try
            {
                string sql = "select * from metaFields where  [ViewId] = @ViewId and [Name] = @FieldName";
                Query query = db.CreateQuery(sql);
                query.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));
                query.Parameters.Add(new QueryParameter("@FieldName", DbType.String, fieldName));
                DataTable dt = db.Select(query);
                if (dt.Rows.Count == 0)
                {
                    throw new GeneralException("Field not found");
                }
                return dt.Rows[0];
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve control based on view and field name", ex);
            }
        }






        public View GetViewById(int viewId)
        {
            try
            {
                Query query = db.CreateQuery("select [ViewId], [Name], [CheckCodeBefore], [CheckCodeAfter], [RecordCheckCodeBefore], [RecordCheckCodeAfter], [CheckCodeVariableDefinitions], [IsRelatedView] " +
                    "from metaViews " +
                    "where [ViewId] = @ViewId");
                query.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));
                DataTable results = db.Select(query);
                if (results.Rows.Count > 0)
                {
                    return new View(results.Rows[0], Project);
                }
                else
                {
                    return null;
                }
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve view", ex);
            }
        }






        [Obsolete("Use of DataTable in      context is no different than the use of a multidimensional System.Object array (not recommended).", false)]
        public DataTable GetRecordCheckCode_After(int viewID)
        {
            try
            {
                //Input Validation
                if (viewID < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select V.[ViewID], V.[Name], V.[RecordCheckCodeAfter] " +
                    "from metaViews V " +
                    "where v.[ViewID] = @ViewID");
                query.Parameters.Add(new QueryParameter("@ViewID", DbType.Int32, viewID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve record check code", ex);
            }
        }






        public DataTable GetPageCheckCode_Before(Page page)
        {
            try
            {
                //Input Validation
                if (page == null)
                {
                    throw new ArgumentNullException("Page");
                }
                //

                Query query = db.CreateQuery("select P.[PageID], P.[Name], P.[CheckCodeBefore] " +
                    "from metaPages P " +
                    "where P.[PageID] = @PageID");
                query.Parameters.Add(new QueryParameter("@PageID", DbType.Int32, page.Id));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve page check code", ex);
            }
        }






        public DataTable GetPageCheckCode_After(Page page)
        {
            try
            {
                //Input Validation
                if (page == null)
                {
                    throw new ArgumentNullException("Page");
                }
                //

                Query query = db.CreateQuery("select P.[PageID], P.[Name], P.[CheckCodeAfter] " +
                    "from metaPages P " +
                    "where P.[PageID] = @PageID");
                query.Parameters.Add(new QueryParameter("@PageID", DbType.Int32, page.Id));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve page check code", ex);
            }
        }






        public DataTable GetFieldCheckCode_Before(int fieldID)
        {
            try
            {
                //Input Validation
                if (fieldID < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                //

                Query query = db.CreateQuery("select [CheckCodeBefore], [Name] from metaFields " +
                    "where [FieldID] = @FieldID");




                query.Parameters.Add(new QueryParameter("@FieldID", DbType.Int32, fieldID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve control check code", ex);
            }
        }






        public DataTable GetFieldCheckCode_After(int fieldID)
        {
            try
            {
                //Input Validation
                if (fieldID < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                //

                Query query = db.CreateQuery("select [CheckCodeAfter], [Name] from metaFields " +



                    "where [FieldID] = @FieldID");
                query.Parameters.Add(new QueryParameter("@FieldID", DbType.Int32, fieldID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve control check code", ex);
            }
        }






        public DataTable GetViewRecordVarCheckCodes(int viewID)
        {
            try
            {
                //Input Validation
                if (viewID < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select [ViewID], [Name], [CheckCodeBefore], [CheckCodeAfter], " +
                    "[RecordCheckCodeBefore], [RecordCheckCodeAfter], [CheckCodeVariableDefinitions] " +
                    "from metaViews " +
                    "where [ViewID] = @ViewID");
                query.Parameters.Add(new QueryParameter("@ViewID", DbType.Int32, viewID));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve check codes for views, records, and variables", ex);
            }
        }






        public View GetChildView(RelatedViewField field)
        {
            try
            {

                View currentView = field.GetView();
                XmlNode viewsNode = GetViewsNode();
                XmlNode currentViewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + currentView.Id + "']");
                XmlNode fieldNode = currentViewNode.SelectSingleNode("//View/Fields[@FieldId = '" + field.Id + "']");
                if (fieldNode == null) return null; 

                string relatedViewId = fieldNode.Attributes["RelatedViewId"].Value;
                XmlNode relatedViewNode = viewsNode.SelectSingleNode("View[@ViewId = '" + relatedViewId + "']");

                XmlElement currentViewElement = (XmlElement)relatedViewNode;
                View newView = new View(this.Project, currentViewElement);
                newView.Name = relatedViewNode.Attributes["Name"].Value;
                return newView;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve related view", ex);
            }
        }






        public DataTable GetControlsForPage(int pageId)
        {
            try
            {

                //Input Validation
                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query query = db.CreateQuery("select [FieldTypeId], [Name] As FieldName, [ControlTopPositionPercentage] As ControlTop, " +
                    "[ControlLeftPositionPercentage] As ControlLeft, [ControlHeightPercentage], [ControlWidthPercentage], [PromptText], [PromptFontSize], " +
                    "[PromptTopPositionPercentage] AS LabelTop, [PromptLeftPositionPercentage] As LabelLeft, [FieldId] " +
                    "from metaFields " +


                    "where [PageId] = @PageId " +
                    "order by [FieldTypeId]");
                query.Parameters.Add(new QueryParameter("@PageId", DbType.Int32, pageId));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve controls", ex);
            }
        }






        public DataTable GetSystemFields(int viewId)
        {
            try
            {
                //Input Validation
                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query query = db.CreateQuery("select F.[Name], F.[PageId], F.[FieldId], F.[FieldTypeId], F.[CheckCodeAfter] As ControlAfterCheckCode, F.[CheckCodeBefore] As ControlBeforeCheckCode,  " +
                    "F.[ControlTopPositionPercentage], F.[ControlLeftPositionPercentage], F.[ControlHeightPercentage], F.[ControlWidthPercentage] , F.[ControlFontFamily], F.[ControlFontSize], F.[ControlFontStyle], F.[ControlScriptName], " +
                    "F.[PromptTopPositionPercentage], F.[PromptLeftPositionPercentage], F.[PromptText], F.[PromptFontFamily], F.[PromptFontSize], F.[PromptFontStyle], F.[ControlFontFamily], F.[ControlFontSize], F.[ControlFontStyle], F.[PromptScriptName], " +
                    "F.[ShouldRepeatLast], F.[IsRequired], F.[IsReadOnly],  " +
                    "F.[ShouldRetainImageSize], F.[Pattern], F.[MaxLength], F.[ShowTextOnRight], " +
                    "F.[Lower], F.[Upper], F.[RelateCondition], F.[ShouldReturnToParent], F.[RelatedViewId], " +
                    "F.[SourceTableName], F.[CodeColumnName], F.[TextColumnName], " +
                    "F.[Sort], F.[IsExclusiveTable], F.[TabIndex], F.[HasTabStop],F.[SourceFieldId] " +
                    "from metaFields F " +
                    "where F.[ViewId] = @ViewId and F.[PageId] is null");
                query.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve fields", ex);
            }
        }








































        public DataTable GetFieldsOnPageAsDataTable(int pageId)
        {
            try
            {
                //Input Validation
                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query query = db.CreateQuery("select F.[Name], F.[PageId], F.[FieldId], F.[FieldTypeId], F.[CheckCodeAfter] As ControlAfterCheckCode, F.[CheckCodeBefore] As ControlBeforeCheckCode,  " +
                    "P.[Name] AS PageName, P.[CheckCodeBefore] As PageBeforeCheckCode, P.[CheckCodeAfter] As PageAfterCheckCode, P.[Position], " +
                    "F.[ControlTopPositionPercentage], F.[ControlLeftPositionPercentage], F.[ControlHeightPercentage], F.[ControlWidthPercentage] , F.[ControlFontFamily], F.[ControlFontSize], F.[ControlFontStyle], F.[ControlScriptName], " +
                    "F.[PromptTopPositionPercentage], F.[PromptLeftPositionPercentage], F.[PromptText], F.[PromptFontFamily], F.[PromptFontSize], F.[PromptFontStyle], F.[ControlFontFamily], F.[ControlFontSize], F.[ControlFontStyle], F.[PromptScriptName], " +
                    "F.[ShouldRepeatLast], F.[IsRequired], F.[IsReadOnly],  " +
                    "F.[ShouldRetainImageSize], F.[Pattern], F.[MaxLength], F.[ShowTextOnRight], " +
                    "F.[Lower], F.[Upper], F.[RelateCondition], F.[ShouldReturnToParent], F.[RelatedViewId], " +
                    "F.[SourceTableName], F.[CodeColumnName], F.[TextColumnName], " +
                    "F.[Sort], F.[IsExclusiveTable], F.[TabIndex], F.[HasTabStop],F.[SourceFieldId] " +
                    "from ((metaFields F " +
                    "LEFT JOIN metaPages P on P.[PageId] = F.[PageId]) " +
                    "LEFT JOIN metaViews V on V.[ViewId] = P.[ViewId]) " +
                    "where F.[PageId] = @pageID " +
                    "order by F.[ControlTopPositionPercentage], F.[ControlLeftPositionPercentage]");
                query.Parameters.Add(new QueryParameter("@pageID", DbType.Int32, pageId));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve fields", ex);
            }
        }






        public DataTable GetFieldsAsDataTable(View view)
        {
            try
            {
                //Input Validation
                if (view == null)
                {
                    throw new ArgumentNullException("View");
                }
                // 

                string queryString =
                    "select F.[FieldId], F.[Name] As Name, F.[PageId], F.[ViewId], F.[FieldTypeId], F.[CheckCodeAfter] As ControlAfterCheckCode, F.[CheckCodeBefore] As ControlBeforeCheckCode,  " +
                    "F.[ControlTopPositionPercentage], F.[ControlLeftPositionPercentage], F.[ControlHeightPercentage], F.[ControlWidthPercentage], " +
                    "F.[ControlFontFamily] As ControlFontFamily, F.[ControlFontSize] As ControlFontSize, F.[ControlFontStyle] As ControlFontStyle, F.[ControlScriptName], " +
                    "F.[PromptTopPositionPercentage], F.[PromptLeftPositionPercentage], F.[PromptText], F.[PromptFontFamily], F.[PromptFontSize], F.[PromptFontStyle], F.[ControlFontFamily], F.[ControlFontSize], F.[ControlFontStyle], F.[PromptScriptName], " +
                    "F.[ShouldRepeatLast], F.[IsRequired], F.[IsReadOnly],  " +
                    "F.[ShouldRetainImageSize], F.[Pattern], F.[MaxLength], F.[ShowTextOnRight], " +
                    "F.[Lower], F.[Upper], F.[RelateCondition], F.[ShouldReturnToParent], F.[RelatedViewId], " +
                    "F.[SourceTableName], F.[CodeColumnName], F.[TextColumnName], " +
                    "F.[Sort], F.[IsExclusiveTable], F.[TabIndex], F.[HasTabStop],F.[SourceFieldId], F.[DataTableName] " +
                    "from metaFields F where F.[ViewId] = @viewId " +
                    "order by F.[ControlTopPositionPercentage], F.[ControlLeftPositionPercentage]";

                Query query = db.CreateQuery(queryString);
                query.Parameters.Add(new QueryParameter("@viewID", DbType.Int32, view.Id));
                return db.Select(query);
            }




            finally
            {
            }
        }






        public DataTable GetFieldMetadataSync(View view)
        {
            return null;
        }







        public DataTable GetFieldMetadataSync(int pageId)
        {
            return null;
        }






        public virtual FieldCollectionMaster GetFields(View view)
        {
            try
            {
                FieldCollectionMaster fields = new FieldCollectionMaster();







                XmlNode fieldsNode = view.ViewElement.SelectSingleNode("Fields");
                foreach (XmlNode fieldNode in fieldsNode.ChildNodes)
                {

                    MetaFieldType fieldTypeId = (MetaFieldType)Enum.Parse(typeof(MetaFieldType), fieldNode.Attributes["FieldTypeId"].Value.ToString());

                    Field field = null;
                    switch (fieldTypeId)
                    {
                        case MetaFieldType.Text:
                            field = new SingleLineTextField(view, fieldNode);
                            break;
                        case MetaFieldType.LabelTitle:
                            field = new LabelField(view, fieldNode);
                            break;
                        case MetaFieldType.TextUppercase:
                            field = new UpperCaseTextField(view, fieldNode);
                            break;
                        case MetaFieldType.Multiline:
                            field = new MultilineTextField(view, fieldNode);
                            break;
                        case MetaFieldType.Number:
                            field = new NumberField(view, fieldNode);
                            break;
                        case MetaFieldType.PhoneNumber:
                            field = new PhoneNumberField(view, fieldNode);
                            break;
                        case MetaFieldType.Date:
                            field = new DateField(view, fieldNode);
                            break;
                        case MetaFieldType.Time:
                            field = new TimeField(view, fieldNode);
                            break;
                        case MetaFieldType.DateTime:
                            field = new DateTimeField(view, fieldNode);
                            break;
                        case MetaFieldType.Checkbox:
                            field = new CheckBoxField(view, fieldNode);
                            break;
                        case MetaFieldType.YesNo:
                            field = new YesNoField(view, fieldNode);
                            break;
                        case MetaFieldType.Option:
                            field = new OptionField(view, fieldNode);
                            break;
                        case MetaFieldType.CommandButton:
                            field = new CommandButtonField(view, fieldNode);
                            break;
                        case MetaFieldType.Image:
                            field = new ImageField(view, fieldNode);
                            break;
                        case MetaFieldType.Mirror:
                            field = new MirrorField(view, fieldNode);
                            break;
                        case MetaFieldType.Grid:
                            field = new GridField(view, fieldNode);
                            break;
                        case MetaFieldType.LegalValues:
                            field = new DDLFieldOfLegalValues(view, fieldNode);
                            break;
                        case MetaFieldType.Codes:
                            field = new DDLFieldOfCodes(view, fieldNode);
                            break;
                        case MetaFieldType.List:
                            field = new DDListField(view, fieldNode);
                            break;
                        case MetaFieldType.CommentLegal:
                            field = new DDLFieldOfCommentLegal(view, fieldNode);
                            break;
                        case MetaFieldType.Relate:
                            field = new RelatedViewField(view, fieldNode);
                            break;
                        case MetaFieldType.RecStatus:
                            field = new RecStatusField(view);
                            break;
                        case MetaFieldType.UniqueKey:
                            field = new UniqueKeyField(view);
                            break;
                        case MetaFieldType.ForeignKey:
                            field = new ForeignKeyField(view);
                            break;
                        default:
                            throw new GeneralException("Invalid Field Type");
                    }

                    fields.Add(field);
                }
                return (fields);
            }
            finally
            {
            }
        }






        public List GetGridColumnCollection(GridField field)
        {
            List columns = new List();
            DataTable table = GetGridColumns(field.Id);
            foreach (DataRow row in table.Rows)
            {
                switch ((MetaFieldType)row["FieldTypeId"])
                {
                    case MetaFieldType.UniqueKey:
                        columns.Add(new UniqueKeyColumn(row, field));
                        break;
                    case MetaFieldType.RecStatus:
                        columns.Add(new RecStatusColumn(row, field));
                        break;
                    case MetaFieldType.ForeignKey:
                        columns.Add(new ForeignKeyColumn(row, field));
                        break;
                    case MetaFieldType.Text:
                        columns.Add(new TextColumn(row, field));
                        break;
                    case MetaFieldType.Number:
                        columns.Add(new NumberColumn(row, field));
                        break;
                    case MetaFieldType.PhoneNumber:
                        columns.Add(new PhoneNumberColumn(row, field));
                        break;
                    case MetaFieldType.Date:
                        columns.Add(new DateColumn(row, field));
                        break;
                    case MetaFieldType.CommentLegal:
                        columns.Add(new DDLColumnOfCommentLegal(row, field));
                        break;
                    case MetaFieldType.LegalValues:
                        columns.Add(new DDLColumnOfLegalValues(row, field));
                        break;
                    default:
                        break;
                }
            }
            return columns;
        }






        public DataTable GetGridColumns(int fieldId)
        {
            try
            {
                //Input Validation
                if (fieldId < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                //

                Query query = db.CreateQuery("select G.[GridColumnId], G.[Name], G.[Width], G.[Size], G.[Position], G.[FieldTypeId], " +
                    "G.[Text], G.[ShouldRepeatLast], G.[IsRequired], G.[IsReadOnly], G.[Pattern], G.[Upper], G.[Lower], " +
                    "G.[DataTableName], G.[IsExclusiveTable], G.[SourceTableName], G.[TextColumnName], G.[CodeColumnName], G.[Sort] " +
                    "from metaGridColumns G " +
                    "where G.[FieldId] = @FieldId");
                query.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, fieldId));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve grid column", ex);
            }
        }





        public DataTable GetFieldTypes()
        {
            try
            {
                Query query = db.CreateQuery("select F.[FieldTypeId], D.[DataTypeId], F.[Name], D.[HasPattern], D.[HasSize], F.[HasRepeatLast], F.[HasRequired], F.[HasReadOnly], F.[HasRetainImageSize], D.[HasRange], F.[HasFont], F.[IsGridColumn], F.[IsDropDown] " +
                    "from metaFieldTypes F LEFT OUTER JOIN metaDatatypes D on F.[DataTypeId] = D.[DataTypeId] " +
                    "where F.[IsSystem] = @IsSystem");
                query.Parameters.Add(new QueryParameter("@IsSystem", System.Data.DbType.Boolean, false));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve field types", ex);
            }
        }






        public XmlElement GetFieldViewElement(Field field)
        {
            XmlNode viewsNode = GetViewsNode();
            XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId= '" + field.GetView().Id + "']");
            XmlElement viewElement = (XmlElement)viewNode;
            return viewElement;
        }





        public MapMetadata.metaLayersDataTable GetLayers()
        {
            try
            {
                MapMetadata.metaLayersDataTable table = new MapMetadata.metaLayersDataTable();
                Query query = db.CreateQuery("select [LayerId], [Name], [Description] from metaLayers");
                table.Merge(db.Select(query));
                return table;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve map layers", ex);
            }
        }






        public MapMetadata.metaMapLayersRow GetMapLayer(int mapLayerId)
        {
            try
            {
                MapMetadata map = new MapMetadata();
                Query query = db.CreateQuery("select [MapLayerId], [MapId], [LayerId], [LayerRenderTypeId], [RenderField], [MarkerColor], [RampBeginColor], [RampEndColor], [ClassBreaks] from metaMapLayers where [MapLayerId] = @MapLayerId");
                query.Parameters.Add(new QueryParameter("@MapLayerId", System.Data.DbType.Int32, mapLayerId));
                map.metaMapLayers.Merge(db.Select(query));
                if (map.metaMapLayers.Count > 0)
                {
                    map.metaLayers.ImportRow(GetLayer(map.metaMapLayers[0].LayerId));
                    return map.metaMapLayers[0];
                }
                else
                {
                    throw new GeneralException("Map layer not found");
                }
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve map layer", ex);
            }
        }





        public MapMetadata.metaMapsDataTable GetMaps()
        {
            try
            {
                MapMetadata map = new MapMetadata();
                Query query = db.CreateQuery("select [MapId], [Name], [Title] from metaMaps");
                map.metaMaps.Merge(db.Select(query));
                return map.metaMaps;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve maps", ex);
            }
        }






        public MapMetadata.metaMapsDataTable GetMap(int mapId)
        {
            try
            {
                MapMetadata map = new MapMetadata();
                Query query = db.CreateQuery("select [MapId], [Name], [Title] from metaMaps where [MapId] = @MapId");
                query.Parameters.Add(new QueryParameter("@MapId", DbType.Int32, mapId));
                map.metaMaps.Merge(db.Select(query));
                return map.metaMaps;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve map", ex);
            }
        }







        public int CreateMap(string name, string description)
        {
            try
            {
                Query insertQuery = db.CreateQuery("insert into metaMaps ([Name], [Title]) values (@Name, @Description)");
                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, name));
                insertQuery.Parameters.Add(new QueryParameter("@Description", DbType.String, description));
                db.ExecuteNonQuery(insertQuery);
                return GetMaxMapId();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not insert map record", ex);
            }
        }






        public int CreateLayer(string fileName)
        {
            Query insertQuery = db.CreateQuery("insert into metaLayers ([FileName], [Name]) values (@FileName, @Name)");
            insertQuery.Parameters.Add(new QueryParameter("@FileName", DbType.String, fileName));
            insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, Path.GetFileNameWithoutExtension(fileName)));
            db.ExecuteNonQuery(insertQuery);
            return GetMaxLayerId();
        }








        public int CreateLayer(string gml, string gmlSchema, string layerName)
        {
            Query insertQuery = db.CreateQuery("insert into metaLayers ([Gml], [GmlSchema], [Name]) values (@Gml, @GmlSchema, @Name)");
            insertQuery.Parameters.Add(new QueryParameter("@Gml", DbType.String, gml));
            insertQuery.Parameters.Add(new QueryParameter("@GmlSchema", DbType.String, gmlSchema));
            insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, layerName));
            db.ExecuteNonQuery(insertQuery);
            return GetMaxLayerId();
        }






        public MapMetadata.metaMapLayersDataTable GetMapLayers(int mapId)
        {
            try
            {
                MapMetadata map = new MapMetadata();
                Query query = db.CreateQuery("select [MapLayerId], [MapId], [LayerId], [LayerRenderTypeId], [RenderField], [MarkerColor], [RampBeginColor], [RampEndColor], [ClassBreaks], [DataTableName], [DataTableKey], [FeatureKey], [LineColor], [FillColor], [PolygonOutlineColor] from metaMapLayers where [MapId] = @MapId order by [MapLayerId] asc");
                query.Parameters.Add(new QueryParameter("@MapId", System.Data.DbType.Int32, mapId));
                map.metaMapLayers.Merge(db.Select(query));
                foreach (MapMetadata.metaMapLayersRow mapLayer in map.metaMapLayers)
                {
                    map.metaLayers.ImportRow(GetLayer(mapLayer.LayerId));
                }
                return map.metaMapLayers;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve map layers", ex);
            }
        }






        public MapMetadata.metaMapPointsDataTable GetMapPoints(int mapId)
        {
            try
            {
                MapMetadata map = new MapMetadata();
                Query query = db.CreateQuery("select [MapPointId], [MapId], [DataSourceTableName], [DataSourceXCoordinateColumnName], [DataSourceYCoordinateColumnName], [DataSourceLabelColumnName], [Size], [Color] from metaMapPoints where [MapId] = @MapId");
                query.Parameters.Add(new QueryParameter("@MapId", DbType.Int32, mapId));
                map.metaMapPoints.Merge(db.Select(query));
                return map.metaMapPoints;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve map points", ex);
            }
        }






        public MapMetadata.metaLayersRow GetLayer(int layerId)
        {
            try
            {
                MapMetadata.metaLayersDataTable table = new MapMetadata.metaLayersDataTable();
                Query query = db.CreateQuery("select [LayerId], [Gml], [GmlSchema], [Name] from metaLayers where [LayerId] = @LayerId");
                query.Parameters.Add(new QueryParameter("@LayerId", System.Data.DbType.String, layerId));
                table.Merge(db.Select(query));
                if (table.Rows.Count > 0)
                {
                    return table[0];
                }
                else
                {
                    throw new GeneralException("Layer not found");
                }
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve layer", ex);
            }
        }






        public void AddLayerToMap(int mapId, int layerId)
        {
            try
            {
                Query query = db.CreateQuery("insert into metaMapLayers ([MapId], [LayerId], [LayerRenderTypeId]) values (@MapId, @LayerId, @LayerRenderTypeId)");
                query.Parameters.Add(new QueryParameter("@MapId", DbType.Int32, mapId));
                query.Parameters.Add(new QueryParameter("@LayerId", DbType.Int32, layerId));
                query.Parameters.Add(new QueryParameter("@LayerRenderTypeId", DbType.Int32, 1));
                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not add layer", ex);
            }
        }





        public void AttachDbDriver(IDbDriver dbDriver)
        {
            throw new NotImplementedException();
        }





        public void AddGridColumn(DataRow gridColumnRow)
        {
            throw new NotImplementedException();
        }






        public void UpdateFieldType(Epi.Fields.Field field, Epi.MetaFieldType fieldType)
        {
            throw new NotImplementedException();
        }





        public DataTable GetGridFieldTypes()
        {
            try
            {
                Query query = db.CreateQuery("select F.[FieldTypeId], D.[DataTypeId], F.[Name], D.[HasPattern], D.[HasSize], F.[HasRepeatLast], F.[HasRequired], F.[HasReadOnly], F.[HasRetainImageSize], D.[HasRange], F.[HasFont], F.[IsGridColumn], F.[IsDropDown] " +
                    "from metaFieldTypes F LEFT OUTER JOIN metaDatatypes D on F.[DataTypeId] = D.[DataTypeId] " +
                    "where F.[IsGridColumn] = @IsGridColumn");
                query.Parameters.Add(new QueryParameter("@IsGridColumn", System.Data.DbType.Boolean, true));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve field types", ex);
            }
        }






        public DataTable GetGroupsForPage(int pageId)
        {
            try
            {
                //Input Validation
                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query query = db.CreateQuery("select * from metaFields where PageId = @PageId and FieldTypeId = 21");
                query.Parameters.Add(new QueryParameter("@PageId", DbType.Int32, pageId));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve group", ex);
            }
        }





        public int GetCollectedFieldCount(int viewId)
        {
            try
            {
                Query query = db.CreateQuery("SELECT COUNT('ViewId') AS numTimesUsed "
                    + "FROM metaFields "
                    + "WHERE ViewId = '"
                    + viewId.ToString()
                    + "'");

                DataTable dt = db.Select(query);
                int tableNameCount = (int)dt.Rows[0]["numTimesUsed"];
                return tableNameCount;
            }
            catch (Exception ex)
            {
                throw new GeneralException("There are no existing tables.", ex);
            }
        }







        public NamedObjectCollection GetGroupFields(Page page)
        {
            try
            {
                NamedObjectCollection groups = new NamedObjectCollection();
                DataTable table = GetGroupsForPage(page.Id);
                foreach (DataRow row in table.Rows)
                {

                }
                return (groups);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve field groups", ex);
            }
        }





        public DataTable GetPatterns()
        {
            try
            {
                Query query = db.CreateQuery("select [PatternId], [DataTypeId], [Expression], [Mask], [FormattedExpression] " +
                    "from metaPatterns ");
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve patterns", ex);
            }

        }







        public DataTable GetTextFieldsForPage(int viewId, int pageId)
        {
            try
            {
                //Input Validation
                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query query = db.CreateQuery("select [Name], [FieldId] " +
                    "from metaFields " +
                    "where [PageId] = @pageID and [FieldTypeId] in (1,3,4) " +
                    " and [ViewId] = @viewID " +
                    "order by [Name]");
                query.Parameters.Add(new QueryParameter("@pageID", DbType.Int32, pageId));
                query.Parameters.Add(new QueryParameter("@viewID", DbType.Int32, viewId));
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve text fields for a page.", ex);
            }
        }






        public DataTable GetCodeTargetCandidates(int pageId)
        {
            Query query = db.CreateQuery("select * from metaFields " +
                "where [PageId] = @pageID and [FieldTypeId] in (1,3,4,17,18) " +
                "order by [Name]");
            query.Parameters.Add(new QueryParameter("@pageID", DbType.Int32, pageId));
            return db.Select(query);
        }






        public DataSets.TabOrders.TabOrderDataTable GetTabOrderForFields(int pageId)
        {
            try
            {
                //Input Validation
                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query query = db.CreateQuery("select [FieldId],[Name],[PromptText], [TabIndex],[HasTabStop] " +
                    "from metaFields " +
                    "where [PageId] = @pageID and [FieldTypeId] not in (2,15,21) " +
                    "order by [TabIndex]");
                query.Parameters.Add(new QueryParameter("@pageID", DbType.Int32, pageId));
                DataTable table = db.Select(query);
                DataSets.TabOrders tabOrders = new TabOrders();
                tabOrders.TabOrder.Merge(table);
                return tabOrders.TabOrder;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve text fields for a page.", ex);
            }

        }




















































































        public virtual DataTable GetNonViewTablesAsDataTable()
        {
            try
            {
                DataRow dataRow;
                DataTable tables = db.GetTableSchema(); 

                DataTable viewsAndTables = new DataTable("ViewsAndTables");
                viewsAndTables.Columns.Add(ColumnNames.NAME);
                DataRow[] rows = tables.Select("TABLE_NAME not like 'meta%'");
                foreach (DataRow row in rows)
                {
                    string tableName = row["Table_Name"].ToString();



                    dataRow = viewsAndTables.NewRow();
                    dataRow[ColumnNames.NAME] = tableName;
                    viewsAndTables.Rows.Add(dataRow);

                }

                return (viewsAndTables);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve Views and Tables.", ex);
            }
        }






        public View GetViewByFullName(string viewFullName)
        {
            //Input Validation
            if (string.IsNullOrEmpty(viewFullName))
            {
                throw new ArgumentNullException("View Full Name");
            }
            //
            try
            {
                XmlDocument doc = GetXmlDocument();
                XmlNode viewsNode = GetViewsNode();
                string viewName = viewFullName.Substring(viewFullName.LastIndexOf(":") + 1);
                XmlNode viewNode = viewsNode.SelectSingleNode("//View[@Name = '" + viewName + "']");
                XmlElement viewElement = (XmlElement)viewNode;

                return new View(project, viewElement);















            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve view", ex);
            }
        }





        public virtual DataTable GetPgms()
        {
            try
            {
                Query query = db.CreateQuery("select [ProgramId], [Name], [Content], [Comment], [DateCreated], [DateModified], [Author] " +
                    "from [metaPrograms]");
                return db.Select(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve programs", ex);
            }
        }






        public List GetViewsOfDataTable(string dataTableName)
        {
            string queryString = "select distinct (v.Name) from metaFields F inner join metaViews V on F.ViewId = V.ViewId where F.DataTableName = @dataTableName";
            Query query = db.CreateQuery(queryString);
            query.Parameters.Add(new QueryParameter("@dataTableName", DbType.String, dataTableName));
            DataTable dt = db.Select(query);

            List viewNames = new List();
            foreach (DataRow dr in dt.Rows)
            {
                viewNames.Add(dr["Name"].ToString());
            }

            return viewNames;
        }





        public DataTable GetDataDictionary(View view)
        {
            DataTable table = null;
            Query query = db.CreateQuery("select [PageId], [PromptText], [Name] " +
                "from [metaFields] " +
                "where [ViewId]=@ViewId");
            query.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, view.Id));
            table = db.Select(query);
            return table;
        }





        public List GetDataTableList()
        {
            try
            {
                List tables = new List();
                Query query = db.CreateQuery("select distinct [DataTableName] as Name, [ViewId] " +
                    "from [metaFields] where [DataTableName] is not null ");
                DataTable table = db.Select(query);
                foreach (DataRow row in table.Rows)
                {
                    tables.Add(row["Name"].ToString());
                }
                return tables;
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve DataTableName", ex);
            }
        }






        public string GetDataTableName(int viewId)
        {
            //Input Validation
            if (viewId <= 0)
            {
                throw new ArgumentException(SharedStrings.INVALID_VIEW_ID + ": \n" + viewId.ToString());
            }
            //Input Validation

            try
            {
                Query query = db.CreateQuery("select distinct [DataTableName] from [metaFields] where [ViewId] = @viewId and [DataTableName] is not null and [DataTableName]    '' ");
                query.Parameters.Add(new QueryParameter("@viewId", DbType.Int32, viewId));
                DataTable results = db.Select(query);
                if (results.Rows.Count > 0)
                {
                    if (results.Rows.Count > 1)
                    {
                        throw new GeneralException("More than one datatable found for view");
                    }
                    else
                    {
                        return results.Rows[0][ColumnNames.DATA_TABLE_NAME].ToString();
                    }
                }
                else
                {
                    return string.Empty;
                }
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve data table name", ex);
            }
        }






        public DataTable GetDataTableNames(int viewId)
        {
            return null;
        }






        public string GetTableColumnNames(int viewId)
        {
            try
            {
                Query selectQuery = db.CreateQuery("select [Name] from [metaFields] " +
                    "where [ViewId] = @ViewID and " +
                    "[FieldTypeId] not in (2,13,15,20) " +
                    "order by [Name]");
                selectQuery.Parameters.Add(new QueryParameter("@ViewID", DbType.Int32, viewId));
                WordBuilder list = new WordBuilder();
                list.Delimitter = StringLiterals.COMMA;
                DataTable columns = db.Select(selectQuery);
                foreach (DataRow row in columns.Rows)
                {
                    list.Add(row[ColumnNames.NAME].ToString());
                }
                return list.ToString();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve table column names", ex);
            }

        }

        /*




        public DataRow[] GetCodeTableList()
        {
            try
            {

                DataTable tables = db.GetTableSchema();

                return tables.Select("TABLE_NAME like 'code%'");
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not retrieve code tables from database", ex);
            }
        }
        */
        //Select Statement

        //Insert Statements







        public Page CreatePage(View view, string name, int position)
        {
            Page page;
            XmlDocument xmlDoc = GetXmlDocument();
            XmlNode pagesNode = GetPagesNode(view.ViewElement);
            XmlElement pageElement = xmlDoc.CreateElement("Page");
            XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");

            int currentPageId = 0;
            pageId.Value = currentPageId.ToString();
            pageElement.Attributes.Append(pageId);
            XmlAttribute pageName = xmlDoc.CreateAttribute("Name");
            pageName.Value = name;
            pageElement.Attributes.Append(pageName);
            XmlAttribute pagePosition = xmlDoc.CreateAttribute("Position");
            pagePosition.Value = position.ToString();
            pageElement.Attributes.Append(pagePosition);

            page = new Page(view, Int32.Parse(pageId.Value));
            page.Id = Int32.Parse(pageId.Value);
            page.Name = pageName.Value;
            page.Position = Int32.Parse(pagePosition.Value);

            XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
            XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
            checkCodeBefore.Value = page.CheckCodeBefore.ToString();
            checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
            pageElement.AppendChild(checkCodeBeforeElement);

            XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
            XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
            checkCodeAfter.Value = page.CheckCodeAfter.ToString();
            checkCodeAfterElement.Attributes.Append(checkCodeAfter);
            pageElement.AppendChild(checkCodeAfterElement);

            pagesNode.AppendChild(pageElement);
            Save();
            return page;
        }





        public void InsertView(View view)
        {
            XmlDocument xmlDoc = GetXmlDocument();
            XmlNode viewsNode = GetViewsNode();
            XmlElement viewElement = xmlDoc.CreateElement("View");
            viewsNode.AppendChild(viewElement);
            view.ViewElement = viewElement;
            XmlAttribute viewId = xmlDoc.CreateAttribute("ViewId");
            viewId.Value = GetMaxViewId().ToString();
            view.Id = Int32.Parse(viewId.Value);
            viewElement.Attributes.Append(viewId);
            XmlAttribute viewNameAttribute = xmlDoc.CreateAttribute("Name");
            viewNameAttribute.Value = view.Name;
            viewElement.Attributes.Append(viewNameAttribute);
            XmlAttribute isRelatedView = xmlDoc.CreateAttribute("IsRelatedView");
            isRelatedView.Value = view.IsRelatedView.ToString();
            viewElement.Attributes.Append(isRelatedView);
            viewElement.AppendChild(xmlDoc.CreateElement("CheckCodeBefore"));
            viewElement.AppendChild(xmlDoc.CreateElement("CheckCodeAfter"));
            viewElement.AppendChild(xmlDoc.CreateElement("RecordCheckCodeBefore"));
            viewElement.AppendChild(xmlDoc.CreateElement("RecordCheckCodeAfter"));
            viewElement.AppendChild(xmlDoc.CreateElement("CheckCodeVariableDefinitions"));
            viewElement.AppendChild(xmlDoc.CreateElement("Pages"));
            viewElement.AppendChild(xmlDoc.CreateElement("Fields"));


            RecStatusField recStatusField = new RecStatusField(view, viewElement);
            UniqueKeyField uniqueKeyField = new UniqueKeyField(view, viewElement);
            recStatusField.SaveToDb();
            uniqueKeyField.SaveToDb();
            if (view.IsRelatedView)
            {
                ForeignKeyField foreignKeyField = new ForeignKeyField(view, viewElement);
                foreignKeyField.SaveToDb();
            }
            Save();


        }







        public void InsertPage(Page page)
        {
            try
            {
                //Input Validation
                if (page == null)
                {
                    throw new ArgumentNullException("page");
                }
                //Input validation

                XmlDocument doc = GetXmlDocument();
                XmlNode pagesNode = GetPagesNode(page.GetView().ViewElement);

                CreatePage(page.GetView(), page.Name, page.Position);
                XmlNode pageNode = pagesNode.SelectSingleNode("//Page[@PageId= '" + page.Id + "']");

                page.Id = GetMaxPageId(page.GetView().Id) + 1;
                pageNode.Attributes["PageId"].Value = page.Id.ToString();
                Save();










            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create page in the database", ex);
            }
            finally
            {

            }
        }

        public Int32 InsertMetaImage(byte[] imageAsBytes)
        {
            Query insertQuery = db.CreateQuery
            (
                "insert into [metaImages] ([Image],[ImageUniqueValue]) " +
                "VALUES (@Image,@ImageUniqueValue)"
            );

            Data.QueryParameter imageParam = new QueryParameter("@Image", DbType.Object, imageAsBytes);
            imageParam.Size = imageAsBytes.Length + 1;
            insertQuery.Parameters.Add(imageParam);
            insertQuery.Parameters.Add(new QueryParameter("@ImageUniqueValue", DbType.Int32, imageAsBytes.Length));
            db.ExecuteNonQuery(insertQuery);
            return GetMaxImageId();
        }

        public Int32 InsertMetaImage(string imagePath)
        {
            int imageId = -1;
            return imageId;
        }






        public int CreateField(UniqueKeyField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("UniqueKeyField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldViewId = xmlDoc.CreateAttribute("ViewId");
                fieldViewId.Value = view.Id.ToString();
                fieldElement.Attributes.Append(fieldViewId);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }







        public int CreateField(UniqueIdentifierField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("UniqueKeyField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldViewId = xmlDoc.CreateAttribute("ViewId");
                fieldViewId.Value = view.Id.ToString();
                fieldElement.Attributes.Append(fieldViewId);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(GlobalRecordIdField field)
        {
            throw new System.ApplicationException("Not implemented");
        }






        public int CreateField(ForeignKeyField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("ForeignKeyField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldViewId = xmlDoc.CreateAttribute("ViewId");
                fieldViewId.Value = view.Id.ToString();
                fieldElement.Attributes.Append(fieldViewId);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(RecStatusField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("RecStatusField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldViewId = xmlDoc.CreateAttribute("ViewId");
                fieldViewId.Value = view.Id.ToString();
                fieldElement.Attributes.Append(fieldViewId);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(CheckBoxField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("CheckBoxField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);







                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }

        /*





        public int CreateField(CodeField field)
        {
            try
            {
        //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("CodeField");
                }
        //

                DbQuery insertQuery = db.CreateQuery("insert into metaFields([ControlFontFamily], [ControlFontStyle], [ControlFontSize], [ControlHeight], [ControlLeftPosition], [ControlTopPosition], [ControlWidth], [HasTabStop], [Name], [PageId], [PromptFontFamily], [PromptFontStyle], [PromptFontSize], [PromptLeftPosition], [PromptText], [PromptTopPosition], [TabIndex]) " +
                    "values (@ControlFontFamily, @ControlFontStyle, @ControlFontSize, @ControlHeight, @ControlLeftPosition, @ControlTopPosition, @ControlWidth, @HasTabStop, @Name, @PageId, @PromptFontFamily, @PromptFontStyle, @PromptFontSize, @PromptLeftPosition, @PromptText, @PromptTopPosition, @TabIndex)");

                insertQuery.Parameters.Add(new DbParameter("@ControlFontFamily", DbType.String, field.ControlFont.Name));
                insertQuery.Parameters.Add(new DbParameter("@ControlFontStyle", DbType.String, field.ControlFont.Style.ToString()));
                insertQuery.Parameters.Add(new DbParameter("@ControlFontSize", DbType.Double, field.ControlFont.Size));
                insertQuery.Parameters.Add(new DbParameter("@ControlHeight", DbType.Double, field.ControlHeightPercentage));
                insertQuery.Parameters.Add(new DbParameter("@ControlLeftPosition", DbType.Double, field.ControlLeftPositionPercentage));
                insertQuery.Parameters.Add(new DbParameter("@ControlTopPosition", DbType.Double, field.ControlTopPositionPercentage));
                insertQuery.Parameters.Add(new DbParameter("@ControlWidth", DbType.Double, field.ControlWidthPercentage));
                insertQuery.Parameters.Add(new DbParameter("@HasTabStop", DbType.Boolean, field.HasTabStop));
                insertQuery.Parameters.Add(new DbParameter("@Name", DbType.String, field.Name));
                insertQuery.Parameters.Add(new DbParameter("@PageId", DbType.Int32, field.Page.Id));
                insertQuery.Parameters.Add(new DbParameter("@PromptFontFamily", DbType.String, field.PromptFont.Name));
                insertQuery.Parameters.Add(new DbParameter("@PromptFontStyle", DbType.String, field.PromptFont.Style.ToString()));
                insertQuery.Parameters.Add(new DbParameter("@PromptFontSize", DbType.Double, field.PromptFont.Size));
                insertQuery.Parameters.Add(new DbParameter("@PromptLeftPosition", DbType.Double, field.PromptLeftPositionPercentage));
                insertQuery.Parameters.Add(new DbParameter("@PromptText", DbType.String, field.PromptText));
                insertQuery.Parameters.Add(new DbParameter("@PromptTopPosition", DbType.Double, field.PromptTopPositionPercentage));
                insertQuery.Parameters.Add(new DbParameter("@TabIndex", DbType.Int32, field.TabIndex));

                DbQuery selectQuery = db.CreateQuery("select MAX(FieldId) from metaFields where PageId = @PageId");
                selectQuery.Parameters.Add(new DbParameter("@PageId", DbType.Int32, field.Page.Id));


                db.ExecuteNonQuery(insertQuery);


                DataTable result = db.Select(selectQuery);
                return (int)result.Rows[0][0];
            }




            finally
            {

            }
        }
        */
        /*





                public int CreateField(Field field)
                {
                    if (field is CommandButtonField)
                    {
                        return CreateField((CommandButtonField)field);
                    }
                    else if (field is DateField)
                    {
                        return CreateField((DateField)field);
                    }
                    else if (field is DateTimeField)
                    {
                        return CreateField((DateTimeField)field);
                    }
                    else if (field is DDLFieldOfCodes)
                    {
                        return CreateField((DDLFieldOfCodes)field);
                    }
                    else if (field is DDLFieldOfCommentLegal)
                    {
                        return CreateField((DDLFieldOfCommentLegal)field);
                    }
                    else if (field is DDLFieldOfLegalValues)
                    {
                        return CreateField((DDLFieldOfLegalValues)field);
                    }
                    else if (field is GridField)
                    {
                        return CreateField((GridField)field);
                    }
                    else if (field is ImageField)
                    {
                        return CreateField((ImageField)field);
                    }
                    else if (field is LabelField)
                    {
                        return CreateField((LabelField)field);
                    }
                    else if (field is MirrorField)
                    {
                        return CreateField((MirrorField)field);
                    }
                    else if (field is MultilineTextField)
                    {
                        return CreateField((MultilineTextField)field);
                    }
                    else if (field is NumberField)
                    {
                        return CreateField((NumberField)field);
                    }
                    else if (field is OptionField)
                    {
                        return CreateField((OptionField)field);
                    }
                    else if (field is PhoneNumberField)
                    {
                        return CreateField((PhoneNumberField)field);
                    }
                    else if (field is RelatedViewField)
                    {
                        return CreateField((RelatedViewField)field);
                    }
                    else if (field is SingleLineTextField)
                    {
                        return CreateField((SingleLineTextField)field);
                    }
                    else if (field is TimeField)
                    {
                        return CreateField((TimeField)field);
                    }
                    else if (field is UpperCaseTextField)
                    {
                        return CreateField((UpperCaseTextField)field);
                    }
                    else if (field is YesNoField)
                    {
                        return CreateField((YesNoField)field);
                    }
                    else
                        return 0;
                }
        */






        public int CreateField(CommandButtonField field)
        {
            try
            {
                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);





                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);
                fieldsNode.AppendChild(fieldElement);

                view.Project.Save();
                return field.Id;

            }
            finally
            {
            }
        }






        public int CreateField(DateField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DateField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute lower = xmlDoc.CreateAttribute("Lower");
                lower.Value = field.Lower.ToString();
                fieldElement.Attributes.Append(lower);

                XmlAttribute upper = xmlDoc.CreateAttribute("Upper");
                upper.Value = field.Upper.ToString();
                fieldElement.Attributes.Append(upper);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(DateTimeField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DateTimeField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = (bool.Parse(field.ShouldRepeatLast.ToString()).ToString());
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(DDLFieldOfCodes field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDLFieldOfCodes");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute sourceTableName = xmlDoc.CreateAttribute("SourceTableName");

                fieldElement.Attributes.Append(sourceTableName);

                XmlAttribute codeColumnName = xmlDoc.CreateAttribute("CodeColumnName");

                fieldElement.Attributes.Append(codeColumnName);

                XmlAttribute textColumnName = xmlDoc.CreateAttribute("TextColumnName");

                fieldElement.Attributes.Append(textColumnName);

                XmlAttribute sort = xmlDoc.CreateAttribute("Sort");

                fieldElement.Attributes.Append(sort);

                XmlAttribute isExclusiveTable = xmlDoc.CreateAttribute("IsExclusiveTable");

                fieldElement.Attributes.Append(isExclusiveTable);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {

            }
        }







        public int CreateField(DDListField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDListField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute sourceTableName = xmlDoc.CreateAttribute("SourceTableName");

                fieldElement.Attributes.Append(sourceTableName);

                XmlAttribute codeColumnName = xmlDoc.CreateAttribute("CodeColumnName");

                fieldElement.Attributes.Append(codeColumnName);

                XmlAttribute textColumnName = xmlDoc.CreateAttribute("TextColumnName");

                fieldElement.Attributes.Append(textColumnName);

                XmlAttribute sort = xmlDoc.CreateAttribute("Sort");

                fieldElement.Attributes.Append(sort);

                XmlAttribute isExclusiveTable = xmlDoc.CreateAttribute("IsExclusiveTable");

                fieldElement.Attributes.Append(isExclusiveTable);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {

            }
        }






        public int CreateField(DDLFieldOfCommentLegal field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDLFieldOfCommentLegal");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute sourceTableName = xmlDoc.CreateAttribute("SourceTableName");

                fieldElement.Attributes.Append(sourceTableName);

                XmlAttribute codeColumnName = xmlDoc.CreateAttribute("CodeColumnName");

                fieldElement.Attributes.Append(codeColumnName);

                XmlAttribute textColumnName = xmlDoc.CreateAttribute("TextColumnName");

                fieldElement.Attributes.Append(textColumnName);

                XmlAttribute sort = xmlDoc.CreateAttribute("Sort");

                fieldElement.Attributes.Append(sort);

                XmlAttribute isExclusiveTable = xmlDoc.CreateAttribute("IsExclusiveTable");

                fieldElement.Attributes.Append(isExclusiveTable);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(DDLFieldOfLegalValues field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDLFieldOfLegalValues");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute sourceTableName = xmlDoc.CreateAttribute("SourceTableName");
                sourceTableName.Value = field.SourceTableName.ToString();
                fieldElement.Attributes.Append(sourceTableName);

                XmlAttribute codeColumnName = xmlDoc.CreateAttribute("CodeColumnName");
                codeColumnName.Value = field.CodeColumnName.ToString();
                fieldElement.Attributes.Append(codeColumnName);

                XmlAttribute textColumnName = xmlDoc.CreateAttribute("TextColumnName");
                textColumnName.Value = field.TextColumnName.ToString();
                fieldElement.Attributes.Append(textColumnName);

                XmlAttribute sort = xmlDoc.CreateAttribute("Sort");
                sort.Value = (bool.Parse(field.ShouldSort.ToString())).ToString();
                fieldElement.Attributes.Append(sort);

                XmlAttribute isExclusiveTable = xmlDoc.CreateAttribute("IsExclusiveTable");
                isExclusiveTable.Value = (bool.Parse(field.IsExclusiveTable.ToString())).ToString();
                fieldElement.Attributes.Append(isExclusiveTable);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {

            }
        }






        public int CreateField(GridField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("GridField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);
                fieldsNode.AppendChild(fieldElement);


                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }





        public int CreateField(GroupField field)
        {
            try
            {
                return field.Id;
            }
            finally
            {

            }
        }







        public int CreateField(GUIDField field)
        {
            try
            {
                //InputValidation

                if (field == null)
                {
                    throw new ArgumentNullException("GUIDField");
                }

                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");

                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");
                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute maxLength = xmlDoc.CreateAttribute("MaxLength");
                maxLength.Value = field.MaxLength.ToString();
                fieldElement.Attributes.Append(maxLength);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute sourceFieldId = xmlDoc.CreateAttribute("SourceFieldId");
                sourceFieldId.Value = field.SourceFieldId.ToString();
                fieldElement.Attributes.Append(sourceFieldId);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();

                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(ImageField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("ImageField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);
                fieldsNode.AppendChild(fieldElement);

                view.Project.Save();
                return field.Id;
            }
            finally
            {

            }
        }






        public int CreateField(LabelField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("LabelField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontName = xmlDoc.CreateAttribute("ControlScriptName");
                fieldControlFontName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(fieldControlFontName);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);
                fieldsNode.AppendChild(fieldElement);

                view.Project.Save();
                return field.Id;
            }
            finally
            {

            }
        }






        public int CreateField(MirrorField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("MirrorField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute sourceFieldId = xmlDoc.CreateAttribute("SourceFieldId");
                sourceFieldId.Value = field.SourceFieldId.ToString();
                fieldElement.Attributes.Append(sourceFieldId);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {

            }
        }






        public int CreateField(MultilineTextField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("MultilineTextField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute maxLength = xmlDoc.CreateAttribute("MaxLength");
                maxLength.Value = field.MaxLength.ToString();
                fieldElement.Attributes.Append(maxLength);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute sourceFieldId = xmlDoc.CreateAttribute("SourceFieldId");
                sourceFieldId.Value = field.SourceFieldId.ToString();
                fieldElement.Attributes.Append(sourceFieldId);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(NumberField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("NumberField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute lower = xmlDoc.CreateAttribute("Lower");
                lower.Value = field.Lower.ToString();
                fieldElement.Attributes.Append(lower);

                XmlAttribute upper = xmlDoc.CreateAttribute("Upper");
                upper.Value = field.Upper.ToString();
                fieldElement.Attributes.Append(upper);

                XmlAttribute pattern = xmlDoc.CreateAttribute("Pattern");
                pattern.Value = field.Pattern.ToString();
                fieldElement.Attributes.Append(pattern);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(OptionField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("OptionField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute showTextOnRight = xmlDoc.CreateAttribute("ShowTextOnRight");
                showTextOnRight.Value = (bool.Parse(field.ShowTextOnRight.ToString())).ToString();
                fieldElement.Attributes.Append(showTextOnRight);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;


            }
            finally
            {
            }
        }






        public int CreateField(PhoneNumberField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("PhoneNumberField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute pattern = xmlDoc.CreateAttribute("Pattern");
                pattern.Value = field.Pattern.ToString();
                fieldElement.Attributes.Append(pattern);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(RelatedViewField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("RelatedViewField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute relateCondition = xmlDoc.CreateAttribute("RelateCondition");
                relateCondition.Value = field.Condition.ToString();
                fieldElement.Attributes.Append(relateCondition);

                XmlAttribute shouldReturnToParent = xmlDoc.CreateAttribute("ShouldReturnToParent");
                shouldReturnToParent.Value = (bool.Parse(field.ShouldReturnToParent.ToString())).ToString();
                fieldElement.Attributes.Append(shouldReturnToParent);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute relatedViewId = xmlDoc.CreateAttribute("RelatedViewId");
                relatedViewId.Value = field.RelatedViewID.ToString();
                fieldElement.Attributes.Append(relatedViewId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(SingleLineTextField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("SingleLineTextField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");

                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute maxLength = xmlDoc.CreateAttribute("MaxLength");
                maxLength.Value = field.MaxLength.ToString();
                fieldElement.Attributes.Append(maxLength);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute sourceFieldId = xmlDoc.CreateAttribute("SourceFieldId");
                sourceFieldId.Value = field.SourceFieldId.ToString();
                fieldElement.Attributes.Append(sourceFieldId);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();

                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(TimeField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("TimeField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                XmlElement checkCodeBeforeElement = xmlDoc.CreateElement("CheckCodeBefore");
                XmlAttribute checkCodeBefore = xmlDoc.CreateAttribute("CheckCodeBefore");
                checkCodeBefore.Value = field.CheckCodeBefore.ToString();
                checkCodeBeforeElement.Attributes.Append(checkCodeBefore);
                fieldElement.AppendChild(checkCodeBeforeElement);

                XmlElement checkCodeAfterElement = xmlDoc.CreateElement("CheckCodeAfter");
                XmlAttribute checkCodeAfter = xmlDoc.CreateAttribute("CheckCodeAfter");
                checkCodeAfter.Value = field.CheckCodeAfter.ToString();
                checkCodeAfterElement.Attributes.Append(checkCodeAfter);
                fieldElement.AppendChild(checkCodeAfterElement);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateField(UpperCaseTextField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("UpperCaseTextField");
                }
                //

                return field.Id;
            }
            finally
            {

            }
        }






        public int CreateField(YesNoField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("YesNoField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.ViewElement);
                View view = field.GetView();
                XmlElement fieldElement = xmlDoc.CreateElement("Field");

                XmlAttribute fieldIdAttribute = xmlDoc.CreateAttribute("FieldId");
                fieldIdAttribute.Value = view.GetFieldId(field.ViewElement).ToString();
                fieldElement.Attributes.Append(fieldIdAttribute);
                field.Id = Int32.Parse(fieldIdAttribute.Value);

                XmlAttribute fieldNameAttribute = xmlDoc.CreateAttribute("Name");
                fieldNameAttribute.Value = field.Name;
                fieldElement.Attributes.Append(fieldNameAttribute);

                XmlAttribute fieldPromptText = xmlDoc.CreateAttribute("PromptText");
                fieldPromptText.Value = field.PromptText;
                fieldElement.Attributes.Append(fieldPromptText);

                XmlAttribute fieldControlFontFamily = xmlDoc.CreateAttribute("ControlFontFamily");
                fieldControlFontFamily.Value = field.ControlFont.FontFamily.Name;
                fieldElement.Attributes.Append(fieldControlFontFamily);

                XmlAttribute controlFontStyle = xmlDoc.CreateAttribute("ControlFontStyle");
                controlFontStyle.Value = field.ControlFont.Style.ToString();
                fieldElement.Attributes.Append(controlFontStyle);

                XmlAttribute controlFontSize = xmlDoc.CreateAttribute("ControlFontSize");
                controlFontSize.Value = field.ControlFont.Size.ToString();
                fieldElement.Attributes.Append(controlFontSize);

                XmlAttribute controlTopPositionPercentage = xmlDoc.CreateAttribute("ControlTopPositionPercentage");
                controlTopPositionPercentage.Value = field.ControlTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlTopPositionPercentage);

                XmlAttribute controlLeftPositionPercentage = xmlDoc.CreateAttribute("ControlLeftPositionPercentage");
                controlLeftPositionPercentage.Value = field.ControlLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(controlLeftPositionPercentage);

                XmlAttribute controlHeightPercentage = xmlDoc.CreateAttribute("ControlHeightPercentage");
                controlHeightPercentage.Value = field.ControlHeightPercentage.ToString();
                fieldElement.Attributes.Append(controlHeightPercentage);

                XmlAttribute controlWidthPercentage = xmlDoc.CreateAttribute("ControlWidthPercentage");
                controlWidthPercentage.Value = field.ControlWidthPercentage.ToString();
                fieldElement.Attributes.Append(controlWidthPercentage);

                XmlAttribute tabIndex = xmlDoc.CreateAttribute("TabIndex");
                tabIndex.Value = field.TabIndex.ToString();
                fieldElement.Attributes.Append(tabIndex);

                XmlAttribute hasTabStop = xmlDoc.CreateAttribute("HasTabStop");
                hasTabStop.Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldElement.Attributes.Append(hasTabStop);

                XmlAttribute promptFontFamily = xmlDoc.CreateAttribute("PromptFontFamily");
                promptFontFamily.Value = field.PromptFont.FontFamily.Name;
                fieldElement.Attributes.Append(promptFontFamily);

                XmlAttribute promptFontStyle = xmlDoc.CreateAttribute("PromptFontStyle");
                promptFontStyle.Value = field.PromptFont.Style.ToString();
                fieldElement.Attributes.Append(promptFontStyle);

                XmlAttribute promptFontSize = xmlDoc.CreateAttribute("PromptFontSize");
                promptFontSize.Value = field.PromptFont.Size.ToString();
                fieldElement.Attributes.Append(promptFontSize);

                XmlAttribute promptScriptName = xmlDoc.CreateAttribute("PromptScriptName");
                promptScriptName.Value = field.PromptFont.Name;
                fieldElement.Attributes.Append(promptScriptName);

                XmlAttribute promptTopPositionPercentage = xmlDoc.CreateAttribute("PromptTopPositionPercentage");
                promptTopPositionPercentage.Value = field.PromptTopPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptTopPositionPercentage);

                XmlAttribute promptLeftPositionPercentage = xmlDoc.CreateAttribute("PromptLeftPositionPercentage");
                promptLeftPositionPercentage.Value = field.PromptLeftPositionPercentage.ToString();
                fieldElement.Attributes.Append(promptLeftPositionPercentage);

                XmlAttribute controlScriptName = xmlDoc.CreateAttribute("ControlScriptName");
                controlScriptName.Value = field.ControlFont.Name;
                fieldElement.Attributes.Append(controlScriptName);

                XmlAttribute shouldRepeatLast = xmlDoc.CreateAttribute("ShouldRepeatLast");
                shouldRepeatLast.Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldElement.Attributes.Append(shouldRepeatLast);

                XmlAttribute isRequired = xmlDoc.CreateAttribute("IsRequired");
                isRequired.Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldElement.Attributes.Append(isRequired);

                XmlAttribute isReadOnly = xmlDoc.CreateAttribute("IsReadOnly");
                isReadOnly.Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldElement.Attributes.Append(isReadOnly);

                XmlAttribute shouldRetainImageSize = xmlDoc.CreateAttribute("ShouldRetainImageSize");

                fieldElement.Attributes.Append(shouldRetainImageSize);

                XmlAttribute dataTableName = xmlDoc.CreateAttribute("DataTableName");
                dataTableName.Value = field.TableName;
                fieldElement.Attributes.Append(dataTableName);

                XmlAttribute fieldTypeId = xmlDoc.CreateAttribute("FieldTypeId");
                fieldTypeId.Value = field.FieldType.ToString();
                fieldElement.Attributes.Append(fieldTypeId);

                XmlAttribute pageId = xmlDoc.CreateAttribute("PageId");
                pageId.Value = field.Page.Id.ToString();
                fieldElement.Attributes.Append(pageId);

                fieldsNode.AppendChild(fieldElement);
                view.Project.Save();
                return field.Id;
            }
            finally
            {
            }
        }






        public int CreateGridColumn(GlobalRecordIdColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("GlobalRecordIdColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [FieldTypeId]) " +
                    "values (@Name, @FieldTypeId,)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create GlobalRecordIdColumn grid column in the database.", ex);
            }
            finally
            {
            }
        }






        public int CreateGridColumn(UniqueRowIdColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("UniqueRowIdColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [FieldTypeId]) " +
                    "values (@Name, @FieldTypeId,)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create UniqueRowIdColumn grid column in the database.", ex);
            }
            finally
            {
            }
        }






        public int CreateGridColumn(UniqueKeyColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("UniqueKeyColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [FieldTypeId]) " +
                    "values (@Name, @FieldTypeId,)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create UniqueKey grid column in the database.", ex);
            }
            finally
            {
            }
        }






        public int CreateGridColumn(RecStatusColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("RecStatusColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([DataTableName], [ViewId], [FieldTypeId], [Name]) " +
                    "values (@Name, @FieldTypeId,)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));


                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create RecStatus grid column in the database.", ex);
            }
            finally
            {

            }
        }






        public int CreateGridColumn(ForeignKeyColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("ForeignKeyColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [FieldTypeId]) " +
                    "values (@Name, @FieldTypeId,)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create ForeignKey grid column in the database.", ex);
            }
            finally
            {
            }
        }






        public int CreateGridColumn(NumberColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("NumberColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [Width], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsRequired], [IsReadOnly], [Pattern], [Upper], [Lower], [FieldId]) " +
                    "values (@Name, @Width, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsRequired, @IsReadOnly, @Pattern, @Upper, @Lower, @FieldId)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                if (column.Pattern == null)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, DBNull.Value));
                }
                else
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, column.Pattern));
                }
                if (column.Upper == null)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, DBNull.Value));
                }
                else
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, column.Upper));
                }
                if (column.Lower == null)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, DBNull.Value));
                }
                else
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, column.Lower));
                }
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));


                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid Number column in the database.", ex);
            }
            finally
            {

            }
        }






        public int CreateGridColumn(ContiguousColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("DateColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [Width], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsRequired], [IsReadOnly], [Pattern], [Upper], [Lower], [FieldId]) " +
                    "values (@Name, @Width, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsRequired, @IsReadOnly, @Pattern, @Upper, @Lower, @FieldId)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                if (column.Pattern == null)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, DBNull.Value));
                }
                else
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, column.Pattern));
                }
                if (column.Upper == null)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, DBNull.Value));
                }
                else
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, column.Upper));
                }
                if (column.Lower == null)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, DBNull.Value));
                }
                else
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, column.Lower));
                }
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));


                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid Date column in the database.", ex);
            }
            finally
            {

            }
        }






        public int CreateGridColumn(PhoneNumberColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("PhoneNumberColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [Width], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsRequired], [IsReadOnly], [Pattern], [FieldId]) " +
                    "values (@Name, @Width, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsRequired, @IsReadOnly, @Pattern, @FieldId)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                if (column.Pattern == null)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, DBNull.Value));
                }
                else
                {
                    insertQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, column.Pattern));
                }
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));


                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid PhoneNumber column in the database.", ex);
            }
            finally
            {

            }
        }






        public int CreateGridColumn(TextColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("TextColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [Width], [Size], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsRequired], [IsReadOnly], [FieldId]) " +
                    "values (@Name, @Width, @Size, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsRequired, @IsReadOnly, @FieldId)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Size", DbType.Int32, column.Size));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));


                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid Text column in the database.", ex);
            }
            finally
            {

            }
        }






        public int CreateGridColumn(CheckboxColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("CheckboxColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [Width], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsRequired], [IsReadOnly], [FieldId]) " +
                    "values (@Name, @Width, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsRequired, @IsReadOnly, @FieldId)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid Text column in the database.", ex);
            }
            finally
            {

            }
        }







        public int CreateGridColumn(YesNoColumn column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("YesNoColumn");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [Width], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsRequired], [IsReadOnly], [FieldId]) " +
                    "values (@Name, @Width, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsRequired, @IsReadOnly, @FieldId)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid Text column in the database.", ex);
            }
            finally
            {

            }
        }






        public int CreateGridColumn(DDLColumnOfCommentLegal column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("DDLColumnOfCommentLegal");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [TextColumnName], [SourceTableName], [Width], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsExclusiveTable], [IsReadOnly], [IsRequired], [FieldId], [Sort]) " +
                    "values (@Name, @TextColumnName, @SourceTableName, @Width, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsExclusiveTable, @IsReadOnly, @IsRequired, @FieldId, @Sort)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@TextColumnName", DbType.String, column.TextColumnName));
                insertQuery.Parameters.Add(new QueryParameter("@SourceTableName", DbType.String, column.SourceTableName));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsExclusiveTable", DbType.Boolean, column.IsExclusiveTable));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));
                insertQuery.Parameters.Add(new QueryParameter("@Sort", DbType.Boolean, column.ShouldSort));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid CommentLegal column in the database.", ex);
            }

        }






        public int CreateGridColumn(DDLColumnOfLegalValues column)
        {
            try
            {
                //InputValidation
                if (column == null)
                {
                    throw new ArgumentNullException("DDLColumnOfLegalValues");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaGridColumns([Name], [TextColumnName], [SourceTableName], [Width], [Position], [FieldTypeId], [Text], [ShouldRepeatLast], [IsExclusiveTable], [IsReadOnly], [IsRequired], [FieldId], [Sort]) " +
                    "values (@Name, @TextColumnName, @SourceTableName, @Width, @Position, @FieldTypeId, @Text, @ShouldRepeatLast, @IsExclusiveTable, @IsReadOnly, @IsRequired, @FieldId, @Sort)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                insertQuery.Parameters.Add(new QueryParameter("@TextColumnName", DbType.String, column.TextColumnName));
                insertQuery.Parameters.Add(new QueryParameter("@SourceTableName", DbType.String, column.SourceTableName));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                insertQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                insertQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                insertQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsExclusiveTable", DbType.Boolean, column.IsExclusiveTable));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, column.Grid.Id));
                insertQuery.Parameters.Add(new QueryParameter("@Sort", DbType.Boolean, column.ShouldSort));

                db.ExecuteNonQuery(insertQuery);
                return GetMaxGridColumnId(column.Grid.Id);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create grid LegalValues column in the database.", ex);
            }
            finally
            {

            }
        }










        public void CreateLabel(int fieldId, string labelText, double topPosition, double leftPosition, string font, decimal fontSize)
        {
            try
            {
                //Input Validation
                if (string.IsNullOrEmpty(labelText))
                {
                    throw new ArgumentNullException("LabelText");
                }
                if (string.IsNullOrEmpty(font))
                {
                    throw new ArgumentNullException("Font");
                }
                if (fieldId < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                if (topPosition < 0)
                {
                    throw new ArgumentOutOfRangeException("TopPosition");
                }
                if (leftPosition < 0)
                {
                    throw new ArgumentOutOfRangeException("LeftPosition");
                }
                if (fontSize <= 0)
                {
                    throw new ArgumentOutOfRangeException("FontSize");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaFields([FieldId], [PromptText], [PromptTopPositionPercentage], " +
                    "[PromptLeftPositionPercentage], [PromptFontFamily], [PromptFontSize]) values (@FieldId, @Text, @TopPosition, @LeftPosition, @FontStyleId, @FontFamily, @FontSize)");

                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, fieldId));
                insertQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, labelText));
                insertQuery.Parameters.Add(new QueryParameter("@TopPosition", DbType.Double, topPosition));
                insertQuery.Parameters.Add(new QueryParameter("@LeftPosition", DbType.Double, leftPosition));
                insertQuery.Parameters.Add(new QueryParameter("@FontFamily", DbType.String, font));
                insertQuery.Parameters.Add(new QueryParameter("@FontSize", DbType.Decimal, fontSize));


                db.ExecuteNonQuery(insertQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create label in the database", ex);
            }
        }















        public int CreateControl(int fieldId, double topPosition, double leftPosition, double height, double width, bool isRepeatLast, bool isRequired, bool isReadOnly, bool isRetainImgSize, int tabOrder)
        {
            try
            {
                //Input Validation
                if (fieldId < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                if (topPosition < 0)
                {
                    throw new ArgumentOutOfRangeException("TopPosition");
                }
                if (leftPosition < 0)
                {
                    throw new ArgumentOutOfRangeException("LeftPosition");
                }
                if (height < 0)
                {
                    throw new ArgumentOutOfRangeException("Height");
                }
                if (width < 0)
                {
                    throw new ArgumentOutOfRangeException("Width");
                }
                if (tabOrder < 0)
                {
                    throw new ArgumentOutOfRangeException("TabOrder");
                }
                //

                Query insertQuery = db.CreateQuery("insert into metaFields([FieldId], [ControlTopPositionPercentage], [ControlLeftPositionPercentage], " +
                    "[ControlHeightPercentage], [ControlWidthPercentage], [ShouldRepeatLast], [IsRequired], [IsReadOnly], [ShouldRetainImageSize], " +
                    "[TabIndex], [HasTabStop]) values (@FieldId, @TopPosition, @LeftPosition, @Height, @Width, @IsRepeatLast, @IsRequired, @IsReadOnly, @IsRetainImgSize, @TabOrder, @IsTabStop)");


                insertQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, fieldId));
                insertQuery.Parameters.Add(new QueryParameter("@TopPosition", DbType.Double, topPosition));
                insertQuery.Parameters.Add(new QueryParameter("@LeftPosition", DbType.Double, leftPosition));
                insertQuery.Parameters.Add(new QueryParameter("@Height", DbType.Double, height));
                insertQuery.Parameters.Add(new QueryParameter("@Width", DbType.Double, width));
                insertQuery.Parameters.Add(new QueryParameter("@IsRepeatLast", DbType.Boolean, isRepeatLast));
                insertQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, isRequired));
                insertQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, isReadOnly));
                insertQuery.Parameters.Add(new QueryParameter("@IsRetainImgSize", DbType.Boolean, isRetainImgSize));
                insertQuery.Parameters.Add(new QueryParameter("@TabOrder", DbType.Int32, tabOrder));
                insertQuery.Parameters.Add(new QueryParameter("@IsTabStop", DbType.Boolean, true));


                Query selectQuery = db.CreateQuery("select MAX(FieldId) from metaFields where FieldId = @FieldId");
                selectQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, fieldId));

                db.ExecuteNonQuery(insertQuery);


                DataTable result = db.Select(selectQuery);
                return (int)result.Rows[0][0];
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create control in the database", ex);
            }
            finally
            {

            }
        }





        public void UpdateView(View view)
        {
            try
            {
                string queryString = "update metaViews set [CheckCodeVariableDefinitions] = @CheckCodeVariableDefinitions, [CheckCode] = @CheckCode, [CheckCodeBefore] = @CheckCodeBefore, [CheckCodeAfter] = @CheckCodeAfter, [RecordCheckCodeBefore] = @RecordCheckCodeBefore, [RecordCheckCodeAfter] = @RecordCheckCodeAfter, [IsRelatedView] = @IsRelatedView  where [ViewId] = @ViewId";
                Query query = db.CreateQuery(queryString);
                query.Parameters.Add(new QueryParameter("@CheckCodeVariableDefinitions", DbType.String, view.CheckCodeVariableDefinitions));
                query.Parameters.Add(new QueryParameter("@CheckCode", DbType.String, view.CheckCode));
                query.Parameters.Add(new QueryParameter("@CheckCodeBefore", DbType.String, view.CheckCodeBefore));
                query.Parameters.Add(new QueryParameter("@CheckCodeAfter", DbType.String, view.WebSurveyId));
                query.Parameters.Add(new QueryParameter("@RecordCheckCodeBefore", DbType.String, view.RecordCheckCodeBefore));
                query.Parameters.Add(new QueryParameter("@RecordCheckCodeAfter", DbType.String, view.RecordCheckCodeAfter));
                query.Parameters.Add(new QueryParameter("@IsRelatedView", DbType.Boolean, view.IsRelatedView));
                query.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, view.Id));

                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update view in the database", ex);
            }
        }







        public void UpdateTabOrder(DataTable FieldsTabOrder, View view, Page currentPage)
        {
            foreach (DataRow row in FieldsTabOrder.Rows)
            {
                Query updateQuery = db.CreateQuery("update metaFields set [TabIndex] = @TabIndex, [HasTabStop] = @HasTabStop where [FieldId] = @FieldId and [ViewId] = @ViewId and [PageId] = @PageId");
                updateQuery.Parameters.Add(new QueryParameter("@TabIndex", DbType.Int32, row["TabIndex"]));
                updateQuery.Parameters.Add(new QueryParameter("@HasTabStop", DbType.Int32, row["HasTabStop"]));
                updateQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, row["FieldId"]));
                updateQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, view.Id));
                updateQuery.Parameters.Add(new QueryParameter("@PageId", DbType.Int32, currentPage.Id));
                db.ExecuteNonQuery(updateQuery);
            }
        }







        public void CreateCheckCodeVariableDefinition(int viewId, string checkCode)
        {
            try
            {

                //Input Validation




                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query updateQuery = db.CreateQuery("update metaViews set [CheckCodeVariableDefinitions] = @CheckCodeVariableDefinitions where [ViewId] = @ViewId");
                updateQuery.Parameters.Add(new QueryParameter("@CheckCodeVariableDefinitions", DbType.String, checkCode));
                updateQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));


                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create variable checkcode in the database", ex);
            }
            finally
            {

            }
        }






        public void CreateViewBeforeCheckCode(int viewId, string checkCode)
        {
            try
            {
                //Input Validation




                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query updateQuery = db.CreateQuery("update metaViews set [CheckCodeBefore] = @ViewCheckCodeBefore where [ViewId] = @ViewId");
                updateQuery.Parameters.Add(new QueryParameter("@ViewCheckCodeBefore", DbType.String, checkCode));
                updateQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));


                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create view checkcode in the database", ex);
            }
            finally
            {

            }
        }






        public void CreateViewAfterCheckCode(int viewId, string checkCode)
        {
            try
            {
                //Input Validation




                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query updateQuery = db.CreateQuery("update metaViews set [CheckCodeAfter] = @ViewCheckCodeAfter where [ViewId] = @ViewId");
                updateQuery.Parameters.Add(new QueryParameter("@ViewCheckCodeAfter", DbType.String, checkCode));
                updateQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));


                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create view checkcode in the database", ex);
            }
            finally
            {

            }
        }






        public void CreateRecordBeforeCheckCode(int viewId, string checkCode)
        {
            try
            {

                //Input Validation




                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query updateQuery = db.CreateQuery("update metaViews set [RecordCheckCodeBefore] = @RecordCheckCodeBefore where [ViewId] = @ViewId");
                updateQuery.Parameters.Add(new QueryParameter("@RecordCheckCodeBefore", DbType.String, checkCode));
                updateQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));


                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create record checkcode in the database", ex);
            }
            finally
            {

            }
        }






        public void CreateRecordAfterCheckCode(int viewId, string checkCode)
        {
            try
            {

                //Input Validation




                if (viewId < 1)
                {
                    throw new ArgumentOutOfRangeException("ViewId");
                }
                //

                Query updateQuery = db.CreateQuery("update metaViews set [RecordCheckCodeAfter] = @RecordCheckCodeAfter where [ViewId] = @ViewId");
                updateQuery.Parameters.Add(new QueryParameter("@RecordCheckCodeAfter", DbType.String, checkCode));
                updateQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));


                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create record checkcode in the database", ex);
            }
            finally
            {

            }
        }





        public void UpdatePage(Page page)
        {
            try
            {
                XmlDocument doc = this.Project.GetXmlDocument();
                XmlNode viewsNode = GetViewsNode();
                XmlNode pagesNode = viewsNode.SelectSingleNode("//View/Pages");
                XmlNode pageNode = pagesNode.SelectSingleNode("//Page[@PageId= '" + page.Id + "']");

                pageNode.Attributes["Name"].Value = page.Name.ToString();
                pageNode.Attributes["Position"].Value = page.Position.ToString();
                pageNode.FirstChild.Attributes["CheckCodeBefore"].Value = page.CheckCodeBefore.ToString();
                pageNode.LastChild.Attributes["CheckCodeAfter"].Value = page.CheckCodeAfter.ToString();

                this.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update page in the database", ex);
            }
            finally
            {

            }
        }








        public void CreatePageBeforeCheckCode(int pageId, string checkCode, View view)
        {
            try
            {

                //Input Validation




                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query updateQuery = db.CreateQuery("update metaPages set [CheckCodeBefore] = @CheckCodeBefore where [PageId] = @PageId");
                updateQuery.Parameters.Add(new QueryParameter("@CheckCodeBefore", DbType.String, checkCode));
                updateQuery.Parameters.Add(new QueryParameter("@PageId", DbType.Int32, pageId));


                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create page checkcode in the database", ex);
            }
            finally
            {

            }
        }







        public void CreatePageAfterCheckCode(int pageId, string checkCode, View view)
        {
            try
            {

                //Input Validation




                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query updateQuery = db.CreateQuery("update metaPages set [CheckCodeAfter] = @CheckCodeAfter where [PageId] = @PageId");
                updateQuery.Parameters.Add(new QueryParameter("@CheckCodeAfter", DbType.String, checkCode));
                updateQuery.Parameters.Add(new QueryParameter("@PageId", DbType.Int32, pageId));


                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create page checkcode in the database", ex);
            }
            finally
            {

            }
        }







        public void CreateControlBeforeCheckCode(int fieldId, string checkCode, View view)
        {
            try
            {

                //Input Validation




                if (fieldId < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                //

                char[] noiseChars = { '\r', '\n', '\t', ' ', '"', '\'' };

                XmlNode viewsNode = GetViewsNode();
                XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + view.Id + "']");
                XmlNode fieldNode = viewNode.SelectSingleNode("//Fields/Field[@FieldId = '" + fieldId + "']");
                fieldNode.LastChild.Attributes["CheckCodeBefore"].Value = checkCode.Trim(noiseChars);
                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create control checkcode in the Xml project file", ex);
            }
            finally
            {

            }
        }







        public void CreateControlAfterCheckCode(int fieldId, string checkCode, View view)
        {
            try
            {
                //Input Validation




                if (fieldId < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                //

                char[] noiseChars = { '\r', '\n', '\t', ' ', '"', '\'' };

                XmlNode viewsNode = GetViewsNode();
                XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + view.Id + "']");
                XmlNode fieldNode = viewNode.SelectSingleNode("//Fields/Field[@FieldId = '" + fieldId + "']");
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = checkCode.Trim(noiseChars);
                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create control checkcode in the Xml project file", ex);
            }
            finally
            {

            }
        }







        public void CreateCodeTableRecord(string tableName, string[] columnNames, string[] columnData)
        {
            try
            {
                StringBuilder sb = new StringBuilder();
                sb.Append("insert into ");
                sb.Append(tableName);
                sb.Append(" (");
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append(columnNames[x]);
                    if (x < columnNames.Length - 1)
                    {
                        sb.Append(", ");
                    }
                }
                sb.Append(") values ");
                sb.Append(" (");
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append("@");
                    sb.Append(columnNames[x]);
                    if (x < columnNames.Length - 1)
                    {
                        sb.Append(", ");
                    }
                }
                sb.Append(")");
                Query insertQuery = db.CreateQuery(sb.ToString());
                for (int x = 0; x < columnNames.Length; x++)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@" + columnNames[x], DbType.String, columnData[x]));
                }

                db.ExecuteNonQuery(insertQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create record in code table", ex);
            }
            finally
            {

            }
        }







        public void SaveCodeTableData(DataTable dataTable, string tableName, string columnName)
        {
            try
            {

                Query updateQuery = db.CreateQuery("update " + tableName + " set " + columnName + " = @NewValue where " + columnName + " = @OldValue");
                updateQuery.Parameters.Add(new QueryParameter("@NewValue", DbType.String, columnName, columnName));
                updateQuery.Parameters.Add(new QueryParameter("@OldValue", DbType.String, columnName, columnName));
                updateQuery.Parameters[1].SourceVersion = DataRowVersion.Original;

                Query insertQuery = db.CreateQuery("insert into " + tableName + "(" + columnName + ") values (@Value)");
                insertQuery.Parameters.Add(new QueryParameter("@Value", DbType.String, columnName, columnName));





                db.Update(dataTable, tableName, insertQuery, updateQuery);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not save data for code table", ex);
            }
            finally
            {

            }
        }

        public bool TableExists(string tableName)
        {
            return db.TableExists(tableName);
        }







        public void Initialize(DbDriverInfo MetaDbInfo, string driver, bool createDatabase)
        {
            throw new NotImplementedException("Not implemented");
        }





        public Dictionary DuplicateFieldNames()
        {
            return new Dictionary();
        }







        public void InsertCodeTableData(DataTable dataTable, string tableName, string[] columnNames)
        {
            try
            {
                StringBuilder sb = new StringBuilder();
                sb.Append("insert into [");
                sb.Append(tableName);
                sb.Append("] (");
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append(columnNames[x]);
                    if (x < columnNames.Length - 1)
                    {
                        sb.Append(", ");
                    }
                }
                sb.Append(") values ");
                sb.Append(" (");
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append("@");
                    sb.Append(columnNames[x]);
                    if (x < columnNames.Length - 1)
                    {
                        sb.Append(", ");
                    }
                }
                sb.Append(")");
                Query insertQuery = db.CreateQuery(sb.ToString());
                foreach (DataRow row in dataTable.Rows)
                {
                    insertQuery.Parameters.Clear();
                    for (int x = 0; x < columnNames.Length; x++)
                    {
                        insertQuery.Parameters.Add(new QueryParameter("@" + columnNames[x], DbType.String, row[columnNames[x]]));
                    }

                    db.ExecuteNonQuery(insertQuery);
                }
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not insert code into code table", ex);
            }
            finally
            {

            }
        }




        public void InsertFields(DataTable fields)
        {
            throw new System.ApplicationException("Not implemented");
        }







        public void SaveCodeTableData(DataTable dataTable, string tableName, string[] columnNames)
        {
            try
            {
                StringBuilder sb = new StringBuilder();
                sb.Append("insert into ");
                sb.Append(tableName);
                sb.Append(" (");
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append(columnNames[x]);
                    if (x < columnNames.Length - 1)
                    {
                        sb.Append(", ");
                    }
                }
                sb.Append(") values ");
                sb.Append(" (");
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append("@");
                    sb.Append(columnNames[x]);
                    if (x < columnNames.Length - 1)
                    {
                        sb.Append(", ");
                    }
                }
                sb.Append(")");
                Query insertQuery = db.CreateQuery(sb.ToString());
                for (int x = 0; x < columnNames.Length; x++)
                {
                    insertQuery.Parameters.Add(new QueryParameter("@" + columnNames[x], DbType.String, columnNames[x], columnNames[x]));
                }

                sb.Remove(0, sb.Length);

                sb.Append("update [").Append(tableName);
                sb.Append(StringLiterals.RIGHT_SQUARE_BRACKET).Append(StringLiterals.SPACE);
                sb.Append("set").Append(StringLiterals.SPACE);
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append(StringLiterals.LEFT_SQUARE_BRACKET);
                    sb.Append(columnNames[x]);
                    sb.Append(StringLiterals.RIGHT_SQUARE_BRACKET);
                    sb.Append(StringLiterals.EQUAL);
                    sb.Append("@NewValue").Append(StringLiterals.SPACE);
                    sb.Append(", ");
                }
                sb.Append("where ");
                for (int x = 0; x < columnNames.Length; x++)
                {
                    sb.Append(columnNames[x]).Append(StringLiterals.SPACE);
                    sb.Append(StringLiterals.EQUAL);
                    sb.Append("@OldValue");
                    if (columnNames.Length > 1)
                    {
                        sb.Append(" and");
                    }
                }
                Query updateQuery = db.CreateQuery(sb.ToString());
                for (int x = 0; x < columnNames.Length; x++)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@NewValue", DbType.String, columnNames[x], columnNames[x]));
                    updateQuery.Parameters.Add(new QueryParameter("@OldValue", DbType.String, columnNames[x], columnNames[x]));
                    updateQuery.Parameters[1].SourceVersion = DataRowVersion.Original;
                }


                db.Update(dataTable, tableName, insertQuery, updateQuery);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not save data for code table", ex);
            }
            finally
            {

            }
        }






        public bool CreateCodeTable(string tableName, string[] columnNames)
        {
            try
            {
                if (!db.TableExists(tableName))
                {
                    StringBuilder sb = new StringBuilder();
                    sb.Append("create table [");
                    sb.Append(tableName);
                    sb.Append("] (");
                    for (int x = 0; x < columnNames.Length; x++)
                    {
                        sb.Append(columnNames[x]);
                        sb.Append(" varchar(255)");
                        if (x < columnNames.Length - 1)
                        {
                            sb.Append(", ");
                        }
                    }
                    sb.Append(")");
                    Query createQuery = db.CreateQuery(sb.ToString());

                    db.ExecuteNonQuery(createQuery);

                    return true;
                }
                else
                {
                    return false;
                }
            }




            finally
            {

            }
        }





        public void CreateCodeTable(string tableName, string columnName)
        {
            try
            {
                if (!db.TableExists(tableName))
                {
                    StringBuilder sb = new StringBuilder();
                    sb.Append("create table ");
                    sb.Append(tableName);
                    sb.Append(" (");
                    sb.Append(columnName);
                    sb.Append(" varchar(255)");
                    sb.Append(")");
                    Query createQuery = db.CreateQuery(sb.ToString());

                    db.ExecuteNonQuery(createQuery);
                }
            }
            finally
            {

            }
        }








        public virtual void InsertPgm(string name, string content, string comment, string author)
        {
            try
            {
                Query insertQuery = db.CreateQuery("insert into metaPrograms([Name], [Content], [Comment],[DateCreated],[DateModified], [Author]) " +
                    "values (@Name, @Content, @Comment,@DateCreated,@DateModified,  @Author)");

                insertQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, name));
                insertQuery.Parameters.Add(new QueryParameter("@Content", DbType.String, content));
                insertQuery.Parameters.Add(new QueryParameter("@Comment", DbType.String, comment));
                insertQuery.Parameters.Add(new QueryParameter("@DateCreated", DbType.String, System.DateTime.Now.ToShortDateString()));
                insertQuery.Parameters.Add(new QueryParameter("@DateModified", DbType.String, System.DateTime.Now.ToShortDateString()));
                insertQuery.Parameters.Add(new QueryParameter("@Author", DbType.String, author));

                db.ExecuteNonQuery(insertQuery);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not insert programs", ex);
            }
        }
        //

        //Delete Statements




        public void DeleteView(string viewName)
        {
            try
            {
                //Input Validation
                if (viewName.Trim().Length == 0)
                {
                    throw new NullReferenceException(SharedStrings.WARING_VIEW_NAME_MISSING);
                }
                //

                Query query = db.CreateQuery("delete from metaViews where [metaViews.Name] = '" + viewName + "'");

                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException(SharedStrings.WARNING_DELETE_VIEW_ERROR, ex);
            }
        }





        public void DeleteCodeTable(string tableName)
        {
            try
            {
                Query query = db.CreateQuery("DROP TABLE " + tableName);
                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete the code table from database", ex);
            }
        }





        public void DeletePage(Page page)
        {
            try
            {
                //Input Validation
                if (page.Id < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                XmlDocument doc = GetXmlDocument();
                XmlNode pagesNode = GetPagesNode(page.GetView().ViewElement);
                XmlNode pageNode = pagesNode.SelectSingleNode("//Page[@PageId= '" + page.Id + "']");
                pageNode.ParentNode.RemoveChild(pageNode);

                Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete page in the database", ex);
            }
            finally
            {

            }
        }





        public void DeleteField(string fieldName, int viewId)
        {
            try
            {
                Query query = db.CreateQuery("delete from metaFields where [Name] = @name and [ViewId] = @viewId");
                query.Parameters.Add(new QueryParameter("@name", DbType.String, fieldName));
                query.Parameters.Add(new QueryParameter("@viewId", DbType.Int32, viewId));
                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete field in the database", ex);
            }
        }





        public void DeleteField(Field field)
        {
            try
            {
                XmlDocument doc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(field.GetView().ViewElement);
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + field.Id + "']");
                fieldNode.ParentNode.RemoveChild(fieldNode);

                Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete field in the Xml metadata file", ex);
            }
            finally
            {

            }
        }





        public void DeleteGridColumn(GridColumnBase column)
        {
            try
            {
                Query query = db.CreateQuery("delete from metaGridColumns where [FieldId] = @fieldId and [Name] = @Name");
                query.Parameters.Add(new QueryParameter("@fieldId", DbType.Int32, column.Id));
                query.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));

                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete grid column in the database.", ex);
            }
            finally
            {

            }
        }





        public void DeleteFields(Page page)
        {
            try
            {
                XmlDocument doc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(page.GetView().ViewElement);
                XmlNodeList nodeList = fieldsNode.SelectNodes("Field[@PageId = '" + page.Id + "']");
                foreach (XmlNode node in nodeList)
                {
                    node.ParentNode.RemoveChild(node);
                }
                Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete fields in the database", ex);
            }
            finally
            {

            }
        }





        public void DeletePgm(int pgmId)
        {
            try
            {
                //Input Validation
                if (pgmId < 1)
                {
                    throw new ArgumentOutOfRangeException("ProgramId");
                }
                //
                Query deleteQuery = db.CreateQuery("delete  from [metaPrograms] where [ProgramId] = @PgmId");
                deleteQuery.Parameters.Add(new QueryParameter("@PgmId", DbType.Int32, pgmId));
                db.ExecuteNonQuery(deleteQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete pgm.", ex);
            }
            finally
            {

            }
        }





        public virtual void DeletePgm(string pgmName)
        {
            throw new System.ApplicationException("Not implemented");
        }

        //Delete Statements

        //Update Statements





        public void ResetTabIndexes(Page page)
        {
            try
            {
                Query query = db.CreateQuery("select [FieldId], [ControlTopPositionPercentage], [ControlLeftPositionPercentage] from metaFields where [PageId] = @PageId order by [ControlTopPositionPercentage], [ControlLeftPositionPercentage]");
                query.Parameters.Add(new QueryParameter("@PageId", DbType.Int32, page.Id));
                DataTable table = db.Select(query);
                int tabIndex = 0;

                foreach (DataRow row in table.Rows)
                {
                    tabIndex++;
                    Query updateQuery = db.CreateQuery("update metaFields set [TabIndex] = @TabIndex where [FieldId] = @FieldId");
                    updateQuery.Parameters.Add(new QueryParameter("@TabIndex", DbType.Int32, tabIndex));
                    updateQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, (int)row[ColumnNames.FIELD_ID]));
                    db.ExecuteNonQuery(updateQuery);
                }
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not reset tab indexes", ex);
            }
            finally
            {

            }
        }





        public void UpdatePromptPosition(FieldWithSeparatePrompt field)
        {
            try
            {
                XmlDocument doc = this.Project.GetXmlDocument();
                XmlNode viewsNode = GetViewsNode();
                XmlNode fieldsNode = viewsNode.SelectSingleNode("//View/Fields");
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + field.Id + "']");

                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();

                this.Project.Save();







            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update prompt position", ex);
            }
            finally
            {

            }
        }





        public void UpdateControlPosition(RenderableField field) 
        {
            try
            {
                XmlDocument doc = this.Project.GetXmlDocument();
                XmlNode viewsNode = GetViewsNode();
                XmlNode fieldsNode = viewsNode.SelectSingleNode("//View/Fields");
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + field.Id + "']");

                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();

                this.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update control position", ex);
            }
            finally
            {

            }
        }





        public void UpdateControlSize(RenderableField field)
        {
            try
            {
                XmlDocument doc = this.Project.GetXmlDocument();
                XmlNode viewsNode = GetViewsNode();
                XmlNode fieldsNode = viewsNode.SelectSingleNode("//View/Fields");
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + field.Id + "']");

                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();

                this.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update control size", ex);
            }
            finally
            {

            }
        }






        public void UpdateDataTableName(int viewId, string tableName)
        {
            try
            {
                Query query = db.CreateQuery("update metaFields set [DataTableName] = @tableName where [ViewId] = @viewId");
                query.Parameters.Add(new QueryParameter("@tableName", DbType.String, tableName));
                query.Parameters.Add(new QueryParameter("@viewId", DbType.Int32, viewId));

                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update data table name", ex);
            }
            finally
            {

            }
        }

        public void RemovePageOutlierFields()
        {
            try
            {
                Query query = db.CreateQuery("delete from metaFields where [ControlTopPositionPercentage] > 1 or [ControlLeftPositionPercentage] > 1 or [PromptTopPositionPercentage] > 1 or [PromptLeftPositionPercentage] > 1");

                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not delete fields in the database", ex);
            }
        }






        public void RenamePage(int pageId, string newPageName)
        {
            try
            {
                //Input Validation
                if (string.IsNullOrEmpty(newPageName))
                {
                    throw new ArgumentNullException("NewPageName");
                }
                if (pageId < 1)
                {
                    throw new ArgumentOutOfRangeException("PageId");
                }
                //

                Query query = db.CreateQuery("update metaPages set [Name] = @newPageName where [PageId] = @pageId");
                query.Parameters.Add(new QueryParameter("@newPageName", DbType.String, newPageName));
                query.Parameters.Add(new QueryParameter("@pageId", DbType.Int32, pageId));

                db.ExecuteNonQuery(query);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not rename page in the database", ex);
            }
            finally
            {

            }
        }






        public void SynchronizePageNumbersOnInsert(View view, Page page)
        {
            try
            {

                //Input Validation
                if (page == null)
                {
                    throw new ArgumentNullException("Page");
                }
                if (view == null)
                {
                    throw new ArgumentNullException("View");
                }
                //

                XmlDocument doc = GetXmlDocument();
                XmlNode pagesNode = GetPagesNode(view.ViewElement);
                XmlNodeList nodeList = pagesNode.SelectNodes("Page[@Position>= '" + page.Position + "' and @PageId!= '" + page.Id + "']");
                foreach (XmlNode node in nodeList)
                {
                    int pagePosition = Int32.Parse(node.Attributes["Position"].Value) + 1;
                    node.Attributes["Position"].Value = pagePosition.ToString();
                }
                Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update page position to insert a page in the database", ex);
            }
            finally
            {

            }
        }






        public void SynchronizePageNumbersOnDelete(View view, int position)
        {
            try
            {
                //Input Validation
                if (position < 0)
                {
                    throw new ArgumentOutOfRangeException("Position");
                }
                if (view == null)
                {
                    throw new ArgumentNullException("View");
                }
                //

                XmlDocument doc = GetXmlDocument();
                XmlNode pagesNode = GetPagesNode(view.ViewElement);
                XmlNodeList nodeList = pagesNode.SelectNodes("Page[@Position>= '" + position + "']");
                foreach (XmlNode node in nodeList)
                {
                    int pagePosition = Int32.Parse(node.Attributes["Position"].Value) - 1;
                    node.Attributes["Position"].Value = pagePosition.ToString();
                }
                Save();

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update page position to delete a page in the database", ex);
            }
            finally
            {

            }
        }








        public void RelateFieldToView(Guid fieldId, int relatedViewId, string relateCondition, bool shouldReturnToParent)
        {
            try
            {
                Query fieldQuery = db.CreateQuery("update metaFields set [RelatedViewId] = @RelatedViewId, [RelateCondition] = @RelateCondition, [ShouldReturnToparent] = @ShouldReturnToParent where FieldId = @FieldId");
                fieldQuery.Parameters.Add(new QueryParameter("@RelatedViewId", DbType.Int32, relatedViewId));
                fieldQuery.Parameters.Add(new QueryParameter("@RelateCondition", DbType.String, relateCondition));
                fieldQuery.Parameters.Add(new QueryParameter("@ShouldReturnToParent", DbType.Boolean, shouldReturnToParent));
                fieldQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, fieldId));

                Query viewQuery = db.CreateQuery("update metaViews set [IsRelatedView] = @IsRelatedView where [ViewId] = @ViewId");
                viewQuery.Parameters.Add(new QueryParameter("@IsRelatedView", DbType.Boolean, true));
                viewQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, relatedViewId));


                db.ExecuteNonQuery(fieldQuery);
                db.ExecuteNonQuery(viewQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create new relate info", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(CheckBoxField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("CheckBoxField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();

                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();


                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update CheckBoxField in the database", ex);
            }
            finally
            {

            }
        }

        /* private void UpdateField(CodeField field)
        {
            try
            {
        //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("CodeField");
                }
        //

                DbQuery updateQuery = db.CreateQuery("update metaFields set [ControlFontFamily] = @ControlFontFamily, [ControlFontStyle] = @ControlFontStyle, " +
                    "[ControlFontSize] = @ControlFontSize, [ControlHeight] = @ControlHeight, [ControlLeftPosition] = @ControlLeftPosition, " +
                    "[ControlTopPosition] = @ControlTopPosition, [ControlWidth] = @ControlWidth, [HasTabStop] = @HasTabStop, [Name] = @Name, " +
                    "[PageId] = @PageId, [PromptFontFamily] = @PromptFontFamily, [PromptFontStyle] = @PromptFontStyle, [PromptFontSize] = @PromptFontSize, " +
                    "[PromptLeftPosition] = @PromptLeftPosition, [PromptText] = @PromptText, [PromptTopPosition] = @PromptTopPosition, " +
                    "[TabIndex] = @TabIndex where [FieldId] = @FieldId");

                updateQuery.Parameters.Add(new DbParameter("@ControlFontFamily", DbType.String, field.ControlFont.Name));
                updateQuery.Parameters.Add(new DbParameter("@ControlFontStyle", DbType.String, field.ControlFont.Style.ToString()));
                updateQuery.Parameters.Add(new DbParameter("@ControlFontSize", DbType.Double, field.ControlFont.Size));
                updateQuery.Parameters.Add(new DbParameter("@ControlHeight", DbType.Double, field.ControlHeightPercentage));
                updateQuery.Parameters.Add(new DbParameter("@ControlLeftPosition", DbType.Double, field.ControlLeftPositionPercentage));
                updateQuery.Parameters.Add(new DbParameter("@ControlTopPosition", DbType.Double, field.ControlTopPositionPercentage));
                updateQuery.Parameters.Add(new DbParameter("@ControlWidth", DbType.Double, field.ControlWidthPercentage));
                updateQuery.Parameters.Add(new DbParameter("@HasTabStop", DbType.Boolean, field.HasTabStop));
                updateQuery.Parameters.Add(new DbParameter("@Name", DbType.String, field.Name));
                updateQuery.Parameters.Add(new DbParameter("@PageId", DbType.Int32, field.Page.Id));
                updateQuery.Parameters.Add(new DbParameter("@PromptFontFamily", DbType.String, field.PromptFont.Name));
                updateQuery.Parameters.Add(new DbParameter("@PromptFontStyle", DbType.String, field.PromptFont.Style.ToString()));
                updateQuery.Parameters.Add(new DbParameter("@PromptFontSize", DbType.Double, field.PromptFont.Size));
                updateQuery.Parameters.Add(new DbParameter("@PromptLeftPosition", DbType.Double, field.PromptLeftPositionPercentage));
                updateQuery.Parameters.Add(new DbParameter("@PromptText", DbType.String, field.PromptText));
                updateQuery.Parameters.Add(new DbParameter("@PromptTopPosition", DbType.Double, field.PromptTopPositionPercentage));
                updateQuery.Parameters.Add(new DbParameter("@TabIndex", DbType.Int32, field.TabIndex));
                updateQuery.Parameters.Add(new DbParameter("@FieldId", DbType.Int32, field.Id));


                db.ExecuteNonQuery(updateQuery);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update CodeField in the database", ex);
            }
            finally
            {

            }
        }
        */






        public void UpdateField(CommandButtonField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("CommandButtonField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();


                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update CommandButtonField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(DateField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DateField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();

                fieldNode.Attributes["Lower"].Value = field.Lower.ToString();
                fieldNode.Attributes["Upper"].Value = field.Upper.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update DateField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(DateTimeField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DateTimeField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update DateTimeField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(DDLFieldOfCodes field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDLFieldOfCodes");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();

                fieldNode.Attributes["CodeColumnName"].Value = field.CodeColumnName.ToString();
                fieldNode.Attributes["IsExclusiveTable"].Value = (bool.Parse(field.IsExclusiveTable.ToString())).ToString();
                fieldNode.Attributes["Sort"].Value = (bool.Parse(field.ShouldSort.ToString())).ToString();
                fieldNode.Attributes["SourceTableName"].Value = field.SourceTableName.ToString();
                fieldNode.Attributes["TextColumnName"].Value = field.TextColumnName.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore;
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter;

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update DDLFieldOfCodes in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(DDListField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDListField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();

                fieldNode.Attributes["CodeColumnName"].Value = field.CodeColumnName.ToString();
                fieldNode.Attributes["IsExclusiveTable"].Value = (bool.Parse(field.IsExclusiveTable.ToString())).ToString();
                fieldNode.Attributes["Sort"].Value = (bool.Parse(field.ShouldSort.ToString())).ToString();
                fieldNode.Attributes["SourceTableName"].Value = field.SourceTableName.ToString();
                fieldNode.Attributes["TextColumnName"].Value = field.TextColumnName.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore;
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter;

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update DDListField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(DDLFieldOfCommentLegal field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDLFieldOfCommentLegal");
                }
                //


                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["CodeColumnName"].Value = field.CodeColumnName.ToString();
                fieldNode.Attributes["IsExclusiveTable"].Value = (bool.Parse(field.IsExclusiveTable.ToString())).ToString();
                fieldNode.Attributes["Sort"].Value = (bool.Parse(field.ShouldSort.ToString())).ToString();
                fieldNode.Attributes["SourceTableName"].Value = field.SourceTableName.ToString();
                fieldNode.Attributes["TextColumnName"].Value = field.TextColumnName.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update DDLFieldOfCommentLegal in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(DDLFieldOfLegalValues field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("DDLFieldOfLegalValues");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["CodeColumnName"].Value = field.CodeColumnName.ToString();
                fieldNode.Attributes["IsExclusiveTable"].Value = (bool.Parse(field.IsExclusiveTable.ToString())).ToString();
                fieldNode.Attributes["Sort"].Value = (bool.Parse(field.ShouldSort.ToString())).ToString();
                fieldNode.Attributes["SourceTableName"].Value = field.SourceTableName.ToString();
                fieldNode.Attributes["TextColumnName"].Value = field.TextColumnName.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update DDLFieldOfLegalValues in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(GridField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("GridField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();




                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update GridField in the database", ex);
            }
            finally
            {

            }
        }





        public void UpdateField(GroupField field)
        {
        }






        public void UpdateField(GUIDField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("GUIDField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name;
                fieldNode.Attributes["PromptText"].Value = field.PromptText;
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.FontFamily.Name;
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name;
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name;
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name;
                fieldNode.Attributes["ShouldRepeatLast"].Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString()).ToString());
                fieldNode.Attributes["MaxLength"].Value = field.MaxLength.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName;
                fieldNode.Attributes["SourceFieldId"].Value = field.SourceFieldId.ToString();

                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore;
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter;

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update SingleLineTextField in the metadata project file", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(ImageField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("ImageField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name;
                fieldNode.Attributes["ShouldRepeatLast"].Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();


                field.TableName = fieldNode.Attributes["DataTableName"].Value;

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update ImageField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(LabelField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("LabelField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");



                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.FontFamily.Name.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();

                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();


                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update LabelField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(MirrorField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("MirrorField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.FontFamily.Name.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();


                fieldNode.Attributes["SourceFieldId"].Value = field.SourceFieldId.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update MirrorField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(MultilineTextField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("MultiLineTextField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.FontFamily.Name.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();

                fieldNode.Attributes["MaxLength"].Value = field.MaxLength.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.Attributes["SourceFieldId"].Value = field.SourceFieldId.ToString();

                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update MultiLineTextField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(NumberField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("NumberField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();

                fieldNode.Attributes["Lower"].Value = field.Lower.ToString();
                fieldNode.Attributes["Upper"].Value = field.Upper.ToString();
                fieldNode.Attributes["Pattern"].Value = field.Pattern.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update NumberField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(OptionField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("OptionField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name;
                fieldNode.Attributes["PromptText"].Value = field.PromptText;
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.FontFamily.Name;
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name;
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name;
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name;
                fieldNode.Attributes["ShouldRepeatLast"].Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["ShowTextOnRight"].Value = (bool.Parse(field.ShowTextOnRight.ToString())).ToString();

                fieldNode.Attributes["DataTableName"].Value = field.TableName;
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter;

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update OptionField in the database", ex);
            }
            finally
            {

            }
        }






        public void UpdateField(PhoneNumberField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("PhoneNumberField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();

                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();

                fieldNode.Attributes["Pattern"].Value = field.Pattern.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update PhoneNumberField in the database", ex);
            }
            finally
            {
            }
        }






        public void UpdateField(RelatedViewField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("RelatedViewField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["RelateCondition"].Value = field.Condition.ToString();
                fieldNode.Attributes["RelatedViewId"].Value = field.RelatedViewID.ToString();
                fieldNode.Attributes["ShouldReturnToParent"].Value = (bool.Parse(field.ShouldReturnToParent.ToString())).ToString();

                XmlNode viewNode = fieldsNode.ParentNode.SelectSingleNode("//View[@ViewId= '" + view.Id + "']");
                view.IsRelatedView = true;
                viewNode.Attributes["IsRelatedView"].Value = "true";

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update RelatedViewField in the database", ex);
            }
        }






        public void UpdateField(SingleLineTextField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("SingeLineTextField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name;
                fieldNode.Attributes["PromptText"].Value = field.PromptText;
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.FontFamily.Name;
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name;
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name;
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name;
                fieldNode.Attributes["ShouldRepeatLast"].Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["MaxLength"].Value = field.MaxLength.ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName;
                fieldNode.Attributes["SourceFieldId"].Value = field.SourceFieldId.ToString();

                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore;
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter;

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update SingleLineTextField in the metadata project file", ex);
            }
        }






        public void UpdateField(TimeField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("TimeField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = (bool.Parse(field.ShouldRepeatLast.ToString())).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString())).ToString();
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();
                fieldNode.FirstChild.Attributes["CheckCodeBefore"].Value = field.CheckCodeBefore.ToString();
                fieldNode.LastChild.Attributes["CheckCodeAfter"].Value = field.CheckCodeAfter.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update TimeField in the database", ex);
            }
        }






        public void UpdateField(UpperCaseTextField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("UpperCaseTextField");
                }
                //
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update UpperCaseTextField in the database", ex);
            }
        }






        public void UpdateField(YesNoField field)
        {
            try
            {
                //InputValidation
                if (field == null)
                {
                    throw new ArgumentNullException("YesNoField");
                }
                //

                XmlDocument xmlDoc = GetXmlDocument();
                XmlNode fieldsNode = GetFieldsNode(GetFieldViewElement(field));
                View view = field.GetView();
                string fieldId = field.Id.ToString();
                XmlNode fieldNode = fieldsNode.SelectSingleNode("//Field[@FieldId= '" + fieldId + "']");

                fieldNode.Attributes["Name"].Value = field.Name.ToString();
                fieldNode.Attributes["PromptText"].Value = field.PromptText.ToString();
                fieldNode.Attributes["ControlFontFamily"].Value = field.ControlFont.ToString();
                fieldNode.Attributes["ControlFontStyle"].Value = field.ControlFont.Style.ToString();
                fieldNode.Attributes["ControlFontSize"].Value = field.ControlFont.Size.ToString();
                fieldNode.Attributes["ControlTopPositionPercentage"].Value = field.ControlTopPositionPercentage.ToString();
                fieldNode.Attributes["ControlLeftPositionPercentage"].Value = field.ControlLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlHeightPercentage"].Value = field.ControlHeightPercentage.ToString();
                fieldNode.Attributes["ControlWidthPercentage"].Value = field.ControlWidthPercentage.ToString();
                fieldNode.Attributes["TabIndex"].Value = field.TabIndex.ToString();
                fieldNode.Attributes["HasTabStop"].Value = (bool.Parse(field.HasTabStop.ToString())).ToString();
                fieldNode.Attributes["PromptFontFamily"].Value = field.PromptFont.FontFamily.Name.ToString();
                fieldNode.Attributes["PromptFontStyle"].Value = field.PromptFont.Style.ToString();
                fieldNode.Attributes["PromptFontSize"].Value = field.PromptFont.Size.ToString();
                fieldNode.Attributes["PromptScriptName"].Value = field.PromptFont.Name.ToString();
                fieldNode.Attributes["PromptTopPositionPercentage"].Value = field.PromptTopPositionPercentage.ToString();
                fieldNode.Attributes["PromptLeftPositionPercentage"].Value = field.PromptLeftPositionPercentage.ToString();
                fieldNode.Attributes["ControlScriptName"].Value = field.ControlFont.Name.ToString();
                fieldNode.Attributes["ShouldRepeatLast"].Value = bool.Parse(field.ShouldRepeatLast.ToString()).ToString();
                fieldNode.Attributes["IsRequired"].Value = (bool.Parse(field.IsRequired.ToString()).ToString());
                fieldNode.Attributes["IsReadOnly"].Value = (bool.Parse(field.IsReadOnly.ToString())).ToString();
                fieldNode.Attributes["DataTableName"].Value = field.TableName.ToString();

                view.Project.Save();
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update YesNoField in the database", ex);
            }
        }









        public void UpdatePgm(int programId, string name, string content, string comment, string author)
        {
            try
            {
                //Input Validation
                if (programId < 1)
                {
                    throw new ArgumentOutOfRangeException("ProgramId");
                }
                //
                Query updateQuery = db.CreateQuery("update [metaPrograms] set [" +
                                      ColumnNames.PGM_NAME + "] = @Name, [" +
                                      ColumnNames.PGM_CONTENT + "] = @Content , [" +
                                      ColumnNames.PGM_COMMENT + "] = @Comment, [" +
                                      ColumnNames.PGM_AUTHOR + "] = @Author, [" +
                                      ColumnNames.PGM_MODIFY_DATE + "] = @DateModified " +
                                      "where [ProgramId] = @ProgramId");
                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, name));
                updateQuery.Parameters.Add(new QueryParameter("@Content", DbType.String, content));
                updateQuery.Parameters.Add(new QueryParameter("@Comment", DbType.String, comment));
                updateQuery.Parameters.Add(new QueryParameter("@Author", DbType.String, author));
                updateQuery.Parameters.Add(new QueryParameter("@DateModified", DbType.String, System.DateTime.Now.ToShortDateString()));
                updateQuery.Parameters.Add(new QueryParameter("@ProgramId", DbType.Int32, programId));

                db.ExecuteNonQuery(updateQuery);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update program.", ex);
            }
        }








        public void UpdateCodesFieldSources(int fieldId, int sourceFieldId, string codeColumnName, string sourceTableName)
        {
            try
            {
                //Input Validation
                if (fieldId < 1)
                {
                    throw new ArgumentOutOfRangeException("FieldId");
                }
                if (sourceFieldId < 1)
                {
                    throw new ArgumentOutOfRangeException("SourceFieldId");
                }
                if (string.IsNullOrEmpty(codeColumnName))
                {
                    throw new ArgumentNullException("CodeColumnName");
                }
                if (string.IsNullOrEmpty(sourceTableName))
                {
                    throw new ArgumentNullException("SourceTableName");
                }
                //
                Query updateQuery = db.CreateQuery("update [metaFields] set [SourceFieldId] = @SourceFieldId, " +
                    "[CodeColumnName] = @CodeColumnName, [SourceTableName] = @SourceTableName " +
                    " where [FieldId] = @FieldId");
                updateQuery.Parameters.Add(new QueryParameter("@SourceFieldId", DbType.Int32, sourceFieldId));
                updateQuery.Parameters.Add(new QueryParameter("@CodeColumnName", DbType.String, codeColumnName));
                updateQuery.Parameters.Add(new QueryParameter("@SourceTableName", DbType.String, sourceTableName));
                updateQuery.Parameters.Add(new QueryParameter("@FieldId", DbType.Int32, fieldId));

                db.ExecuteNonQuery(updateQuery);

            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update code field information.", ex);
            }
        }





        public void UpdateGridColumn(ContiguousColumn column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [Width] = @Width, [Position] = @Position, [FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly, [Pattern] = @Pattern, [Upper] = @Upper , [Lower] = @Lower " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                if (column.Pattern == null)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, DBNull.Value));
                }
                else
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, column.Pattern));
                }
                if (column.Upper == null)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, DBNull.Value));
                }
                else
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, column.Upper));
                }
                if (column.Lower == null)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, DBNull.Value));
                }
                else
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, column.Lower));
                }
                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }





        public void UpdateGridColumn(PhoneNumberColumn column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [Width] = @Width, [Position] = @Position, [FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly, [Pattern] = @Pattern " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                if (column.Pattern == null)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, DBNull.Value));
                }
                else
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, column.Pattern));
                }

                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }





        public void UpdateGridColumn(NumberColumn column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [Width] = @Width, [Position] = @Position, [FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly, [Pattern] = @Pattern, [Upper] = @Upper, [Lower] = @Lower " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                if (column.Pattern == null)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, DBNull.Value));
                }
                else
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Pattern", DbType.String, column.Pattern));
                }
                if (column.Upper == null)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, DBNull.Value));
                }
                else
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Upper", DbType.String, column.Upper));
                }
                if (column.Lower == null)
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, DBNull.Value));
                }
                else
                {
                    updateQuery.Parameters.Add(new QueryParameter("@Lower", DbType.String, column.Lower));
                }
                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }




        public void UpdateGridColumn(TextColumn column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [Width] = @Width, [Position] = @Position, [FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly, [Size] = @Size " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                updateQuery.Parameters.Add(new QueryParameter("@Size", DbType.Int16, column.Size));
                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }





        public void UpdateGridColumn(CheckboxColumn column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [Width] = @Width, [Position] = @Position, [FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }





        public void UpdateGridColumn(YesNoColumn column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [Width] = @Width, [Position] = @Position, [FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }





        public void UpdateGridColumn(DDLColumnOfCommentLegal column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [TextColumnName] = @TextColumnName, [SourceTableName] = @SourceTableName, [Width] = @Width, [Position] = @Position, " +
                    "[FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsExclusiveTable] = @IsExclusiveTable, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly, [Sort] = @Sort " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@TextColumnName", DbType.String, column.TextColumnName));
                updateQuery.Parameters.Add(new QueryParameter("@SourceTableName", DbType.String, column.SourceTableName));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsExclusiveTable", DbType.Boolean, column.IsExclusiveTable));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@Sort", DbType.Boolean, column.ShouldSort));
                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }





        public void UpdateGridColumn(DDLColumnOfLegalValues column)
        {
            try
            {
                Query updateQuery = db.CreateQuery("update [metaGridColumns] set [Name] = @Name, [TextColumnName] = @TextColumnName, [SourceTableName] = @SourceTableName, [Width] = @Width, [Position] = @Position, " +
                    "[FieldTypeId] = @FieldTypeId, [Text] = @Text, [ShouldRepeatLast] = @ShouldRepeatLast, [IsExclusiveTable] = @IsExclusiveTable, [IsRequired] = @IsRequired, [IsReadOnly] = @IsReadOnly, [Sort] = @Sort " +
                    "where [GridColumnId] = @GridColumnId");

                updateQuery.Parameters.Add(new QueryParameter("@Name", DbType.String, column.Name));
                updateQuery.Parameters.Add(new QueryParameter("@TextColumnName", DbType.String, column.TextColumnName));
                updateQuery.Parameters.Add(new QueryParameter("@SourceTableName", DbType.String, column.SourceTableName));
                updateQuery.Parameters.Add(new QueryParameter("@Width", DbType.Int32, column.Width));
                updateQuery.Parameters.Add(new QueryParameter("@Position", DbType.Int32, column.Position));
                updateQuery.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, (int)column.GridColumnType));
                updateQuery.Parameters.Add(new QueryParameter("@Text", DbType.String, column.Text));
                updateQuery.Parameters.Add(new QueryParameter("@ShouldRepeatLast", DbType.Boolean, column.ShouldRepeatLast));
                updateQuery.Parameters.Add(new QueryParameter("@IsExclusiveTable", DbType.Boolean, column.IsExclusiveTable));
                updateQuery.Parameters.Add(new QueryParameter("@IsReadOnly", DbType.Boolean, column.IsReadOnly));
                updateQuery.Parameters.Add(new QueryParameter("@IsRequired", DbType.Boolean, column.IsRequired));
                updateQuery.Parameters.Add(new QueryParameter("@Sort", DbType.Boolean, column.ShouldSort));
                updateQuery.Parameters.Add(new QueryParameter("@GridColumnId", DbType.Int32, column.Id));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
        }
        //Update Statements

        //Utility Methods





        public View GetLatestViewInserted()
        {
            return GetViewById(GetMaxViewId());
        }





        public int GetMaxViewId()
        {
            int maxViewId = 0;
            XmlDocument doc = this.Project.GetXmlDocument();
            XmlNode viewsNode = GetViewsNode();
            XmlNode node = viewsNode.SelectSingleNode(@"//View[not(../View/@ViewId > @ViewId)]/@ViewId");

            if (node == null || node.Value.Trim().Equals(string.Empty))
            {
                maxViewId = 1;
            }
            else if (!node.Value.Equals(string.Empty))
            {
                maxViewId = Int32.Parse(node.Value) + 1;
            }
            return maxViewId;
        }






        public int GetMaxPageId(int viewId)
        {
            int maxPageId = 0;
            XmlNode viewsNode = GetViewsNode();
            XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + viewId + "']");
            XmlNode pageNode = viewNode.SelectSingleNode(@"//Page[not(../Page/@PageId > @PageId)]/@PageId");

            if (pageNode == null || pageNode.Value.Trim().Equals(string.Empty))
            {
                maxPageId = 0;
            }
            else if (!pageNode.Value.Equals(string.Empty))
            {
                maxPageId = Int32.Parse(pageNode.Value);
            }
            return maxPageId;
        }





        public int GetMaxBackgroundId()
        {
            throw new NotImplementedException("Not implemented - GetMaxBackgroundId");
        }





        public int GetMaxImageId()
        {
            throw new NotImplementedException("Not implemented - GetMaxImageId");
        }






        public int GetMaxFieldId(int viewId)
        {
            int maxFieldId = 0;
            XmlNode viewsNode = GetViewsNode();
            XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + viewId + "']");
            XmlNode fieldNode = viewNode.SelectSingleNode(@"//Field[not(../Field/@FieldId > @FieldId)]/@FieldId");

            if (fieldNode == null || fieldNode.Value.Trim().Equals(string.Empty))
            {
                maxFieldId = 0;
            }
            else if (!fieldNode.Value.Equals(string.Empty))
            {
                maxFieldId = Int32.Parse(fieldNode.Value);
            }
            return maxFieldId;
        }





        private int GetMaxMapId()
        {
            int maxMapId = 0;
            XmlNode mapsNode = GetMapsNode();
            XmlNode mapNode = mapsNode.SelectSingleNode(@"//Map[not(../Map/@MapId > @MapId)]/@MapId");

            if (mapNode == null || mapNode.Value.Trim().Equals(string.Empty))
            {
                maxMapId = 0;
            }
            else if (!mapNode.Value.Equals(string.Empty))
            {
                maxMapId = Int32.Parse(mapNode.Value) + 1;
            }
            return maxMapId;
        }





        private int GetMaxLayerId()
        {
            int maxLayerId = 0;
            XmlNode layersNode = GetLayersNode();
            XmlNode layerNode = layersNode.SelectSingleNode(@"//Layer[not(../Layer/@LayerId > @LayerId)]/@LayerId");

            if (layerNode == null || layerNode.Value.Trim().Equals(string.Empty))
            {
                maxLayerId = 0;
            }
            else if (!layerNode.Value.Equals(string.Empty))
            {
                maxLayerId = Int32.Parse(layerNode.Value) + 1;
            }
            return maxLayerId;
        }






        public int GetMaxGridColumnId(int gridFieldId)
        {
            Query selectQuery = db.CreateQuery("select MAX(GridColumnId) from metaGridColumns where FieldId = @gridFieldId");
            selectQuery.Parameters.Add(new QueryParameter("@gridFieldId", DbType.Int32, gridFieldId));
            return (int)db.ExecuteScalar(selectQuery);
        }







        public double GetMaxTabIndex(int pageId, int viewId, bool  includeReadOnly = null)
        {
            double maxTabIndex = 0;
            XmlNode viewsNode = GetViewsNode();
            XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + viewId + "']");
            XmlNode fieldsNode = viewNode.SelectSingleNode("//Fields");
            XmlNodeList fieldNodeList = fieldsNode.SelectNodes(@"//Field[@PageId = '" + pageId + "']");

            foreach (XmlNode fieldNode in fieldNodeList)
            {
                XmlNode node = fieldNode.SelectSingleNode(@"//Field[not(../Field/@TabIndex > @TabIndex)]/@TabIndex");
                if (node != null)
                {
                    maxTabIndex = Double.Parse(node.Value);
                    break;
                }
            }
            return maxTabIndex;
        }






        public DataTable GetMetaFieldsSchema(int viewId)
        {
            throw new System.ApplicationException("Not implemented");
        }







        public double GetMinTabIndex(int pageId, int viewId)
        {
            double minTabIndex;
            XmlDocument doc = this.Project.GetXmlDocument();


            XmlNode node = doc.SelectSingleNode(@"//Field[not(../Field/@FieldId < @FieldId)]/@FieldId");

            if (node.Value.Trim() == string.Empty || node == null)
            {
                minTabIndex = -1;
            }
            else
            {
                minTabIndex = Double.Parse(node.Value.ToString());
            }

            return minTabIndex;
        }








        public double GetNextTabIndex(Page page, View view, double currentTabIndex)
        {
            double nextTabIndex = 0;
            XmlNodeList fieldNodeList = GetFieldsNode(view.ViewElement).SelectNodes(@"//Field[not(@FieldTypeId = 'Label') and not (@FieldTypeId = 'Mirror') and not (@FieldTypeId = 'Group') and not (@FieldTypeId = 'RecStatus') and not (@FieldTypeId = 'UniqueKey')]");

            foreach (XmlNode node in fieldNodeList)
            {
                XmlNode fieldNode = node.SelectSingleNode(@"//Field[@TabIndex > '" + currentTabIndex + "']/@TabIndex");
                if (fieldNode != null || (!fieldNode.Value.Trim().Equals(string.Empty)))
                {
                    nextTabIndex = Double.Parse(fieldNode.Value);
                    break;
                }
                else
                {
                    nextTabIndex = -1;
                }
            }
            return nextTabIndex;
        }






        public int GetMaxViewPagesPosition(int viewId)
        {
            int maxViewPagePosition = 0;
            XmlNode viewsNode = GetViewsNode();
            XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + viewId + "']");
            XmlNode pagesNode = viewsNode.SelectSingleNode("//Pages");
            XmlNode pageNode = pagesNode.SelectSingleNode(@"//Page[not(../Page/@Position > @Position)]/@Position");

            if (pageNode == null || pageNode.Value.Trim().Equals(string.Empty))
            {
                maxViewPagePosition = -1;
            }
            else if (!pageNode.Value.Equals(string.Empty))
            {
                maxViewPagePosition = Int32.Parse(pageNode.Value);
            }
            return maxViewPagePosition;
        }

        //Utility Methods
















        public virtual DataTable GetCodeTable(string tableName)
        {
            throw new System.ApplicationException("Not implemented");
        }





        public virtual DataTable GetViewRelations(string viewTableName)
        {
            throw new System.ApplicationException("Not implemented");
        }






        public virtual DataTable GetCheckCodeVariableDefinitions(string viewName)
        {
            throw new System.ApplicationException("Not implemented");
        }






        public virtual DataTable GetViewCheckCode(string viewName)
        {
            throw new System.ApplicationException("Not implemented");
        }







        public virtual string GetSourceFieldName(string fieldName, string viewName)
        {
            throw new System.ApplicationException("Not implemented");
        }







        public virtual DataTable GetFieldsOnPageAsDataTable(string viewName, int pageNumber)
        {
            throw new System.ApplicationException("Not implemented");
        }






        public virtual DataTable GetGridColumns(string gridTableName)
        {
            throw new System.ApplicationException("Not implemented");
        }







        public virtual DataTable GetCodeTableName(string viewTableName, string tableVariableName)
        {
            throw new System.ApplicationException("Not implemented");
        }








        public virtual void UpdatePgm(string name, string content, string comment, string author)
        {
            throw new System.ApplicationException("Not implemented");
        }

        //Public Methods

        //Static Methods





        public static bool IsEpi7Metadata(IDbDriver db)
        {
            //Input Validation
            if (db == null)
            {
                throw new ArgumentNullException("DB");
            }
            //

            try
            {

                bool isEpi7Metadata = false;
                Query query = db.CreateQuery("select [EpiVersion], [Purpose] from metaDBInfo");

                DataTable results = db.Select(query);
                if (results.Rows.Count > 0)
                {
                    foreach (DataRow row in results.Rows)
                    {
                        isEpi7Metadata = (row["EpiVersion"].ToString().Substring(0, 1) == "7") && ((row["Purpose"].ToString() == "0") || (row["Purpose"].ToString() == "1"));
                    }
                }
                return isEpi7Metadata;
            }
            finally
            {
            }
        }





        //Static Methods

        //Private Methods




        private void Save()
        {
            Project.Save();
        }





        private XmlDocument GetXmlDocument()
        {
            return project.GetXmlDocument();
        }





        private XmlNode GetRootNode()
        {
            return project.GetMetadataNode();
        }





        private XmlNode GetViewsNode()
        {
            return GetRootNode().SelectSingleNode("Views");
        }





        private XmlNode GetMapsNode()
        {
            return GetRootNode().SelectSingleNode("Maps");
        }





        private XmlNode GetLayersNode()
        {
            return GetRootNode().SelectSingleNode("Layers");
        }







        private XmlNode GetPagesNode(XmlElement viewElement)
        {

            return viewElement.SelectSingleNode("Pages");
        }






        public XmlNode GetFieldsNode(XmlElement viewElement)
        {
            return viewElement.SelectSingleNode("Fields");
        }

        private void RaiseProgressReportBeginEvent(int min, int max, int step)
        {
            if (this.ProgressReportBeginEvent != null)
            {
                this.ProgressReportBeginEvent(min, max, step);
            }
        }

        private void RaiseProgressReportUpdateEvent()
        {
            if (this.ProgressReportUpdateEvent != null)
            {
                this.ProgressReportUpdateEvent();
            }
        }

        private void RaiseProgressReportEndEvent()
        {
            if (this.ProgressReportEndEvent != null)
            {
                this.ProgressReportEndEvent();
            }
        }




        private void CreateTables()
        {



























            CreateDbInfoTable();
            CreateProgramsTable();
            CreateDataTypesTable();
            CreatePatternsTable();
            CreateFieldTypesTable();
            CreateViewsTable();
            CreatePagesTable();
            CreateFieldsTable();
            CreateGridColumnsTable();
            CreateLayerRenderTypesTable();
            CreateLayersTable();
            CreateMapsTable();
            CreateMapLayersTable();
            CreateMapPointsTable();
        }

        private void CreateMapPointsTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("MapPointId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("DataSourceTableName", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("DataSourceXCoordinateColumnName", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("DataSourceYCoordinateColumnName", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("DataSourceLabelColumnName", GenericDbColumnType.String, 64, true));
            columns.Add(new TableColumn("Size", GenericDbColumnType.Int32, false));
            columns.Add(new TableColumn("Color", GenericDbColumnType.Int32, false));
            columns.Add(new TableColumn("MapId", GenericDbColumnType.Int32, false, "metaMaps", "MapId"));
            db.CreateTable("metaMapPoints", columns);
        }

        private void CreateMapsTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("MapId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("Title", GenericDbColumnType.String, 255, true));
            db.CreateTable("metaMaps", columns);
        }

        private void CreateMapLayersTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("MapLayerId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("RenderField", GenericDbColumnType.String, 64, true));
            columns.Add(new TableColumn("MarkerColor", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("RampBeginColor", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("RampEndColor", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("ClassBreaks", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("DataTableName", GenericDbColumnType.String, 64, true));
            columns.Add(new TableColumn("DataTableKey", GenericDbColumnType.String, 64, true));
            columns.Add(new TableColumn("FeatureKey", GenericDbColumnType.String, 64, true));
            columns.Add(new TableColumn("LineColor", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("FillColor", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("PolygonOutlineColor", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("MapId", GenericDbColumnType.Int32, false, "metaMaps", "MapId"));
            columns.Add(new TableColumn("LayerId", GenericDbColumnType.Int32, false, "metaLayers", "LayerId"));
            columns.Add(new TableColumn("LayerRenderTypeId", GenericDbColumnType.Int32, false, "metaLayerRenderTypes", "LayerRenderTypeId"));
            db.CreateTable("metaMapLayers", columns);
        }

        private void CreateLayersTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("LayerId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("Gml", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("GmlSchema", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("Description", GenericDbColumnType.String, 255, true));
            db.CreateTable("metaLayers", columns);
        }

        private void CreateLayerRenderTypesTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("LayerRenderTypeId", GenericDbColumnType.Int32, false, true, false));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 30, false));
            db.CreateTable("metaLayerRenderTypes", columns);
        }

        private void CreateDbInfoTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("ProjectId", GenericDbColumnType.Guid, false));
            columns.Add(new TableColumn("ProjectLocation", GenericDbColumnType.String, 255, false));
            columns.Add(new TableColumn("ProjectName", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("EpiVersion", GenericDbColumnType.String, 20, false));
            columns.Add(new TableColumn("Purpose", GenericDbColumnType.Int32, false));
            db.CreateTable("metaDbInfo", columns);
        }

        private void CreateProgramsTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("ProgramId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("Content", GenericDbColumnType.StringLong, false));
            columns.Add(new TableColumn("Comment", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("DateCreated", GenericDbColumnType.DateTime, false));
            columns.Add(new TableColumn("DateModified", GenericDbColumnType.DateTime, false));
            columns.Add(new TableColumn("Author", GenericDbColumnType.String, 64, true));
            db.CreateTable("metaPrograms", columns);
        }

        private void CreateDataTypesTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("DataTypeId", GenericDbColumnType.Int32, false, true, false));
            columns.Add(new TableColumn("HasPattern", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("HasSize", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("HasRange", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 30, false));
            db.CreateTable("metaDataTypes", columns);
        }

        private void CreatePatternsTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("PatternId", GenericDbColumnType.Int32, false, true, false));
            columns.Add(new TableColumn("Expression", GenericDbColumnType.String, 30, false));
            columns.Add(new TableColumn("Mask", GenericDbColumnType.String, 30, false));
            columns.Add(new TableColumn("FormattedExpression", GenericDbColumnType.String, 30, false));
            columns.Add(new TableColumn("DataTypeId", GenericDbColumnType.Int32, false, "metaDataTypes", "DataTypeId"));

            db.CreateTable("metaPatterns", columns);
        }

        private void CreateFieldTypesTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("FieldTypeId", GenericDbColumnType.Int32, false, true, false));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 50, false));
            columns.Add(new TableColumn("HasFont", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("HasRepeatLast", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("HasRequired", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("HasReadOnly", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("HasRetainImageSize", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("IsDropDown", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("IsGridColumn", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("IsSystem", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("DataTypeId", GenericDbColumnType.Int32, false, "metaDataTypes", "DataTypeId"));
            db.CreateTable("metaFieldTypes", columns);
        }

        private void CreateViewsTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("ViewId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("IsRelatedView", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("CheckCodeBefore", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("CheckCodeAfter", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("RecordCheckCodeBefore", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("RecordCheckCodeAfter", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("CheckCodeVariableDefinitions", GenericDbColumnType.StringLong, true));
            db.CreateTable("metaViews", columns);
        }

        private void CreatePagesTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("PageId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("Position", GenericDbColumnType.Int16, false));
            columns.Add(new TableColumn("CheckCodeBefore", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("CheckCodeAfter", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("ViewId", GenericDbColumnType.Int32, false, "metaViews", "ViewId"));
            columns.Add(new TableColumn("Width", GenericDbColumnType.Int32, true, false));
            columns.Add(new TableColumn("Height", GenericDbColumnType.Int32, true, false));
            columns.Add(new TableColumn("Orientation", GenericDbColumnType.String, true, false));
            columns.Add(new TableColumn("LabelAlign", GenericDbColumnType.String, true, false));
            columns.Add(new TableColumn("TargetMedium", GenericDbColumnType.String, true, false));
            db.CreateTable("metaPages", columns);
        }

        private void CreateFieldsTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("FieldId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("PromptText", GenericDbColumnType.String, 255, true));
            columns.Add(new TableColumn("ControlFontFamily", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("ControlFontStyle", GenericDbColumnType.String, 50, true));
            columns.Add(new TableColumn("ControlFontSize", GenericDbColumnType.Decimal, 2, true));
            columns.Add(new TableColumn("ControlTopPositionPercentage", GenericDbColumnType.Double, true));
            columns.Add(new TableColumn("ControlLeftPositionPercentage", GenericDbColumnType.Double, true));
            columns.Add(new TableColumn("ControlHeightPercentage", GenericDbColumnType.Double, true));
            columns.Add(new TableColumn("ControlWidthPercentage", GenericDbColumnType.Double, true));
            columns.Add(new TableColumn("TabIndex", GenericDbColumnType.Double, true));
            columns.Add(new TableColumn("HasTabStop", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("PromptFontFamily", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("PromptFontStyle", GenericDbColumnType.String, 50, true));
            columns.Add(new TableColumn("PromptFontSize", GenericDbColumnType.Decimal, 2, true));
            columns.Add(new TableColumn("PromptScriptName", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("PromptTopPositionPercentage", GenericDbColumnType.Double, true));
            columns.Add(new TableColumn("PromptLeftPositionPercentage", GenericDbColumnType.Double, true));
            columns.Add(new TableColumn("ControlScriptName", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("ShouldRepeatLast", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("IsRequired", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("IsReadOnly", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("ShouldRetainImageSize", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("MaxLength", GenericDbColumnType.Int16, true));
            columns.Add(new TableColumn("Lower", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("Upper", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("Pattern", GenericDbColumnType.String, 50, true));
            columns.Add(new TableColumn("ShowTextOnRight", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("CheckCodeBefore", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("CheckCodeAfter", GenericDbColumnType.StringLong, true));
            columns.Add(new TableColumn("RelateCondition", GenericDbColumnType.String, 255, true));
            columns.Add(new TableColumn("ShouldReturnToParent", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("SourceTableName", GenericDbColumnType.String, 50, true));
            columns.Add(new TableColumn("CodeColumnName", GenericDbColumnType.String, 50, true));
            columns.Add(new TableColumn("TextColumnName", GenericDbColumnType.String, 50, true));
            columns.Add(new TableColumn("Sort", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("IsExclusiveTable", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("DataTableName", GenericDbColumnType.String, 64, true));
            columns.Add(new TableColumn("SourceFieldId", GenericDbColumnType.Int32, true));
            columns.Add(new TableColumn("FieldTypeId", GenericDbColumnType.Int32, false, "metaFieldTypes", "FieldTypeId"));
            columns.Add(new TableColumn("RelatedViewId", GenericDbColumnType.Int32, true, "metaViews", "ViewId"));
            columns.Add(new TableColumn("ViewId", GenericDbColumnType.Int32, false, "metaViews", "ViewId"));
            columns.Add(new TableColumn("PageId", GenericDbColumnType.Int32, true, "metaPages", "PageId"));
            db.CreateTable("metaFields", columns);
        }

        private void CreateGridColumnsTable()
        {
            List columns = new List();
            columns.Add(new TableColumn("GridColumnId", GenericDbColumnType.Int32, false, true, true));
            columns.Add(new TableColumn("Name", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("Size", GenericDbColumnType.Int16, true));
            columns.Add(new TableColumn("Position", GenericDbColumnType.Int16, false));
            columns.Add(new TableColumn("Text", GenericDbColumnType.String, 64, false));
            columns.Add(new TableColumn("ShouldRepeatLast", GenericDbColumnType.Boolean, false));
            columns.Add(new TableColumn("IsRequired", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("IsReadOnly", GenericDbColumnType.Boolean, true));
            columns.Add(new TableColumn("Pattern", GenericDbColumnType.String, 64, true));
            columns.Add(new TableColumn("Upper", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("Lower", GenericDbColumnType.String, 20, true));
            columns.Add(new TableColumn("Width", GenericDbColumnType.Int32, false));
            columns.Add(new TableColumn("FieldId", GenericDbColumnType.Int32, false, "metaFields", "FieldId", true));
            columns.Add(new TableColumn("FieldTypeId", GenericDbColumnType.Int32, false, "metaFieldTypes", "FieldTypeId"));
            db.CreateTable("metaGridColumns", columns);
        }




        private void PopulateTables()
        {
            try
            {

                foreach (AppDataSet.DataTypesRow dataType in AppData.Instance.DataTypesDataTable.Rows)
                {
                    Query dataTypeSelectExists = db.CreateQuery("SELECT 1 FROM metaDataTypes WHERE [DataTypeId] = @DataTypeId AND [Name] = @Name");
                    dataTypeSelectExists.Parameters.Add(new QueryParameter("@DataTypeId", DbType.Int32, dataType.DataTypeId));
                    dataTypeSelectExists.Parameters.Add(new QueryParameter("@Name", DbType.String, dataType.Name));

                    IDataReader reader = db.ExecuteReader(dataTypeSelectExists);

                    if (!reader.Read())
                    {
                        Query dataTypeInsert = db.CreateQuery("insert into metaDataTypes ([DataTypeId], [Name], [HasPattern], [HasSize], [HasRange]) values (@DataTypeId, @Name, @HasPattern, @HasSize, @HasRange)");
                        dataTypeInsert.Parameters.Add(new QueryParameter("@DataTypeId", DbType.Int32, dataType.DataTypeId));
                        dataTypeInsert.Parameters.Add(new QueryParameter("@Name", DbType.String, dataType.Name));
                        dataTypeInsert.Parameters.Add(new QueryParameter("@HasPattern", DbType.Boolean, dataType.HasPattern));
                        dataTypeInsert.Parameters.Add(new QueryParameter("@HasSize", DbType.Boolean, dataType.HasSize));
                        dataTypeInsert.Parameters.Add(new QueryParameter("@HasRange", DbType.Boolean, dataType.HasRange));

                        db.ExecuteNonQuery(dataTypeInsert);
                    }
                }
                foreach (AppDataSet.FieldTypesRow fieldType in AppData.Instance.FieldTypesDataTable.Rows)
                {
                    Query fieldaTypeSelectExists = db.CreateQuery("SELECT 1 FROM metaFieldTypes WHERE [FieldTypeId] = @FieldTypeId AND [Name] = @Name");
                    fieldaTypeSelectExists.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, fieldType.FieldTypeId));
                    fieldaTypeSelectExists.Parameters.Add(new QueryParameter("@Name", DbType.String, fieldType.Name));

                    IDataReader reader = db.ExecuteReader(fieldaTypeSelectExists);

                    if (!reader.Read())
                    {
                        Query fieldTypeInsert = db.CreateQuery("insert into metaFieldTypes ([FieldTypeId], [Name], [HasRepeatLast], [HasRequired], [HasReadOnly], [HasRetainImageSize], [HasFont], [IsDropDown], [IsGridColumn], [DataTypeId], [IsSystem], [DefaultPatternId]) values (@FieldTypeId, @Name, @HasRepeatLast, @HasRequired, @HasReadOnly, @HasRetainImageSize, @HasFont, @IsDropDown, @IsGridColumn, @DataTypeId, @IsSystem, @DefaultPatternId)");
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@FieldTypeId", DbType.Int32, fieldType.FieldTypeId));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@Name", DbType.String, fieldType.Name));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@HasRepeatLast", DbType.Boolean, fieldType.HasRepeatLast));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@HasRequired", DbType.Boolean, fieldType.HasRequired));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@HasReadOnly", DbType.Boolean, fieldType.HasReadOnly));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@HasRetainImageSize", DbType.Boolean, fieldType.HasRetainImageSize));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@HasFont", DbType.Boolean, fieldType.HasFont));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@IsDropDown", DbType.Boolean, fieldType.IsDropDown));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@IsGridColumn", DbType.Boolean, fieldType.IsGridColumn));
                        if (fieldType.IsDataTypeIdNull())
                            fieldTypeInsert.Parameters.Add(new QueryParameter("@DataTypeId", DbType.Int32, DBNull.Value));
                        else
                            fieldTypeInsert.Parameters.Add(new QueryParameter("@DataTypeId", DbType.Int32, fieldType.DataTypeId));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@IsSystem", DbType.Boolean, fieldType.IsSystem));
                        fieldTypeInsert.Parameters.Add(new QueryParameter("@DefaultPatternId", DbType.Int32, fieldType.DefaultPatternId));

                        db.ExecuteNonQuery(fieldTypeInsert);
                    }
                }
                foreach (AppDataSet.DataPatternsRow pattern in AppData.Instance.DataPatternsDataTable.Rows)
                {
                    Query patternSelectExists = db.CreateQuery("SELECT 1 FROM metaPatterns WHERE [PatternId] = @PatternId AND [DataTypeId] = @DataTypeId");
                    patternSelectExists.Parameters.Add(new QueryParameter("@PatternId", DbType.Int32, pattern.PatternId));
                    patternSelectExists.Parameters.Add(new QueryParameter("@DataTypeId", DbType.Int32, pattern.PatternId));

                    IDataReader reader = db.ExecuteReader(patternSelectExists);

                    if (!reader.Read())
                    {
                        Query patternInsert = db.CreateQuery("insert into metaPatterns ([PatternId], [DataTypeId], [Expression], [Mask], [FormattedExpression]) values (@PatternId, @DataTypeId, @Expression, @Mask, @FormattedExpression)");
                        patternInsert.Parameters.Add(new QueryParameter("@PatternId", DbType.Int32, pattern.PatternId));
                        patternInsert.Parameters.Add(new QueryParameter("@DataTypeId", DbType.Int32, pattern.DataTypeId));
                        patternInsert.Parameters.Add(new QueryParameter("@Expression", DbType.String, pattern.Expression));
                        patternInsert.Parameters.Add(new QueryParameter("@Mask", DbType.String, pattern.Mask));
                        patternInsert.Parameters.Add(new QueryParameter("@FormattedExpression", DbType.String, pattern.FormattedExpression));

                        db.ExecuteNonQuery(patternInsert);
                    }
                }
                foreach (AppDataSet.LayerRenderTypesRow layerRenderType in AppData.Instance.LayerRenderTypesDataTable.Rows)
                {
                    Query layerRenderSelectExists = db.CreateQuery("SELECT 1 FROM metaLayerRenderTypes WHERE [LayerRenderTypeId] = @LayerRenderTypeId AND [Name] = @Name");
                    layerRenderSelectExists.Parameters.Add(new QueryParameter("@LayerRenderTypeId", DbType.Int32, layerRenderType.LayerRenderTypeId));
                    layerRenderSelectExists.Parameters.Add(new QueryParameter("@Name", DbType.String, layerRenderType.Name));

                    IDataReader reader = db.ExecuteReader(layerRenderSelectExists);

                    if (!reader.Read())
                    {
                        Query layerRenderInsert = db.CreateQuery("insert into metaLayerRenderTypes ([LayerRenderTypeId], [Name]) values (@LayerRenderTypeId, @Name)");
                        layerRenderInsert.Parameters.Add(new QueryParameter("@LayerRenderTypeId", DbType.Int32, layerRenderType.LayerRenderTypeId));
                        layerRenderInsert.Parameters.Add(new QueryParameter("@Name", DbType.String, layerRenderType.Name));
                        db.ExecuteNonQuery(layerRenderInsert);
                    }
                }
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not populate project tables", ex);
            }
            finally
            {

            }
        }




        private void InsertProject()
        {
            try
            {
                ApplicationIdentity appId = new ApplicationIdentity(typeof(Configuration).Assembly);

                Query query = db.CreateQuery("insert into metaDBInfo([ProjectId], [ProjectName], [ProjectLocation], [EpiVersion], [Purpose]) values (@ProjectId, @ProjectName, @ProjectLocation, @EpiVersion, @Purpose)");
                query.Parameters.Add(new QueryParameter("@ProjectId", DbType.Guid, this.Project.Id));
                query.Parameters.Add(new QueryParameter("@ProjectName", DbType.String, Project.Name));
                query.Parameters.Add(new QueryParameter("@ProjectLocation", DbType.String, Project.Location));
                query.Parameters.Add(new QueryParameter("@EpiVersion", DbType.String, appId.Version));

                if (Project.UseMetadataDbForCollectedData)
                    query.Parameters.Add(new QueryParameter("@Purpose", DbType.Int32, (int)DatabasePurpose.MetadataAndCollectedData));
                else
                    query.Parameters.Add(new QueryParameter("@Purpose", DbType.Int32, (int)DatabasePurpose.Metadata));


                db.ExecuteNonQuery(query);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not create new project", ex);
            }
            finally
            {

            }
        }






        public Font ExtractPromptFont(DataRow fieldRow)
        {
            string fontFamilyName = Defaults.FontFamilyName;
            float fontSize = Defaults.FontSize; ;
            FontStyle fontStyle = Defaults.FontStyle;
            if (!(fieldRow["PromptFontFamily"] is DBNull))
            {
                fontFamilyName = fieldRow["PromptFontFamily"].ToString();
            }
            if (!(fieldRow["PromptFontSize"] is DBNull))
            {
                fontSize = Float.Parse(fieldRow["PromptFontSize"].ToString());
            }
            if (!(fieldRow["PromptFontStyle"] is DBNull))
            {
                fontStyle = (FontStyle)System.Enum.Parse(typeof(FontStyle), fieldRow["PromptFontStyle"].ToString());
            }

            Font font = new Font(fontFamilyName, fontSize, fontStyle);
            return font;
        }

        //




        protected void CreateMetadataTables()
        {
            CreateTables();
            PopulateTables();
            InsertProject();
        }






        public void GetFieldData(CheckBoxField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);






            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);
            field.TableName = fieldNode.Attributes["DataTableName"].Value;




            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }






        public void GetFieldData(CommandButtonField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);









            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }






        public void GetFieldData(DateField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.Lower = fieldNode.Attributes["Lower"].Value;
            field.Upper = fieldNode.Attributes["Upper"].Value;
            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(DateTimeField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(DDLFieldOfCodes field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.CodeColumnName = fieldNode.Attributes["CodeColumnName"].Value;
            field.IsExclusiveTable = bool.Parse(fieldNode.Attributes["IsExclusiveTable"].Value);
            field.ShouldSort = bool.Parse(fieldNode.Attributes["Sort"].Value);
            field.SourceTableName = fieldNode.Attributes["SourceTableName"].Value;
            field.TextColumnName = fieldNode.Attributes["TextColumnName"].Value;
            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }







        public void GetFieldData(DDListField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.CodeColumnName = fieldNode.Attributes["CodeColumnName"].Value;
            field.IsExclusiveTable = bool.Parse(fieldNode.Attributes["IsExclusiveTable"].Value);
            field.ShouldSort = bool.Parse(fieldNode.Attributes["Sort"].Value);
            field.SourceTableName = fieldNode.Attributes["SourceTableName"].Value;
            field.TextColumnName = fieldNode.Attributes["TextColumnName"].Value;
            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }







        public void GetFieldData(DDLFieldOfCommentLegal field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.CodeColumnName = fieldNode.Attributes["CodeColumnName"].Value;
            field.IsExclusiveTable = bool.Parse(fieldNode.Attributes["IsExclusiveTable"].Value);
            field.ShouldSort = bool.Parse(fieldNode.Attributes["Sort"].Value);
            field.SourceTableName = fieldNode.Attributes["SourceTableName"].Value;
            field.TextColumnName = fieldNode.Attributes["TextColumnName"].Value;
            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(DDLFieldOfLegalValues field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.CodeColumnName = fieldNode.Attributes["CodeColumnName"].Value;
            field.IsExclusiveTable = bool.Parse(fieldNode.Attributes["IsExclusiveTable"].Value);
            field.ShouldSort = bool.Parse(fieldNode.Attributes["Sort"].Value);
            field.SourceTableName = fieldNode.Attributes["SourceTableName"].Value;
            field.TextColumnName = fieldNode.Attributes["TextColumnName"].Value;
            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(ForeignKeyField field, XmlNode fieldNode)
        {
        }






        public void GetFieldData(GridField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);








            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);


        }







        public void GetFieldData(GUIDField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;
            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);
            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);
            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.TableName = fieldNode.Attributes["DataTableName"].Value;
            field.SourceFieldId = Int32.Parse(fieldNode.Attributes["SourceFieldId"].Value);

            field.Page = new Page(field.GetView());
            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }






        public void GetFieldData(ImageField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.TableName = fieldNode.Attributes["DataTableName"].Value;


            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }






        public void GetFieldData(LabelField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);








            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }






        public void GetFieldData(MirrorField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);


            field.SourceFieldId = Int32.Parse(fieldNode.Attributes["SourceFieldId"].Value);


            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }






        public void GetFieldData(MultilineTextField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.MaxLength = Int32.Parse(fieldNode.Attributes["MaxLength"].Value);
            field.TableName = fieldNode.Attributes["DataTableName"].Value;
            field.SourceFieldId = Int32.Parse(fieldNode.Attributes["SourceFieldId"].Value);


            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(NumberField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.Lower = fieldNode.Attributes["Lower"].Value;
            field.Upper = fieldNode.Attributes["Upper"].Value;
            field.Pattern = fieldNode.Attributes["Pattern"].Value;
            field.TableName = fieldNode.Attributes["DataTableName"].Value;


            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);




        }






        public void GetFieldData(OptionField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);





            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);
            field.ShowTextOnRight = bool.Parse(fieldNode.Attributes["ShowTextOnRight"].Value);

            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);


        }






        public void GetFieldData(PhoneNumberField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.Pattern = fieldNode.Attributes["Pattern"].Value;
            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(RecStatusField field, XmlNode fieldNode)
        {
        }






        public void GetFieldData(RelatedViewField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);






            field.Condition = fieldNode.Attributes["RelateCondition"].Value;
            field.RelatedViewID = Int32.Parse(fieldNode.Attributes["RelatedViewId"].Value);
            field.ShouldReturnToParent = bool.Parse(fieldNode.Attributes["ShouldReturnToParent"].Value);



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }






        public void GetFieldData(SingleLineTextField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.MaxLength = Int32.Parse(fieldNode.Attributes["MaxLength"].Value);
            field.TableName = fieldNode.Attributes["DataTableName"].Value;
            field.SourceFieldId = Int32.Parse(fieldNode.Attributes["SourceFieldId"].Value);



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(TimeField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.TableName = fieldNode.Attributes["DataTableName"].Value;



            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);



        }






        public void GetFieldData(UniqueKeyField field, XmlNode fieldNode)
        {
        }







        public void GetFieldData(UniqueIdentifierField field, XmlNode fieldNode)
        {
        }





        public void GetFieldData(UpperCaseTextField field, XmlNode fieldNode)
        {

        }






        public void GetFieldData(YesNoField field, XmlNode fieldNode)
        {
            field.Id = Int32.Parse(fieldNode.Attributes["FieldId"].Value);
            field.Name = fieldNode.Attributes["Name"].Value;
            field.PromptText = fieldNode.Attributes["PromptText"].Value;



            field.ControlTopPositionPercentage = Double.Parse(fieldNode.Attributes["ControlTopPositionPercentage"].Value);
            field.ControlLeftPositionPercentage = Double.Parse(fieldNode.Attributes["ControlLeftPositionPercentage"].Value);
            field.ControlHeightPercentage = Double.Parse(fieldNode.Attributes["ControlHeightPercentage"].Value);
            field.ControlWidthPercentage = Double.Parse(fieldNode.Attributes["ControlWidthPercentage"].Value);
            field.TabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value);
            field.HasTabStop = bool.Parse(fieldNode.Attributes["HasTabStop"].Value);




            field.PromptTopPositionPercentage = Double.Parse(fieldNode.Attributes["PromptTopPositionPercentage"].Value);
            field.PromptLeftPositionPercentage = Double.Parse(fieldNode.Attributes["PromptLeftPositionPercentage"].Value);

            field.ShouldRepeatLast = bool.Parse(fieldNode.Attributes["ShouldRepeatLast"].Value);
            field.IsRequired = bool.Parse(fieldNode.Attributes["IsRequired"].Value);
            field.IsReadOnly = bool.Parse(fieldNode.Attributes["IsReadOnly"].Value);

            field.TableName = fieldNode.Attributes["DataTableName"].Value;


            field.Page = new Page(field.GetView());

            field.Page.Id = Int32.Parse(fieldNode.Attributes["PageId"].Value);
        }








        public int GetFieldTabIndex(int fieldId, int viewId, int pageId)
        {
            int fieldTabIndex = 0;
            XmlNode viewsNode = GetXmlDocument().SelectSingleNode("//Views");
            XmlNode viewNode = viewsNode.SelectSingleNode("//View[@ViewId = '" + viewId + "']");
            XmlNode fieldsNode = viewNode.SelectSingleNode("//Fields");
            XmlNode fieldNode = fieldsNode.SelectSingleNode("Field[@FieldId = '" + fieldId + "' and @PageId = '" + pageId + "']");

            if (fieldNode == null)
            {
                fieldTabIndex = -1;
            }
            else
            {
                fieldTabIndex = Int32.Parse(fieldNode.Attributes["TabIndex"].Value.ToString());
            }

            return fieldTabIndex;
        }





        TableSchema.TablesDataTable IMetadataProvider.GetCodeTableList()
        {
            try
            {
                DataSets.TableSchema.TablesDataTable tables = db.GetTableSchema();

                DataRow[] rowsFiltered = tables.Select("TABLE_NAME not like 'code%'");
                foreach (DataRow rowFiltered in rowsFiltered)
                {
                    tables.Rows.Remove(rowFiltered);
                }
                foreach (DataRow row in tables)
                {
                    if (String.IsNullOrEmpty(row.ItemArray[0].ToString()))
                    {

                        tables.Rows.Remove(row);
                    }
                }
                return tables;
            }
            catch (Exception ex)
            {
                throw new System.ApplicationException("Could not retrieve code tables from database", ex);
            }
        }






        public View GetParentView(int viewId)
        {
            View RetVal = null;
            Query query = null;

            query = db.CreateQuery("SELECT DISTINCT f.ViewId FROM dbo.metaViews v INNER JOIN dbo.metaFields f ON f.RelatedViewId = v.ViewId WHERE v.ViewId = @viewId");
            query.Parameters.Add(new QueryParameter("@viewId", DbType.Int32, viewId));
            DataTable results = db.Select(query);

            if (results.Rows.Count > 0)
            {
                RetVal = this.GetViewById((int)results.Rows[0][0]);
            }

            return RetVal;
        }

        public void UpdateFonts(Font controlFont, Font promptFont, float viewId = -1, float pageId = -1)
        {
            try
            {
                StringBuilder sb = new StringBuilder();

                sb.Append("update [metaFields] set ");

                sb.Append("[ControlFontFamily] = @ControlFontFamily, ");
                sb.Append("[ControlFontStyle] = @ControlFontStyle, ");
                sb.Append("[ControlFontSize] = @ControlFontSize, ");

                sb.Append("[PromptFontFamily] = @PromptFontFamily, ");
                sb.Append("[PromptFontStyle] = @PromptFontStyle, ");
                sb.Append("[PromptFontSize] = @PromptFontSize, ");

                sb.Append("where ");

                if (viewId == -1)
                {
                    sb.Append("[ViewId] > @ViewId");
                }
                else
                {
                    sb.Append("[ViewId] = @ViewId");
                }

                sb.Append("and ");

                if (pageId == -1)
                {
                    sb.Append("[PageId] > @PageId");
                }
                else
                {
                    sb.Append("[PageId] = @PageId");
                }

                Query updateQuery = db.CreateQuery(sb.ToString());

                updateQuery.Parameters.Add(new QueryParameter("@ControlFontFamily", DbType.String, controlFont.Name));
                updateQuery.Parameters.Add(new QueryParameter("@ControlFontStyle", DbType.String, controlFont.Style.ToString()));
                updateQuery.Parameters.Add(new QueryParameter("@ControlFontSize", DbType.Double, controlFont.Size));

                updateQuery.Parameters.Add(new QueryParameter("@PromptFontFamily", DbType.String, promptFont.Name));
                updateQuery.Parameters.Add(new QueryParameter("@PromptFontStyle", DbType.String, promptFont.Style.ToString()));
                updateQuery.Parameters.Add(new QueryParameter("@PromptFontSize", DbType.Double, promptFont.Size));

                updateQuery.Parameters.Add(new QueryParameter("@ViewId", DbType.Int32, viewId));
                updateQuery.Parameters.Add(new QueryParameter("@PageId", DbType.Int32, pageId));

                db.ExecuteNonQuery(updateQuery);
            }
            catch (Exception ex)
            {
                throw new GeneralException("Could not update grid column in the database", ex);
            }
            finally
            {

            }
        }

        //IMetadataProvider Members





        public TableSchema.TablesDataTable GetCodeTableList(IDbDriver db)
        {
            throw new Exception("The method or operation is not implemented.");
        }






        public DataTable GetCodeTableNamesForProject(Project project)
        {
            throw new Exception("The method or operation is not implemented.");
        }





        public string IdentifyDatabase()
        {
            throw new Exception("The method or operation is not implemented.");
        }





        public DataTable GetBackgroundData()
        {
            throw new NotImplementedException();
        }





        public DataRow GetPageSetupData(View view)
        {
            throw new NotImplementedException();
        }






        public DataTable GetPageBackgroundData(Page page)
        {
            throw new NotImplementedException();
        }








        public void InsertPageBackgroundData(Page page, int imageId, string imageLayout, int color)
        {
            throw new NotImplementedException();
        }








        public void UpdatePageBackgroundData(Page page, string imagePath, string imageLayout, int color)
        {
            throw new NotImplementedException();
        }










        public void UpdatePageSetupData(View view, int width, int height, string orientation, string labelAlign, string targetMedium)
        {
            throw new NotImplementedException();
        }




        public void CreateBackgroundsTable()
        {
            throw new NotImplementedException();
        }




        public void CreateImagesTable()
        {
            throw new NotImplementedException();
        }
        //

        //IMetadataProvider Members


        public DataRow GetFieldGUIDByNameAsDataRow(string viewName, string fieldName)
        {
            throw new NotImplementedException();
        }

        //
    }
}


 